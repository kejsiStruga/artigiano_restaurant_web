/*!CK:3287696098!*//*1452550142,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["HOGWo"]); }

__d('CurationCaretNux',['csx','cx','ge','tidyEvent','Arbiter','AsyncRequest','CSS','DataStore','DOM','Event','NavigationMessage','Parent','Rect'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u="div._1zpr",v="div._6ks",w="._3x-2 img.img",x="span.text_exposed_link",y="_5jmm",z='CurationCaretNux_instance',aa='CurationCaretNux_caretMenuLoaded',ba=100,ca='LINK_WELCOME',da='VIDEO_WELCOME',ea='POST_SAVE_WELCOME',fa='PHOTO_WELCOME',ga='caret_nux',ha='save_option_nux',ia='seen',ja='dismissed',ka='focus',la='click',ma='scroll',na=false,oa=null,pa=null;function qa(ra,sa,ta,ua,va,wa){'use strict';var xa=j(ua);if(xa){this.container=xa;this.caret=ta;this.caretNux=ra.instance;this.caretNuxData=ra;this.saveOptionNux=sa.instance;this.saveOptionNuxData=sa;this.allowAutoplayNux=wa;this.popoverTriggered=false;var ya=s.byClass(xa,y);o.set(ya,z,this);switch(va){case ca:this.$CurationCaretNux1();break;case da:this.$CurationCaretNux1();this.$CurationCaretNux2();this.$CurationCaretNux3();break;case ea:this.$CurationCaretNux4();break;case fa:this.$CurationCaretNux5();break;}l.subscribeOnce(r.NAVIGATION_BEGIN,(function(){this.caretNux&&this.caretNux.hide();this.saveOptionNux&&this.saveOptionNux.hide();}).bind(this));}}qa.prototype.$CurationCaretNux1=function(){'use strict';var ra=p.scry(this.container,u);if(ra.length>0)k([q.listen(ra[0],'click',(function(){if(na||this.videoPlaying)return;this.caretNux.subscribe('show',(function(){this.$CurationCaretNux6();}).bind(this));this.caretNux.subscribe('hide',(function(){this.$CurationCaretNux7();if(na){this.$CurationCaretNux8(ga,ia);this.$CurationCaretNux8(ga,ja);}}).bind(this));this.$CurationCaretNux9();this.interactionTime=0;setTimeout((function(){if(!this.$CurationCaretNux10()){na=true;this.caretNux.show();}}).bind(this),this.caretNuxData.min_consume_duration);setTimeout((function(){if(!this.$CurationCaretNux10()){na=false;this.caretNux.hide();}}).bind(this),this.caretNuxData.max_consume_duration);var sa=Date.now();setTimeout((function(){this.$CurationCaretNux11((function(){if(!this.interactionTime)this.interactionTime=Date.now()-sa;}).bind(this));}).bind(this),0);}).bind(this))]);};qa.prototype.$CurationCaretNux2=function(){'use strict';var ra=p.scry(this.container,v);if(ra.length>0)k([q.listen(ra[0],'click',(function(){this.videoPlaying=true;}).bind(this))]);};qa.prototype.$CurationCaretNux3=function(){'use strict';if(!this.allowAutoplayNux)return;if(pa===null)pa=this.caretNuxData.min_consume_duration;if(oa===null&&!na)oa=l.subscribe('flash/updateStatus',function(event,ra){if(!na&&pa!==null&&ra.position*1000>pa){var sa=s.byClass(j(ra.divID),y),ta=o.get(sa,z);if(ta){na=true;ta.caretNux.show();ta.$CurationCaretNux6();l.unsubscribe(oa);}}});};qa.prototype.$CurationCaretNux4=function(){'use strict';var ra=p.scry(this.container,x);if(ra.length>0)k([q.listen(ra[0],'click',(function(){if(na)return;na=true;this.caretNux.show();this.$CurationCaretNux6();}).bind(this))]);};qa.prototype.$CurationCaretNux5=function(){'use strict';var ra=p.scry(this.container,w);ra.forEach(function(sa){var ta=s.byTag(sa,'a');q.listen(ta,'click',(function(){if(na)return;var ua=l.subscribe('PhotoSnowlift.OPEN',(function(){var va=Date.now(),wa=l.subscribe('PhotoSnowlift.CLOSE',(function(){var xa=Date.now()-va;if(xa>this.caretNuxData.min_consume_duration&&xa<this.caretNuxData.max_consume_duration){na=true;this.caretNux.show();this.$CurationCaretNux6();}l.unsubscribe(wa);}).bind(this));l.unsubscribe(ua);}).bind(this));}).bind(this));},this);};qa.prototype.$CurationCaretNux10=function(){'use strict';return this.interactionTime&&this.interactionTime>0;};qa.prototype.$CurationCaretNux6=function(){'use strict';this.caretClickListener=q.listen(this.caret,'click',(function(){this.caretNux.hide();if(this.saveOptionNux){this.popoverTriggered=true;this.$CurationCaretNux12();}}).bind(this));var ra=false,sa=(function(ta){if(ra||ta===la||!this.caretNux.isShown())return;var ua=t.getViewportWithoutScrollbarsBounds(),va=t.getElementBounds(this.caretNux.getContentRoot());va=va.sub(0,ba);if(ua.contains(va)){this.$CurationCaretNux8(ga,ia);ra=true;}}).bind(this);sa();this.$CurationCaretNux9();this.$CurationCaretNux11(sa);};qa.prototype.$CurationCaretNux7=function(){'use strict';this.caretClickListener.remove();this.$CurationCaretNux13();};qa.prototype.$CurationCaretNux12=function(){'use strict';if(this.$CurationCaretNux14()&&this.popoverTriggered)setTimeout((function(){var ra=p.scry(document,"li.save_caret_menu_item");for(var sa=0;sa<ra.length;sa++){var ta=ra[sa],ua=s.byClass(ta,"uiLayer");if(ua&&n.shown(ua)){this.saveOptionNux.setContext(ta);break;}}this.saveOptionNux.show();this.$CurationCaretNux8(ha,ia);var va=o.get(this.caret,'Popover');va&&va.subscribeOnce('hide',(function(){this.saveOptionNux.hide();}).bind(this));}).bind(this),0);};qa.prototype.$CurationCaretNux8=function(ra,sa){'use strict';var ta;if(ra===ga){ta=this.caretNuxData;}else if(ra===ha){ta=this.saveOptionNuxData;}else throw "Invalid nux type";var ua;if(sa===ia){ua=ta.seen_uri;ta.seen_uri=null;}else if(sa===ja){ua=ta.dismiss_uri;ta.dismiss_uri=null;}else throw "Invalid impression type";if(ua){var va=new m(ua);if(this.interactionTime&&ra===ga)va.setData({interaction_time:this.interactionTime});va.send();}};qa.prototype.$CurationCaretNux11=function(ra){'use strict';this.$CurationCaretNux15.push(ra);};qa.prototype.$CurationCaretNux16=function(ra){'use strict';this.$CurationCaretNux15.forEach(function(sa){sa.call(this,ra);},this);};qa.prototype.$CurationCaretNux9=function(){'use strict';if(!this.$CurationCaretNux17){this.$CurationCaretNux15=[];this.$CurationCaretNux17=[q.listen(window,'click',this.$CurationCaretNux16.bind(this,la)),q.listen(window,'focus',this.$CurationCaretNux16.bind(this,ka)),q.listen(window,'scroll',this.$CurationCaretNux16.bind(this,ma))];}};qa.prototype.$CurationCaretNux13=function(ra){'use strict';if(this.$CurationCaretNux17){while(this.$CurationCaretNux17.length)this.$CurationCaretNux17.pop().remove();this.$CurationCaretNux17=null;this.$CurationCaretNux15=null;}};qa.prototype.$CurationCaretNux14=function(){'use strict';var ra=s.byClass(this.container,y);return o.get(ra,aa)===true;};qa.saveOptionLoaded=function(ra){'use strict';var sa=j(ra);if(sa){var ta=s.byClass(sa,y);o.set(ta,aa,true);var ua=o.get(ta,z);ua&&ua.$CurationCaretNux12();}};f.exports=qa;},null);
__d("XSavedForLaterNUXSeenController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/saved\/nuxseen\/",{action:{type:"Enum",required:true,enumType:1},surface:{type:"Enum",required:true,enumType:1},mechanism:{type:"Enum",required:true,enumType:1},collection_id:{type:"Int",required:true},object_id:{type:"Int"},interaction_time:{type:"Int"}});},null);