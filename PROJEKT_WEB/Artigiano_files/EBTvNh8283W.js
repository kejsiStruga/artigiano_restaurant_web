/*!CK:2470343266!*//*1453502242,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9TVRJ"]); }

__d('CustomAbrManager',['EventListener','SubscriptionsHandler','VideoPlayerShakaExperiments','Shaka'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('Shaka').player.VideoTrack;l.FIRST_SWITCH_INTERVAL=j.firstSwitchInterval||4000;l.MIN_SWITCH_INTERVAL=j.minSwitchInterval||30000;l.MIN_EVAL_INTERVAL=j.minEvalInterval||3000;l.BANDWIDTH_UPGRADE_TARGET=j.bandwidthUpgradeTarget||.85;l.BANDWIDTH_DOWNGRADE_TARGET=j.bandwidthDowngradeTarget||.95;function l(m){'use strict';this.$CustomAbrManager1=null;this.$CustomAbrManager2=null;this.$CustomAbrManager3=new i();this.$CustomAbrManager4=Number.POSITIVE_INFINITY;this.$CustomAbrManager5=true;this.$CustomAbrManager6=false;this.$CustomAbrManager7=m.forceHighQualityDefault;}l.prototype.destroy=function(){'use strict';this.$CustomAbrManager3.release();this.$CustomAbrManager3=null;this.$CustomAbrManager1=null;this.$CustomAbrManager2=null;};l.prototype.initialize=function(m,n){'use strict';if(this.$CustomAbrManager1||this.$CustomAbrManager2)return;this.$CustomAbrManager1=m;this.$CustomAbrManager2=n;};l.prototype.start=function(){'use strict';if(!this.$CustomAbrManager1||!this.$CustomAbrManager2||this.$CustomAbrManager6)return;this.$CustomAbrManager4=Date.now()+l.FIRST_SWITCH_INTERVAL;this.$CustomAbrManager3.addSubscriptions(h.listen(this.$CustomAbrManager1,'bandwidth',this.$CustomAbrManager8.bind(this)),h.listen(this.$CustomAbrManager2,'adaptation',this.$CustomAbrManager9.bind(this)),h.listen(this.$CustomAbrManager2,'trackschanged',this.$CustomAbrManager10.bind(this)));this.$CustomAbrManager6=true;};l.prototype.forceHighQuality=function(m){'use strict';this.$CustomAbrManager7=m;if(!this.$CustomAbrManager6)return;if(m){var n=this.$CustomAbrManager11();if(n)this.selectVideoTrack(n,true);}else this.$CustomAbrManager10();};l.prototype.enable=function(m){'use strict';this.$CustomAbrManager5=m;};l.prototype.getInitialVideoTrackId=function(){'use strict';if(!this.$CustomAbrManager1||!this.$CustomAbrManager2)return null;var m=this.$CustomAbrManager11();return m?m.id:null;};l.prototype.selectVideoTrack=function(m,n,o){'use strict';if(!this.$CustomAbrManager6)return;this.$CustomAbrManager2.selectVideoTrack(m.id,n,o);};l.$CustomAbrManager12=function(m){'use strict';for(var n=0;n<m.length;++n)if(m[n].active)return m[n];return null;};l.prototype.$CustomAbrManager8=function(event){'use strict';if(Date.now()<this.$CustomAbrManager4)return;this.$CustomAbrManager10(event);};l.prototype.$CustomAbrManager10=function(event){'use strict';if(!this.$CustomAbrManager5)return;var m=this.$CustomAbrManager11();if(m){if(m.active){this.$CustomAbrManager4=Date.now()+l.MIN_EVAL_INTERVAL;return;}this.selectVideoTrack(m,false);}this.$CustomAbrManager4=Number.POSITIVE_INFINITY;};l.prototype.$CustomAbrManager9=function(event){'use strict';if(this.$CustomAbrManager4==Number.POSITIVE_INFINITY)this.$CustomAbrManager4=Date.now()+l.MIN_SWITCH_INTERVAL;};l.prototype.$CustomAbrManager11=function(){'use strict';var m=this.$CustomAbrManager2.getVideoTracks();if(m.length==0)return null;m.sort(k.compare);if(this.$CustomAbrManager7)return m.pop();var n=l.$CustomAbrManager12(this.$CustomAbrManager2.getAudioTracks()),o=n?n.bandwidth:0,p=this.$CustomAbrManager1.getBandwidth(),q=m[0];for(var r=0;r<m.length;r++){var s=m[r],t=r+1<m.length?m[r+1]:{bandwidth:Number.POSITIVE_INFINITY};if(!s.bandwidth)continue;var u=(s.bandwidth+o)/l.BANDWIDTH_DOWNGRADE_TARGET,v=(t.bandwidth+o)/l.BANDWIDTH_UPGRADE_TARGET;if(p>=u&&p<=v){q=s;if(q.active)break;}}return q;};f.exports=l;},null);