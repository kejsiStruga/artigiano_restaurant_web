/*!CK:2447597673!*//*1453487596,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Aiaxy"]); }

__d("FBRTCCallConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FBRTCCallConnectionType:{MISSED_CALL:4,CONNECTED_CALL:5},FBRTCCallType:{VOICE_CALL:1,VIDEO_CALL:2}};},null);
__d("LinkshimCallsites",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={INTERNAL_WIKI:1,MZERO_UPSELL:2,EVENTS_TICKET:3,UNIT_TEST:4,WEB_RESULT:5,OG_COMMENT_NOTIF:6,M_DATA_UPSELL:7,FBURL:8,M_URI:9,THIRD_PARTY_URL:10,UI_LINK:11,LANDING_CAMPAIGN:12,STREAM_CONTENT_TICKER:13,SOCIAL_WIFI_DEPRECATED:14,TIMELINE_APP_COLLECTION:15,SAVED_LATER_VIEW_ITEM:16,REQUESTS_CONTROLLER:17,LOGIN_BUTTON:18,COMMENT_PLUGIN_REDIRECT_ENTAPP:19,COMMENT_PLUGIN_REDIRECT_APPOWNED:20,M_DEEPLINK:21,M_DEEPLINK_INVALID:22,EVENT_BUY_TICKET:23,PAGE_TYPEAHEAD:24,EGO_ACTION:25,INTERN_SURVEY:26,RETIRED_ENDPOINT:27,OG_COMMENT_FEEDBACK_TARGET:28,LIKE_COMMON_RENDERER:29,NOTIFICATIONS_LINK:30,COUPON_OFFSITE_LINK:31,MZERO_MAILTO:32,MZERO:33,MERCURY_SHARE_ATTACHMENT:34,EXTERNAL_TOKEN_SURVEY:35,FBURL_INTERN:36,LANDING_PAGE_EXPERIMENT:37,OG_FEEDBACK_TARGET:38,GAMEDAY:39,ENTISH:40,JS_ENV:41,LINKSHIM_AUTOMATION:42,HEADER_FLUSHER:43,PLUGIN_HEADER_FLUSHER:44,TASKS_APP:45,FEEDBACK_MODEL:46,JP_EMAIL_LINK:47,NOTIFICATION_REWRITE:48,OG_ACTION_PERMALINK:49,MALWARE_SCAN:50,EMAIL_LINK:51,EMAIL_ATTACHMENT:52,RENDER_EMAIL_LEGACY:53,TAGGED_WITH_STORY_EMAIL_NOTIF:54,MSG_INTRO_NOTIF:55,GROUP_COMMENT_NOTIF:56,EVENT_INVITE_LOCATION_EMAIL:57,EVENT_INVITE_MESSAGE_EMAIL:58,CLOSE_FRIEND_ACTIVITY:59,GROUP_DOC_CREATED_URL:60,GROUP_DOC_CREATED_NAME:61,MALL_POST_EMAIL_NOTIF:62,MALL_POST_SOCIAL_MSG:63,NOTIFICATION_REWRITE_RSS:64,WALL_POST_SOCIAL_MSG:65,TITAN_MSG_BODY_EMAIL:66,TITAN_MSG_BODY_SUBJECT:67,GROUP_POST_EMAIL:68,GROUP_POST_URL_EMAIL:69,GROUP_POST_PERMALINK_EMAIL:70,GROUP_POST_OPTOUT_EMAIL:71,GROUP_POST_TEXT_NOTIF:72,CLOSE_FRIEND_EMAIL_SHARE:73,PLACE_TAGGED_IN_CHECKIN:74,QUESTIONS_ANSWER_EMAIL:75,SUPPORT_TASK_COMMENT:76,INVITE_MESSAGE_EMAIL:77,GROUP_REQUEST_TO_JOIN_EMAIL:78,GROUP_POST_COMMENT_PERMALINK:79,GROUP_POST_COMMENT_OPTOUT:80,GROUP_POST_COMMENT_TEXT:81,EVENT_NAME_CHANGE_NOTIF:82,EVENT_NAME_CHANGE_OLD_NAME_NOTIF:83,EVENT_NAME_CHANGE_NEW_NAME_NOTIF:84,EVENT_CANCEL_NOTIFICATION:85,BASE_COMMENT_NOTIF:86,FBPAGE_FAN_INVITE_NAME:87,FBPAGE_FAN_INVITE_MSG:88,MESSAGING_HTML_EMAIL:89,ROLLOUT_TEXT_EMAIL:90,COMMENT_EMAIL_TEXT:91,SHARE_CONTENT_LEGACY_EMAIL:92,MZERO_UPSELL_NOTIF:93,INTERN_DEBUG:94,CALL_TO_ACTION:95,QUICK_PROMOTION_ACTION:96,COMPOSED_TEXT:97,GIF_SEARCH:98,OFFERS:99,MZERO_ATTACHMENTS:100,MZERO_UPLOADS:101,CCTA_LINK:102,M_CCTA_LINK:103,SAVED_ITEM_REDIRECT:104,ADS_PROMOTED_OBJECT:105,EMBEDS_MTOUCH_SELECT:106,IORG_BOOKMARK:107,PAYPAL_INIT:108,FUNDRAISER_NOTIF:109,COMMENTS_PLUGIN_NOTIF:110,INSTANT_SHOPPING_ACTION:111,LINK_MENU:112,TALENT_SEARCH:113,COMET:114,INTERVIEW_STATS:115,SCHEDULR:116,BULK_SCHEDULR:117};},null);
__d("ScreenSharingWebDriverIDs",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SHARE_SCREEN_BUTTON:"shareScreenButton",INSTALL_EXT_DIALOG:"install_extension_dialog"};},null);
__d("VideoCallWebDriverIDs",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={END_CALL_BUTTON:"endCallButton",STAR_RATING_VIEW:"starRatingView"};},null);
__d("XLinkshimLinkAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/linkshim\/ajax\/link\/",{href:{type:"String",required:true},callsite:{type:"Enum",required:true,enumType:0}});},null);
__d('LinkshimURI',['AsyncRequest','XLinkshimLinkAsyncController','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={asyncGet:function(l,m,n){if(j(l)){n(l);return;}var o=i.getURIBuilder().setString('href',l.toString()).setEnum('callsite',m).getURI();new h(o).setHandler(function(p){var q=p.getPayload();n(q.uri);}).send();}};f.exports=k;},null);
__d('LinkshimLink.react',['Link.react','LinkshimURI','React','URI','areEqual'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=j.PropTypes,n=j.createClass({displayName:'LinkshimLink',propTypes:{uri:m.instanceOf(k).isRequired,callsite:m.number.isRequired,loadingPlaceholder:m.element},getInitialState:function(){return {shimURI:undefined};},componentWillMount:function(){this._asyncGetLinkShimURI(this.props);},componentWillReceiveProps:function(o){if(!l(this.props,o))this._asyncGetLinkShimURI(o);},_asyncGetLinkShimURI:function(o){i.asyncGet(o.uri,o.callsite,(function(p){return this.setState({shimURI:p});}).bind(this));},render:function(){if(!this.state.shimURI)return this.props.loadingPlaceholder?this.props.loadingPlaceholder:null;var o=this.props,p=o.children,q=babelHelpers.objectWithoutProperties(o,['children']);return (j.createElement(h,babelHelpers._extends({href:this.state.shimURI},q),p));}});f.exports=n;},null);
__d('MessengerContactImage.react',['Image.react','MessengerProfileImageWrapper.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=k.PropTypes,m=k.createClass({displayName:'MessengerContactImage',mixins:[j],propTypes:{isMessengerUser:l.bool,size:l.number.isRequired,src:l.string.isRequired},render:function(){return (k.createElement('div',{className:this.props.className},k.createElement(i,{isMessengerUser:this.props.isMessengerUser,size:this.props.size,showBadge:true},k.createElement(h,{alt:'',height:this.props.size,src:this.props.src,width:this.props.size}))));}});f.exports=m;},null);
__d('FBRTCAdminMessage',['FBRTCConstants','FBRTCCallConstants','FBRTCLogger','FBRTCUtils','XVideoCallAdminMessageController','emptyFunction','performanceNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p,q){'use strict';this.$FBRTCAdminMessage1=p;this.$FBRTCAdminMessage2=q;this.$FBRTCAdminMessage3=Date.now();this.$FBRTCAdminMessage4=null;this.$FBRTCAdminMessage5=null;}o.prototype.onCallConnected=function(){'use strict';if(!this.$FBRTCAdminMessage4)this.$FBRTCAdminMessage4=n();};o.prototype.onCallEnded=function(){'use strict';if(!this.$FBRTCAdminMessage5)this.$FBRTCAdminMessage5=n();};o.prototype.submit=function(p,q){'use strict';if(!this.$FBRTCAdminMessage5)this.onCallEnded();var r=0,s=i.FBRTCCallConnectionType.MISSED_CALL;if(this.$FBRTCAdminMessage4){r=Math.ceil(this.$FBRTCAdminMessage5-this.$FBRTCAdminMessage4);s=i.FBRTCCallConnectionType.CONNECTED_CALL;}var t=s===i.FBRTCCallConnectionType.CONNECTED_CALL||q===h.CallEndReason.IGNORE_CALL;this.$FBRTCAdminMessage6({peer_id:this.$FBRTCAdminMessage1,call_id:this.$FBRTCAdminMessage2,start_time:this.$FBRTCAdminMessage3,call_duration:r,message_type:s,call_category:p,call_acknowledged:t});};o.prototype.$FBRTCAdminMessage6=function(p){'use strict';var q=l.getURIBuilder().getURI();k.sendServerRequest(q,m,this.$FBRTCAdminMessage7.bind(this,p.peer_id,p.call_id),false,null,p);};o.prototype.$FBRTCAdminMessage7=function(p,q,r){'use strict';var s;if(r){s='Fail to log admin message, error '+r.error;}else s='Server timed out on logging admin message';j.getInstance().logError(p,q,s);};f.exports=o;},null);
__d('FBRTCPCConfig',['FBRTCVersionDetection'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i="stun:stun.fbsbx.com:3478",j=function(l,m,n){if(h.isChrome()&&h.webrtcVersion()>=34){var o={urls:l};if(m&&n){o.username=m;o.credential=n;}return [o];}var p=[];for(var q=0;q<l.length;q++)if(m&&n){p.push({url:l[q],username:m,credential:n});}else p.push({url:l[q]});return p;},k={setTurnCredentials:function(l){this.turnIP=l.ip;this.udpPort=l.udp_port;this.tcpPort=l.tcp_port;this.sslPort=l.ssl_tcp_port;this.turnUsername=l.username;this.turnPassword=l.password;},getConfig:function(){var l=j([i]).concat(j(this._turnUrls(),this.turnUsername,this.turnPassword));return {iceServers:l};},getConstraints:function(){return {mandatory:{},optional:[{DtlsSrtpKeyAgreement:'true'}]};},_turnUrls:function(){if(h.isFirefox()&&h.webrtcVersion()<27){return ['turn:'+this.turnIP+':'+this.udpPort];}else return ['turn:'+this.turnIP+':'+this.udpPort+'?transport=udp','turn:'+this.turnIP+':'+this.tcpPort+'?transport=tcp','turn:'+this.turnIP+':'+this.sslPort+'?transport=tcp'];}};f.exports=k;},null);
__d('FBRTCSdpUtils',['UserAgent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='m=video 0',j=function(m){return m.match(/^a=rtpmap:(\d+)\s/)[1];},k=function(m,n,o){var p=j(m[n]),q=m[o].split('RTP/SAVPF'),r=q[1].split(/\s+/),s=r.indexOf(p);r.splice(s,1);q[1]=r.join(' ');m[o]=q.join('RTP/SAVPF');m.splice(n,1);},l={replaceRTPSAVPFProfile:function(m){var n='UDP/TLS/RTP/SAVPF',o='RTP/SAVPF';while(m.indexOf(n)>=0)m=m.replace(n,o);return m;},addIceOptionToSdp:function(m,n){"use strict";var o="a=ice-options:",p=m.indexOf(o);if(p>=0){var q=m.indexOf("\r",p);return [m.slice(0,q)," ",n,m.slice(q)].join('');}var r=o+n,s=m.split("\r\n"),t=false,u=-1;for(var v=0;v<s.length;v++){var w=s[v].slice(0,2);if(w=="s="){t=true;continue;}if(t&&w=="a="){u=v;break;}}if(u>=0){s.splice(u,0,r);return s.join("\r\n");}return [m,r,"\r\n"].join('');},preferIsac:function(m){var n=m.split("\r\n"),o=-1,p=-1,q=-1;for(var r=0;r<n.length;r++){var s=n[r];if(s.match(/m=audio\s+\d+\s+RTP\/SAVPF(\s+\d+)+/))o=r;if(q===-1&&o>-1&&s.match(/^a=rtpmap:/))q=r;if(s.match(/^a=rtpmap:\d+\s+ISAC\/16000/))p=r;}if(o===-1||p===-1||q===-1)return n.join("\r\n");var t=n[p];k(n,p,o);n.splice(q,0,t);n[o]=n[o].replace('RTP/SAVPF','RTP/SAVPF '+j(t));return n.join("\r\n");},disableVideo:function(m){var n=/m=video\s+\S+/;m=m.replace(n,i);if(h.isBrowser('Firefox <= 37'))m=this._makeDisabledVideoReceiveOnly(m);return m;},_makeDisabledVideoReceiveOnly:function(m){if(m.indexOf(i)>-1){var n=m.split(i);n[1]=n[1].replace(/send(recv|only)/,'recvonly');m=n.join(i);}return m;},fixMobileIceSdp:function(m){m=m.replace(/^a=/,'');m=m.split(/\s+username\s+.+password.+/)[0];var n=m.match(/\s+relay\s+|\s+srflx\s+/),o=m.match(/raddr.+rport.+/);if(n&&!o){n=n[0];var p=m.split(n),q=p[1].match(/^(\d+\.\d+\.\d+\.\d+)\s+(\d+)\s+/),r,s;if(q){r=q[1];s=q[2];p[1]=p[1].replace(q[0],'');}else{q=p[0].split(/\s+/);r=q[4];s=q[5];}m=''+p[0]+n+'raddr '+r+' rport '+s+' '+p[1];}return m;},removeFEC:function(m){var n=m.split('\r\n'),o,p;for(var q=0;q<n.length;q++){if(n[q].match(/^a=rtpmap:\d+\s+red\//))o=q;if(n[q].match(/^m=video/))p=q;}if(o&&p)k(n,o,p);return n.join('\r\n');},isVideoSupported:function(m){return (m&&m.indexOf('m=video')>-1&&m.indexOf(i)===-1);},setDtlsRole:function(m,n){if(!m.match(/setup:(active|passive|actpass)/)){return m.replace(/(a=fingerprint:.+)/g,'$1\r\na=setup:'+n);}else return m.replace(/setup:actpass/g,'setup:'+n);},setVideoBitrateConstraint:function(m){var n=720;if(m.match(/^b=AS:/m))return m;m=m.replace(/^a=mid:video\r\n/m,'a=mid:video\r\nb=AS:'+n+'\r\n');return m;},removeSdparta:function(m){var n=m.split('\r\n'),o='audio',p=false,q=-1;for(var r=0;r<n.length;r++){var s=n[r];if(s.indexOf('m=audio')===0)o='audio';if(s.indexOf('m=video')===0){p=true;o='video';}if(s.indexOf('a=mid:sdparta_')===0)n[r]='a=mid:'+o;if(s.indexOf('a=group:BUNDLE sdparta_')===0)q=r;}if(q>-1)if(p){n[q]='a=group:BUNDLE audio video';}else n[q]='a=group:BUNDLE audio';return n.join('\r\n');}};f.exports=l;},null);
__d('FBRTCStatsHelpers',['FBRTCLogger'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function(k){if(k==='host'||k==='local')return 'local';if(k==='serverreflexive')return 'srflx';if(k==='peerreflexive')return 'prflx';if(k==='relayed'||k==='relay')return 'relay';return 'unknown';},j={connectionType:function(k,l,m,n){return ['l:',i(k),'-',l,';','r:',i(m),'-',n].join('');},logReport:function(k){var l=h.getInstance(),m=['connectionType','audioCodec','videoCodec','audioRtt','videoRtt','audioPacketsLost','videoPacketsLost','audioBytesSent','videoBytesSent','audioPacketsSent','videoPacketsSent'];for(var n=0;n<m.length;n++){var o=k[m[n]].call(k);l.logToConsole(m[n]+' => '+o);}}};f.exports=j;},null);
__d('FBRTCChromeStatsReport',['FBRTCStatsHelpers'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=function(k,l){return parseInt(k.stat(l),10);};function j(){'use strict';this.$FBRTCChromeStatsReport1=[];this.$FBRTCChromeStatsReport2=null;this.$FBRTCChromeStatsReport3=null;this.$FBRTCChromeStatsReport4=null;this.$FBRTCChromeStatsReport5=null;this.$FBRTCChromeStatsReport6=null;}j.prototype.parseReport=function(k){'use strict';k.result().forEach((function(l){if(l.type==="googCandidatePair"&&l.stat('googActiveConnection')==='true')this.$FBRTCChromeStatsReport1.push(l);if(this.$FBRTCChromeStatsReport7(l))this.$FBRTCChromeStatsReport2=l;if(this.$FBRTCChromeStatsReport8(l))this.$FBRTCChromeStatsReport3=l;if(this.$FBRTCChromeStatsReport9(l))this.$FBRTCChromeStatsReport4=l;if(this.$FBRTCChromeStatsReport10(l))this.$FBRTCChromeStatsReport5=l;if(l.type==='VideoBwe')this.$FBRTCChromeStatsReport6=l;}).bind(this));};j.prototype.isConnected=function(){'use strict';return true;};j.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'googRtt');};j.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googRtt');};j.prototype.audioCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 'unknown';return this.$FBRTCChromeStatsReport2.stat('googCodecName');};j.prototype.videoCodec=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 'unknown';return this.$FBRTCChromeStatsReport3.stat('googCodecName');};j.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'packetsLost');};j.prototype.setVideoPacketsLost=function(k){'use strict';this.$FBRTCChromeStatsReport11=k;};j.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;if(this.$FBRTCChromeStatsReport11)return this.$FBRTCChromeStatsReport11;return i(this.$FBRTCChromeStatsReport3,'packetsLost');};j.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'bytesSent');};j.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'bytesSent');};j.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport2)return 0;return i(this.$FBRTCChromeStatsReport2,'packetsSent');};j.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'packetsSent');};j.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googFrameRateSent');};j.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCChromeStatsReport3)return 0;return i(this.$FBRTCChromeStatsReport3,'googFrameRateInput');};j.prototype.connectionType=function(){'use strict';var k='unknown',l='unknown',m='unknown';for(var n=0;n<this.$FBRTCChromeStatsReport1.length;n++){var o=this.$FBRTCChromeStatsReport1[n];l=o.stat('googLocalCandidateType');m=o.stat('googRemoteCandidateType');k=o.stat('googTransportType');}return h.connectionType(l,k,m,k);};j.prototype.$FBRTCChromeStatsReport7=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('audioInputLevel')>-1;};j.prototype.$FBRTCChromeStatsReport8=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('googFrameHeightInput')>-1;};j.prototype.$FBRTCChromeStatsReport9=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('audioOutputLevel')>-1;};j.prototype.$FBRTCChromeStatsReport10=function(k){'use strict';return k.type==='ssrc'&&k.names().indexOf('googFrameHeightReceived')>-1;};f.exports=j;},null);
__d('FBRTCMozStatsReport',['Map','FBRTCLogger','FBRTCStatsHelpers'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){'use strict';this.$FBRTCMozStatsReport1=null;this.$FBRTCMozStatsReport2=null;this.$FBRTCMozStatsReport3=null;this.$FBRTCMozStatsReport4=null;this.candidates=new h();this.candidatePairs=new h();this.$FBRTCMozStatsReport5=i.getInstance();}k.prototype.parseReport=function(l){'use strict';l.forEach((function(m){switch(m.type){case 'inboundrtp':if(!m.remoteId)break;var n={inbound:m,outbound:l[m.remoteId]};if(m.isRemote){if(n.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport2=n;}else this.$FBRTCMozStatsReport1=n;}else if(n.outbound.hasOwnProperty('framerateMean')){this.$FBRTCMozStatsReport4=n;}else this.$FBRTCMozStatsReport3=n;break;case 'outboundrtp':break;case 'candidatepair':if(m.state==='succeeded')this.candidatePairs.set(m.id,m);break;case 'localcandidate':this.candidates.set(m.id,m);break;case 'remotecandidate':this.candidates.set(m.id,m);break;default:this.$FBRTCMozStatsReport5.logToConsole('unrecognized webrtc stats type '+m.type);break;}}).bind(this));};k.prototype.isConnected=function(){'use strict';return !!this.$FBRTCMozStatsReport1;};k.prototype.audioRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.mozRtt;};k.prototype.videoRtt=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.mozRtt;};k.prototype.audioCodec=function(){'use strict';return 'opus';};k.prototype.videoCodec=function(){'use strict';return 'VP8';};k.prototype.audioPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.inbound.packetsLost;};k.prototype.setVideoPacketsLost=function(l){'use strict';};k.prototype.videoPacketsLost=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.inbound.packetsLost;};k.prototype.audioBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.bytesSent;};k.prototype.videoBytesSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.bytesSent;};k.prototype.audioPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport1)return 0;return this.$FBRTCMozStatsReport1.outbound.packetsSent;};k.prototype.videoPacketsSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.packetsSent;};k.prototype.videoFrameRateSent=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return this.$FBRTCMozStatsReport2.outbound.framerateMean;};k.prototype.videoFrameRateCaptured=function(){'use strict';if(!this.$FBRTCMozStatsReport2)return 0;return 30;};k.prototype.connectionType=function(){'use strict';var l='unknown',m='unknown',n='unknown',o='unknown';this.candidatePairs.forEach((function(p){var q=this.candidates.get(p.localCandidateId),r=this.candidates.get(p.remoteCandidateId);l=q.transport;n=r.transport;m=q.candidateType;o=r.candidateType;}).bind(this));return j.connectionType(m,l,o,n);};f.exports=k;},null);
__d('FBRTCStatsReportFactory',['FBRTCMozStatsReport','FBRTCChromeStatsReport','FBRTCLogger','FBRTCVersionDetection'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=function(o,p){o.getStats(null,function(q){var r=new h();r.parseReport(q);p(r);},function(){j.getInstance().logToConsole('Firefox stats collection failed');});},m=function(o,p){o.getStats(function(q){var r=new i();r.parseReport(q);p(r);});},n={getStats:function(o,p){if(k.isFirefox())l(o,p);if(k.isChrome())m(o,p);}};f.exports=n;},null);
__d('FBRTCCallConnection',['Base64','FBRTCConfig','FBRTCLogger','FBRTCPCConfig','FBRTCConstants','FBRTCSdpUtils','FBRTCStatsReportFactory','Queue','UserAgent','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=300000,t=12000,u=10000,v='data',w=1000,x=100;function y(){'use strict';this.$FBRTCCallConnection1=j.getInstance();this.$FBRTCCallConnection2();this.$FBRTCCallConnection3=null;this.$FBRTCCallConnection4=null;this.$FBRTCCallConnection5=new o({interval:1,processor:this.$FBRTCCallConnection6.bind(this)});this.$FBRTCCallConnection7=null;this.$FBRTCCallConnection8=null;this.$FBRTCCallConnection9=false;this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection11=[];this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection13='passive';this.$FBRTCCallConnection14=true;this.$FBRTCCallConnection15=0;this.$FBRTCCallConnection16={};this.$FBRTCCallConnection17=null;}y.prototype.init=function(z){'use strict';this.$FBRTCCallConnection1.logToConsole('Creating a new peer connection with: '+JSON.stringify(k.getConfig())+', '+JSON.stringify(k.getConstraints()));this.$FBRTCCallConnection18=z;};y.prototype.setStream=function(z){'use strict';this.$FBRTCCallConnection18=z;};y.prototype.addScreenStream=function(z){'use strict';if(z&&z.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream added');this.$FBRTCCallConnection19=z;}else this.$FBRTCCallConnection1.logToConsole('Trying to add invalid stream');};y.prototype.removeScreenStream=function(z){'use strict';if(z&&z.getStream()){this.$FBRTCCallConnection1.logToConsole('Screen stream removed');this.$FBRTCCallConnection3.removeStream(z.getStream());}else this.$FBRTCCallConnection1.logToConsole('Trying to remove invalid stream');this.$FBRTCCallConnection19=null;};y.prototype.setPeerSupportsVideo=function(z){'use strict';this.$FBRTCCallConnection14=z;};y.prototype.$FBRTCCallConnection20=function(){'use strict';var z={};if(this.$FBRTCCallConnection18&&this.$FBRTCCallConnection18.hasStream()){var aa=this.$FBRTCCallConnection18.hasVideoTracks()?l.StreamType.AUDIO_VIDEO:l.StreamType.AUDIO_ONLY;z[this.$FBRTCCallConnection18.getStreamId()]={type:aa};}if(this.$FBRTCCallConnection19&&this.$FBRTCCallConnection19.hasStream())z[this.$FBRTCCallConnection19.getStreamId()]={type:l.StreamType.SCREEN_CONTENT};return {streams:z};};y.prototype.$FBRTCCallConnection21=function(z){'use strict';this.$FBRTCCallConnection1.logToConsole('Setting new remote attributes: '+JSON.stringify(z));this.$FBRTCCallConnection17=z;};y.prototype.getRemoteAttributesForStream=function(z){'use strict';var aa=z&&this.$FBRTCCallConnection17&&this.$FBRTCCallConnection17.streams;return aa&&aa[z.id];};y.prototype.isScreenStream=function(z){'use strict';var aa=this.getRemoteAttributesForStream(z);if(aa){this.$FBRTCCallConnection1.logToConsole('Stream '+z.id+' type attribute is: '+aa.type);return aa.type===l.StreamType.SCREEN_CONTENT;}else{this.$FBRTCCallConnection1.logToConsole('No attributes found for stream '+z.id);return false;}};y.prototype.getRemoteStreamsCount=function(){'use strict';return this.$FBRTCCallConnection3.getRemoteStreams().length;};y.prototype.$FBRTCCallConnection22=function(z,aa){'use strict';this.$FBRTCCallConnection23(null);z.onaddstream=null;z.onremovestream=null;z.onicecandidate=null;z.oniceconnectionstatechange=null;this.$FBRTCCallConnection11=[];var ba=aa?5000:1;setTimeout(function(){if(z.iceConnectionState!=='closed')z.close();},ba);};y.prototype.$FBRTCCallConnection24=function(){'use strict';if(this.$FBRTCCallConnection3)this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,true);var z=new this.nativePeerConnection(k.getConfig(),k.getConstraints());this.$FBRTCCallConnection13='passive';z.onaddstream=this.$FBRTCCallConnection25.bind(this);z.onremovestream=this.$FBRTCCallConnection26.bind(this);z.onicecandidate=this.$FBRTCCallConnection27.bind(this);z.oniceconnectionstatechange=this.$FBRTCCallConnection28.bind(this);z.addStream(this.$FBRTCCallConnection18.getStream());return z;};y.prototype.$FBRTCCallConnection23=function(z){'use strict';this.$FBRTCCallConnection5.stop(true);if(this.isDataChannelOpen())this.$FBRTCCallConnection4.close();this.$FBRTCCallConnection4=z;if(!z)return;this.$FBRTCCallConnection4.onopen=this.$FBRTCCallConnection29.bind(this);this.$FBRTCCallConnection4.onclose=this.$FBRTCCallConnection30.bind(this);this.$FBRTCCallConnection4.onerror=this.$FBRTCCallConnection31.bind(this);this.$FBRTCCallConnection4.onmessage=this.$FBRTCCallConnection32.bind(this);};y.prototype.$FBRTCCallConnection29=function(event){'use strict';this.$FBRTCCallConnection5.start();this.emit('data_opened',event);};y.prototype.$FBRTCCallConnection30=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_closed',event);};y.prototype.$FBRTCCallConnection31=function(event){'use strict';this.$FBRTCCallConnection23(null);this.emit('data_error',event);};y.prototype.$FBRTCCallConnection32=function(event){'use strict';var z=JSON.parse(event.data);if(z.batchID===undefined){this.emit('data_message',z.data);return;}if(this.$FBRTCCallConnection16[z.batchID]===undefined)this.$FBRTCCallConnection16[z.batchID]=[];var aa=this.$FBRTCCallConnection16[z.batchID];aa.push(z.data);if(!z.isLast)return;var ba=h.decodeObject(aa.join(''));delete this.$FBRTCCallConnection16[z.batchID];this.emit('data_message',ba.data);};y.prototype.isDataChannelOpen=function(){'use strict';return !!this.$FBRTCCallConnection4&&this.$FBRTCCallConnection4.readyState==='open';};y.prototype.sendData=function(z){'use strict';this.$FBRTCCallConnection5.enqueue({data:z});};y.prototype.$FBRTCCallConnection6=function(z){'use strict';if(!this.isDataChannelOpen()){q(0);return;}if(z.batchID!==undefined){this.$FBRTCCallConnection33(z);return;}var aa=JSON.stringify(z);try{this.$FBRTCCallConnection4.send(aa);return;}catch(ba){}if(aa.length<w){setTimeout((function(){this.$FBRTCCallConnection5.enqueue(z);}).bind(this),x);return;}var ca={batchID:this.$FBRTCCallConnection15.toString(),dataStr:h.encode(aa)};this.$FBRTCCallConnection15++;this.$FBRTCCallConnection33(ca);};y.prototype.$FBRTCCallConnection33=function(z){'use strict';while(this.isDataChannelOpen()&&z.dataStr.length>0){var aa={batchID:z.batchID,data:z.dataStr.slice(0,w)},ba=z.dataStr.slice(w);if(ba.length<=0)aa.isLast=true;try{this.$FBRTCCallConnection4.send(JSON.stringify(aa));}catch(ca){setTimeout((function(){this.$FBRTCCallConnection5.enqueue(z);}).bind(this),x);return;}z.dataStr=ba;}};y.prototype.createOffer=function(){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(i.shouldCreateDataChannel())this.$FBRTCCallConnection23(this.$FBRTCCallConnection3.createDataChannel(v));this.$FBRTCCallConnection34('offer');this.$FBRTCCallConnection13='active';};y.prototype.createSdpUpdate=function(){'use strict';var z=this.$FBRTCCallConnection3.getLocalStreams();for(var aa=0;aa<z.length;aa++)this.$FBRTCCallConnection3.removeStream(z[aa]);this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection18.getStream());if(this.$FBRTCCallConnection19)this.$FBRTCCallConnection3.addStream(this.$FBRTCCallConnection19.getStream());this.$FBRTCCallConnection34('sdp_update');};y.prototype.$FBRTCCallConnection34=function(z){'use strict';this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection3.createOffer(this.$FBRTCCallConnection35.bind(this,z),this.$FBRTCCallConnection36.bind(this,'CreateOfferFailed'),this.$FBRTCCallConnection37());};y.prototype.$FBRTCCallConnection37=function(){'use strict';if(p.isBrowser('Chrome <= 37')||p.isBrowser('Opera <= 25'))return {mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:this.$FBRTCCallConnection14}};return {offerToReceiveAudio:true,offerToReceiveVideo:this.$FBRTCCallConnection14};};y.prototype.end=function(){'use strict';this.$FBRTCCallConnection1.logToConsole('Ending connection...');if(this.$FBRTCCallConnection3){this.emit('isEnding');this.$FBRTCCallConnection22(this.$FBRTCCallConnection3,false);this.$FBRTCCallConnection3=null;}};y.prototype.onReceivedOfferSDP=function(z,aa){'use strict';this.$FBRTCCallConnection3=this.$FBRTCCallConnection24();if(i.shouldCreateDataChannel())this.$FBRTCCallConnection3.ondatachannel=(function(event){this.$FBRTCCallConnection23(event.channel);}).bind(this);var ba=new this.nativeSessionDescription({type:'offer',sdp:z});this.$FBRTCCallConnection21(aa);this.$FBRTCCallConnection3.setRemoteDescription(ba,this.$FBRTCCallConnection38.bind(this,ba),this.$FBRTCCallConnection36.bind(this,'SetRemoteOfferFailed'));};y.prototype.onReceivedAnswerSDP=function(z,aa){'use strict';var ba=new this.nativeSessionDescription({type:'answer',sdp:z});this.$FBRTCCallConnection21(aa);this.$FBRTCCallConnection3.setRemoteDescription(ba,this.$FBRTCCallConnection38.bind(this,ba),this.$FBRTCCallConnection36.bind(this,'SetRemoteAnswerFailed'));};y.prototype.onReceivedSdpUpdate=function(z,aa){'use strict';if(this.$FBRTCCallConnection12)setTimeout((function(){this.onReceivedSdpUpdate(z,aa);}).bind(this),200);switch(this.$FBRTCCallConnection3.signalingState){case 'stable':this.$FBRTCCallConnection39(z,'offer',aa);break;case 'have-local-offer':z=m.setDtlsRole(z,this.$FBRTCCallConnection13);this.$FBRTCCallConnection39(z,'answer',aa);break;case 'have-remote-offer':setTimeout((function(){this.onReceivedSdpUpdate(z,aa);}).bind(this),1000);break;case 'have-local-pranswer':case 'have-remote-pranswer':break;case 'closed':break;}};y.prototype.$FBRTCCallConnection39=function(z,aa,ba){'use strict';var ca=new this.nativeSessionDescription({type:aa,sdp:z});this.$FBRTCCallConnection12=true;this.$FBRTCCallConnection21(ba);this.$FBRTCCallConnection3.setRemoteDescription(ca,(function(){this.$FBRTCCallConnection1.logToConsole('sdp update '+ca.type+' set');if(this.$FBRTCCallConnection3&&ca.type==='offer'){this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection35.bind(this,'sdp_update'),this.$FBRTCCallConnection36.bind(this,'CreateSdpUpdateFailed'));}else this.$FBRTCCallConnection12=false;}).bind(this),this.$FBRTCCallConnection36.bind(this,'SetRemoteSdpUpdateFailed'));};y.prototype.onReceivedRemoteIceCandidate=function(z){'use strict';z.sdp=m.fixMobileIceSdp(z.sdp);var aa=new this.nativeIceCandidate({sdpMLineIndex:z.label,candidate:z.sdp,sdpMid:z.sdp_mid});this.$FBRTCCallConnection3.addIceCandidate(aa);};y.prototype.getStats=function(z){'use strict';n.getStats(this.$FBRTCCallConnection3,z);};y.prototype.getCreatedIceCandidates=function(){'use strict';return this.$FBRTCCallConnection11;};y.prototype.$FBRTCCallConnection35=function(z,aa){'use strict';this.$FBRTCCallConnection1.logToConsole('Created '+z+' sdp');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onSDPCreated: pc has been deallocated');return;}if(!this.$FBRTCCallConnection14&&z==='sdp_update')aa.sdp=m.disableVideo(aa.sdp);aa.sdp=m.addIceOptionToSdp(aa.sdp,"fb-force-5245");aa.sdp=m.preferIsac(aa.sdp);aa.sdp=m.removeSdparta(aa.sdp);aa.sdp=m.replaceRTPSAVPFProfile(aa.sdp);this.$FBRTCCallConnection3.setLocalDescription(aa,(function(){this.$FBRTCCallConnection12=false;this.$FBRTCCallConnection1.logToConsole('Local '+z+' set');this.emit('sdpCreated',{type:z,sdp:aa.sdp,attributes:this.$FBRTCCallConnection20()});}).bind(this),this.$FBRTCCallConnection36.bind(this,'SetLocalDescriptionFailed:'+z));};y.prototype.$FBRTCCallConnection38=function(z){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote '+z.type+' set');if(!this.$FBRTCCallConnection3){this.$FBRTCCallConnection1.logToConsole('_onRemoteDescriptionSet: pc has been deallocated');return;}if(z.type==='offer')this.$FBRTCCallConnection3.createAnswer(this.$FBRTCCallConnection35.bind(this,'answer'),this.$FBRTCCallConnection36.bind(this,'CreateAnswerFailed'));this.emit('remoteDescriptionSet');};y.prototype.$FBRTCCallConnection25=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream added');this.emit('remoteStreamAdded',{stream:event.stream});};y.prototype.$FBRTCCallConnection26=function(event){'use strict';this.$FBRTCCallConnection1.logToConsole('Remote stream removed');this.emit('remoteStreamRemoved',{stream:event.stream});};y.prototype.$FBRTCCallConnection27=function(event){'use strict';if(event.candidate){this.$FBRTCCallConnection11.push(event.candidate);this.emit('localIceCandidateCreated',event.candidate);}};y.prototype.$FBRTCCallConnection28=function(event){'use strict';var z=event.target.iceConnectionState;this.$FBRTCCallConnection1.logToConsole('Ice candidate state changed from '+this.$FBRTCCallConnection7+' to '+z);if(z===this.$FBRTCCallConnection7)return;this.$FBRTCCallConnection40();if(this.$FBRTCCallConnection41(z)){if(!this.$FBRTCCallConnection9){this.emit('connected');this.$FBRTCCallConnection9=true;}}else if(z==='disconnected'){this.$FBRTCCallConnection42();}else if(z==='failed')this.$FBRTCCallConnection43();this.$FBRTCCallConnection7=z;};y.prototype.$FBRTCCallConnection41=function(z){'use strict';return z==='completed'||z==='connected';};y.prototype.$FBRTCCallConnection42=function(){'use strict';if(this.$FBRTCCallConnection41(this.$FBRTCCallConnection7)){var z=Date.now();if(this.$FBRTCCallConnection44-z>=s)this.$FBRTCCallConnection10=0;this.$FBRTCCallConnection10=this.$FBRTCCallConnection10+1;this.$FBRTCCallConnection44=z;if(this.$FBRTCCallConnection10>=2)this.emit('connectionUnstable');}var aa=this;this.$FBRTCCallConnection8=setTimeout(function(){aa.emit('disconnected');},t);};y.prototype.$FBRTCCallConnection43=function(){'use strict';var z=this;this.$FBRTCCallConnection8=setTimeout(function(){var aa={details:'Ice candidate state failed',endCallSubreason:'IceFailed'};z.emit('connectionError',aa);},u);};y.prototype.$FBRTCCallConnection40=function(){'use strict';if(this.$FBRTCCallConnection8)clearTimeout(this.$FBRTCCallConnection8);this.$FBRTCCallConnection8=null;};y.prototype.$FBRTCCallConnection36=function(z,aa){'use strict';var ba={details:aa,endCallSubreason:z};this.emit('connectionError',ba);};y.prototype.$FBRTCCallConnection2=function(){'use strict';if(window.webkitRTCPeerConnection){this.$FBRTCCallConnection1.logToConsole('Using Chrome WebRTC APIs...');this.nativePeerConnection=window.webkitRTCPeerConnection;this.nativeIceCandidate=window.RTCIceCandidate;this.nativeSessionDescription=window.RTCSessionDescription;}else{this.$FBRTCCallConnection1.logToConsole('Using Firefox WebRTC APIs...');this.nativePeerConnection=window.mozRTCPeerConnection;this.nativeIceCandidate=window.mozRTCIceCandidate;this.nativeSessionDescription=window.mozRTCSessionDescription;}};r(y,{remoteStreamAdded:true,remoteStreamRemoved:true,sdpCreated:true,localIceCandidateCreated:true,remoteDescriptionSet:true,connected:true,disconnected:true,connectionUnstable:true,connectionError:true,isEnding:true,data_opened:true,data_closed:true,data_error:true,data_message:true});f.exports=y;},null);
__d('FBRTCRttAggregator',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.$FBRTCRttAggregator1=[{count:0,ave:0},{count:0,ave:0},{count:0,ave:0},{count:0,ave:0}];}h.prototype.addRtt=function(i){'use strict';var j=this.$FBRTCRttAggregator1[this.$FBRTCRttAggregator2(i)];j.ave=this.$FBRTCRttAggregator3(j.ave,j.count,i);j.count+=1;};h.prototype.toString=function(){'use strict';return [this.$FBRTCRttAggregator4('50',this.$FBRTCRttAggregator1[0]),this.$FBRTCRttAggregator4('100',this.$FBRTCRttAggregator1[1]),this.$FBRTCRttAggregator4('200',this.$FBRTCRttAggregator1[2]),this.$FBRTCRttAggregator4('0',this.$FBRTCRttAggregator1[3])].join('|');};h.prototype.$FBRTCRttAggregator4=function(i,j){'use strict';return i+'='+j.count+','+Math.round(j.ave);};h.prototype.$FBRTCRttAggregator2=function(i){'use strict';if(i<50)return 0;if(i<100)return 1;if(i<200)return 2;return 3;};h.prototype.$FBRTCRttAggregator3=function(i,j,k){'use strict';return (i*j+k)/(j+1);};f.exports=h;},null);
__d('FBRTCStatsInterpreter',['FBRTCLogger'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};function j(k){'use strict';this.$FBRTCStatsInterpreter1=babelHelpers._extends({},i,k);this.$FBRTCStatsInterpreter2=h.getInstance();this.$FBRTCStatsInterpreter3=0;}j.prototype.interpretStats=function(k,l){'use strict';var m=k.videoRtt(),n=this.$FBRTCStatsInterpreter4(k),o=this.$FBRTCStatsInterpreter5(k,l),p=this.$FBRTCStatsInterpreter6(m,n,o);if(p>=this.$FBRTCStatsInterpreter1.score_threshold&&!this.isNetworkPoor())this.$FBRTCStatsInterpreter3+=1;if(p<this.$FBRTCStatsInterpreter1.score_threshold&&this.$FBRTCStatsInterpreter3>0)this.$FBRTCStatsInterpreter3-=1;};j.prototype.isNetworkPoor=function(){'use strict';return this.$FBRTCStatsInterpreter3>=this.$FBRTCStatsInterpreter1.bad_score_count;};j.prototype.$FBRTCStatsInterpreter6=function(k,l,m){'use strict';return k*this.$FBRTCStatsInterpreter1.rtt_weight+l*this.$FBRTCStatsInterpreter1.frr_weight+m*this.$FBRTCStatsInterpreter1.plr_weight;};j.prototype.$FBRTCStatsInterpreter5=function(k,l){'use strict';var m,n;if(l){m=k.videoPacketsLost()-l.videoPacketsLost();n=k.videoPacketsSent()-l.videoPacketsSent();}else{m=k.videoPacketsLost();n=k.videoPacketsSent();}if(m<0||n===0)return 0;return m/n;};j.prototype.$FBRTCStatsInterpreter4=function(k){'use strict';if(k.videoFrameRateCaptured()===0)return 0;return 1-k.videoFrameRateSent()/k.videoFrameRateCaptured();};f.exports=j;},null);
__d("RingBuffer",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){"use strict";this.$RingBuffer1=i;this.$RingBuffer2=-1;this.$RingBuffer3=[];}h.prototype.add=function(i){"use strict";this.$RingBuffer2=(this.$RingBuffer2+1)%this.$RingBuffer1;this.$RingBuffer3[this.$RingBuffer2]=i;};h.prototype.size=function(){"use strict";return this.$RingBuffer3.length;};h.prototype.head=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer2];};h.prototype.tail=function(){"use strict";if(this.$RingBuffer2===-1)return null;return this.$RingBuffer3[this.$RingBuffer4()];};h.prototype.forEach=function(i){"use strict";for(var j=0;j<this.$RingBuffer3.length;j++){var k=(this.$RingBuffer2+1+j)%this.$RingBuffer3.length;i(this.$RingBuffer3[k]);}};h.prototype.$RingBuffer4=function(){"use strict";return (this.$RingBuffer2+1)%this.$RingBuffer3.length;};f.exports=h;},null);
__d('FBRTCCallConnectionMonitor',['RingBuffer','FBRTCRttAggregator','FBRTCStatsInterpreter','FBRTCConfig','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=3000,n=1,o=0,p=3;function q(r,s){'use strict';this.$FBRTCCallConnectionMonitor1=new j(k.statsInterpreterConfig());this.$FBRTCCallConnectionMonitor2=new i();this.$FBRTCCallConnectionMonitor3=new i();this.$FBRTCCallConnectionMonitor4=r;this.$FBRTCCallConnectionMonitor5=s;this.$FBRTCCallConnectionMonitor6=null;this.$FBRTCCallConnectionMonitor7=[];this.$FBRTCCallConnectionMonitor8=new h(n);this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor4.addListener('connected',this.$FBRTCCallConnectionMonitor10,this);this.$FBRTCCallConnectionMonitor4.addListener('isEnding',this.$FBRTCCallConnectionMonitor11,this);}q.prototype.$FBRTCCallConnectionMonitor10=function(){'use strict';var r=this.$FBRTCCallConnectionMonitor12.bind(this);this.$FBRTCCallConnectionMonitor6=setInterval(r,m);this.$FBRTCCallConnectionMonitor12();};q.prototype.$FBRTCCallConnectionMonitor11=function(){'use strict';if(this.$FBRTCCallConnectionMonitor6!==null){this.$FBRTCCallConnectionMonitor12();clearInterval(this.$FBRTCCallConnectionMonitor6);this.$FBRTCCallConnectionMonitor6=null;}};q.prototype.$FBRTCCallConnectionMonitor12=function(){'use strict';this.$FBRTCCallConnectionMonitor4.getStats((function(r){var s;if(this.$FBRTCCallConnectionMonitor8.size()>0){s=this.$FBRTCCallConnectionMonitor8.head();this.$FBRTCCallConnectionMonitor13(r,s);}if(this.$FBRTCCallConnectionMonitor7.length<o)this.$FBRTCCallConnectionMonitor7.push(r);if(s&&s.isConnected()&&!r.isConnected())this.$FBRTCCallConnectionMonitor9+=1;this.$FBRTCCallConnectionMonitor9>=p;if(r.isConnected()){this.$FBRTCCallConnectionMonitor9=0;this.$FBRTCCallConnectionMonitor8.add(r);this.$FBRTCCallConnectionMonitor2.addRtt(r.audioRtt());this.$FBRTCCallConnectionMonitor3.addRtt(r.videoRtt());this.$FBRTCCallConnectionMonitor5.setPcStats(this.$FBRTCCallConnectionMonitor14());this.$FBRTCCallConnectionMonitor15(r,s);}}).bind(this));};q.prototype.$FBRTCCallConnectionMonitor14=function(){'use strict';var r=this.$FBRTCCallConnectionMonitor8.head();return {end:{conn_type:r.connectionType()},sender:{bytes:r.audioBytesSent(),codec:{'0':r.audioCodec()},plost:r.audioPacketsLost(),psent:r.audioPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor2.toString()},video:{sender:{bytes:r.videoBytesSent(),codec:{'0':r.videoCodec()},plost:r.videoPacketsLost(),psent:r.videoPacketsSent(),rtt:this.$FBRTCCallConnectionMonitor3.toString()}}};};q.prototype.$FBRTCCallConnectionMonitor13=function(r,s){'use strict';if(s.videoPacketsLost()>r.videoPacketsLost())r.setVideoPacketsLost(s.videoPacketsLost());};q.prototype.$FBRTCCallConnectionMonitor15=function(r,s){'use strict';this.$FBRTCCallConnectionMonitor1.interpretStats(r,s);if(this.$FBRTCCallConnectionMonitor1.isNetworkPoor())this.emit('connectionPoor');};l(q,{connectionPoor:true});f.exports=q;},null);
__d('FBRTCFullScreenController',['FBRTCCallControlActions','FBRTCStore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k,l,m,n=document.documentElement;if(n.requestFullscreen){l=n.requestFullscreen.bind(n);m='fullscreenchange';}else if(n.msRequestFullscreen){l=n.msRequestFullscreen.bind(n);m='msfullscreenchange';}else if(n.mozRequestFullScreen){l=n.mozRequestFullScreen.bind(n);m='mozfullscreenchange';}else if(n.webkitRequestFullscreen){l=n.webkitRequestFullscreen.bind(n,Element.ALLOW_KEYBOARD_INPUT);m='webkitfullscreenchange';}var o;if(document.exitFullscreen){o=document.exitFullscreen.bind(document);}else if(document.msExitFullscreen){o=document.msExitFullscreen.bind(document);}else if(document.mozCancelFullScreen){o=document.mozCancelFullScreen.bind(document);}else if(document.webkitExitFullscreen)o=document.webkitExitFullscreen.bind(document);j=babelHelpers.inherits(p,i);k=j&&j.prototype;function p(){'use strict';k.constructor.call(this);this.$FBRTCFullScreenController1=this.$FBRTCFullScreenController2.bind(this);document.addEventListener(m,this.$FBRTCFullScreenController1);}p.prototype.destroy=function(){'use strict';document.removeEventListener(m,this.$FBRTCFullScreenController1);k.destroy.call(this);};p.prototype.$FBRTCFullScreenController2=function(){'use strict';this.__emitChange();};p.prototype.supportsFullScreen=function(){'use strict';return l&&o;};p.prototype.isFullScreen=function(){'use strict';return !!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);};p.prototype.$FBRTCFullScreenController3=function(){'use strict';if(this.isFullScreen()){o();}else l();};p.prototype.__onDispatch=function(q){'use strict';switch(q.type){case h.Types.TOGGLE_FULL_SCREEN:this.$FBRTCFullScreenController3();break;}};f.exports=new p();},null);
__d("XVideoCallUserInfoController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/userinfo\/",{user_id:{type:"Int",required:true}});},null);
__d('FBRTCPeerInfo',['ix','XVideoCallUserInfoController','FBRTCUtils'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this.peerID=l;this.peerPicUrl=null;this.selfPicUrl=h('/images/chat/webrtc/no_profile_pic.png');this.backgroundUrl=null;this.peerName='';this.peerShortName=null;this.isVCEndpoint=j.isVCEndpointCallable(l);}k.prototype.fetch=function(l,m){'use strict';var n=i.getURIBuilder().setInt('user_id',this.peerID).getURI(),o=this;j.sendServerRequest(n,function(p){o.peerPicUrl=p.payload.profile_pic_url;o.backgroundUrl=p.payload.cover_pic_url;o.peerName=p.payload.name;o.peerShortName=p.payload.peer_short_name;if(p.payload.self_profile_pic_url)o.selfPicUrl=p.payload.self_profile_pic_url;if(l)l();},m);};f.exports=k;},null);
__d('FBRTCScreenSharingConstants',['keyMirror'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=h({DIRECT_SENDER:null,DIRECT_RECIPIENT:null,FROM_VIDEO_CALL:null}),j={UITypes:i};f.exports=j;},null);
__d('FBRTCScreenSharingActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({END_SESSION:null,SWITCH_SCREEN:null}),k=i({SDP_CREATED:null,REMOTE_DESCRIPTION_SET:null,LOCAL_ICE_CANDIDATE_CREATED:null,REMOTE_STREAM_ADDED:null,OFFER_ACK:null}),l={ConnectionEventTypes:k,ControlEventTypes:j,endSession:function(){h.dispatch({type:j.END_SESSION});},switchScreen:function(){h.dispatch({type:j.SWITCH_SCREEN});},sdpCreated:function(m){h.dispatch({type:k.SDP_CREATED,description:m});},remoteDescriptionSet:function(){h.dispatch({type:k.REMOTE_DESCRIPTION_SET});},localIceCandidateCreated:function(m){h.dispatch({type:k.LOCAL_ICE_CANDIDATE_CREATED,candidate:m});},remoteStreamAdded:function(m){h.dispatch({type:k.REMOTE_STREAM_ADDED,stream:m});},offerAckReceived:function(){h.dispatch({type:k.OFFER_ACK_RECEIVED});}};f.exports=l;},null);
__d('FBRTCActiveMouseMixin',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=3000,i=[],j=null,k=false;function l(o){m(true);if(j!==null)clearTimeout(j);j=setTimeout(function(){j=null;m(false);},h);}function m(o){if(o===k)return;k=o;i.map(function(p){p(k);});}var n={componentWillMount:function(){if(this.activeMouseCallback){if(i.length==0)window.addEventListener('mousemove',l);i.push(this.activeMouseCallback);}},componentWillUnmount:function(){if(this.activeMouseCallback){var o=i.indexOf(this.activeMouseCallback);if(o>-1)i.splice(o,1);if(i.length==0){if(j!==null)clearTimeout(j);window.removeEventListener('mousemove',l);}}}};f.exports=n;},null);
__d('FBRTCCallControlButton.react',['ReactComponentWithPureRenderMixin','React','cx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=i.PropTypes,m={END:0,FULL_SCREEN:1,MUTE:2,SETTINGS:3,SHARE_SCREEN:4,VIDEO:5},n=i.createClass({displayName:'FBRTCCallControlButton',mixins:[h],propTypes:{active:l.bool,disabled:l.bool,endButton:l.bool,highlighted:l.bool,iconType:l.number.isRequired,onClick:l.func.isRequired,ref:l.string,title:l.string},defaultProps:function(){return {active:false,disabled:false,endButton:false,highlighted:false};},render:function(){var o="_5lms"+(this.props.highlighted?' '+"_5lmy":'')+(this.props.endButton?' '+"_5lmz":''),p=this.props,q=p.iconType,r=p.active,s=p.disabled;return (i.createElement('button',{onClick:this.props.disabled?k:this.props.onClick,className:o,ref:this.props.ref,'data-testid':this.props['data-testid'],title:this.props.title,tabIndex:'0',role:'button','aria-label':this.props.title,'data-hover':s?undefined:'tooltip','data-tooltip-alignh':'center'},this._icon(q,!!r,!!s)));},_icon:function(o,p,q){if(p)return (i.createElement('i',{className:"_5ln2"+(o===m.END?' '+"_5ln3":'')+(o===m.FULL_SCREEN?' '+"_5lng":'')+(o===m.MUTE?' '+"_5lnh":'')+(o===m.SETTINGS?' '+"_5lni":'')+(o===m.SHARE_SCREEN?' '+"_5lnj":'')+(o===m.VIDEO?' '+"_5lnk":'')}));return (i.createElement('i',{className:"_5ln2"+(q?' '+"_5h3-":'')+(o===m.END?' '+"_5ln3":'')+(o===m.FULL_SCREEN?' '+"_5lnl":'')+(o===m.MUTE?' '+"_5lnm":'')+(o===m.SETTINGS?' '+"_5lni":'')+(o===m.SHARE_SCREEN?' '+"_5lnn":'')+(o===m.VIDEO?' '+"_5lnp":'')}));}});n.IconTypes=m;f.exports=n;},null);
__d('FBRTCScreenSharingControls.react',['FBRTCActiveMouseMixin','FBRTCCallControlButton.react','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=l.PropTypes,p=l.createClass({displayName:'FBRTCScreenSharingControls',mixins:[h],propTypes:{uiType:o.string,canSwitchScreens:o.bool.isRequired},activeMouseCallback:function(q){this.setState({mouseActive:q});},getDefaultProps:function(){return {uiType:k.UITypes.DIRECT_SENDER};},getInitialState:function(){return {mouseActive:true};},_endSession:function(){j.endSession();},_switchScreen:function(){j.switchScreen();},render:function(){return (l.createElement('div',{className:"_4bbt"},l.createElement('div',{className:this._wrapperClasses()},this._endSessionButton(),this._switchScreenButton())));},_endSessionButton:function(){var q=n._("End screen share");return (l.createElement(i,{endButton:true,title:q,iconType:i.IconTypes.END,onClick:this._endSession}));},_switchScreenButton:function(){if(this.props.canSwitchScreens){var q=n._("Share new screen");return (l.createElement(i,{iconType:i.IconTypes.SHARE_SCREEN,title:q,onClick:this._switchScreen}));}},_wrapperClasses:function(){var q=this._isSender()?true:this.state.mouseActive;return "_4bbx"+(q?' '+"_4bbz":'');},_isSender:function(){return this.props.uiType===k.UITypes.DIRECT_SENDER;}});f.exports=p;},null);
__d('FBRTCStreamWrapper',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=100,k=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,l;function m(){'use strict';this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=m.aspectRatios.other;this.videoWidth=0;this.videoHeight=0;}m.prototype.setStream=function(n){'use strict';var o=arguments.length<=1||arguments[1]===undefined?true:arguments[1],p=this.hasStream();this.stop();this.$FBRTCStreamWrapper3=n;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(o){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(p)this.emit('tracksChanged');}};m.prototype.getStreamId=function(){'use strict';return this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.id;};m.prototype.getStream=function(){'use strict';return this.$FBRTCStreamWrapper3;};m.prototype.hasStream=function(){'use strict';return !!this.$FBRTCStreamWrapper3;};m.prototype.stop=function(){'use strict';if(this.$FBRTCStreamWrapper3){m.stopStream(this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper3=null;}};m.prototype.hasVideoTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.hasOwnProperty(this.$FBRTCStreamWrapper3.getVideoTracks))return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true;};m.prototype.hasVideo=function(){'use strict';return this.$FBRTCStreamWrapper2&&this.hasVideoTracks();};m.prototype.hasAudioTracks=function(){'use strict';if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true;};m.prototype.hasAudio=function(){'use strict';return this.$FBRTCStreamWrapper1&&this.hasAudioTracks();};m.prototype.attachToVideoTag=function(n){'use strict';if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=n;i.attachMediaStream(n,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(n);}};m.prototype.getAudioAnalyser=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper10(),o=n.createMediaStreamSource(this.$FBRTCStreamWrapper3),p=n.createAnalyser();p.fftSize=2048;o.connect(p);return p;}};m.prototype.$FBRTCStreamWrapper10=function(){'use strict';if(!l)l=new k();return l;};m.prototype.toggleMuteAudio=function(){'use strict';if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5();};m.prototype.$FBRTCStreamWrapper5=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper3.getAudioTracks();for(var o=0;o<n.length;o++)n[o].enabled=this.$FBRTCStreamWrapper1;}};m.prototype.toggleMuteVideo=function(){'use strict';this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2){this.$FBRTCStreamWrapper6();}else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7();};m.prototype.$FBRTCStreamWrapper6=function(){'use strict';if(this.$FBRTCStreamWrapper3){var n=this.$FBRTCStreamWrapper3.getVideoTracks();for(var o=0;o<n.length;o++)n[o].enabled=this.$FBRTCStreamWrapper2;}};m.prototype.setVideoEnabled=function(n){'use strict';this.$FBRTCStreamWrapper2=n;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7();};m.prototype.$FBRTCStreamWrapper9=function(n){'use strict';if(!this.hasVideo()||n.currentTime>0){this.$FBRTCStreamWrapper11(n);}else setTimeout(this.$FBRTCStreamWrapper9.bind(this,n),j);};m.prototype.$FBRTCStreamWrapper12=function(n){'use strict';this.videoWidth=n.videoWidth;this.videoHeight=n.videoHeight;var o=n.videoWidth/n.videoHeight;if(i.aboutEqual(o,16/9))return m.aspectRatios['16:9'];if(i.aboutEqual(o,4/3))return m.aspectRatios['4:3'];return m.aspectRatios.other;};m.prototype.$FBRTCStreamWrapper11=function(n){'use strict';if(this.hasVideo()){this.aspectRatio=this.$FBRTCStreamWrapper12(n);}else this.aspectRatio=m.aspectRatios.other;this.emit('streamStarted');};m.prototype.$FBRTCStreamWrapper8=function(){'use strict';this.emit('streamEnded');};m.prototype.$FBRTCStreamWrapper7=function(event){'use strict';if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit('tracksChanged');};m.prototype.$FBRTCStreamWrapper13=function(n){'use strict';return this.$FBRTCStreamWrapper4&&n&&n.type==='addtrack'&&n.track.kind==='video';};m.aspectRatios={'16:9':1,'4:3':2,other:3};h(m,{streamStarted:true,streamEnded:true,tracksChanged:true});m.stopStream=function(n){if('active' in n){if(n.active)n.getTracks().forEach(function(o){o.stop();});}else if('stop' in n)n.stop();};f.exports=m;},null);
__d('FBRTCScreenStreamWrapper',['FBRTCStreamWrapper'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j;'use strict';i=babelHelpers.inherits(k,h);j=i&&i.prototype;k.prototype.toggleMuteAudio=function(){return;};k.prototype.toggleMuteVideo=function(){return;};function k(){i.apply(this,arguments);}f.exports=k;},null);
__d('FBRTCVideo.react',['React','ReactDOM','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=h.createClass({displayName:'FBRTCVideo',hideContextMenu:function(m){m.preventDefault();},componentDidMount:function(){this._attachStream();},shouldComponentUpdate:function(m,n){return this._streamDidChange();},componentDidUpdate:function(m,n){this._attachStream();},_attachStream:function(){if(this.props.stream){var m=i.findDOMNode(this);this.props.stream.attachToVideoTag(m);this._currentStream=this.props.stream.getStream();}},_streamDidChange:function(){var m=this.props.stream?this.props.stream.getStream():null;return m!==this._currentStream;},render:function(){return (h.createElement('video',{className:k(this.props.className,"_4bad"),autoPlay:'true',muted:this.props.muted,onContextMenu:this.hideContextMenu}));}});f.exports=l;},null);
__d('FBRTCScreenSharingView.react',['FBRTCCallControlActions','FBRTCScreenSharingConstants','FBRTCScreenStreamWrapper','FBRTCScreenSharingControls.react','FBRTCVideo.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=m.PropTypes,p=m.createClass({displayName:'FBRTCScreenSharingView',propTypes:{canSwitchScreens:o.bool.isRequired,isStandalone:o.bool,screenStream:o.instanceOf(j),screenSrc:o.string,uiType:o.string},getDefaultProps:function(){return {isStandalone:false,uiType:i.UITypes.FROM_VIDEO_CALL,showOverlay:false};},render:function(){var q=this.props.isStandalone,r=this.props.screenStream,s=this.props.screenSrc;if(r&&r.hasStream()){return (m.createElement('div',{className:this._baseClasses()},this._renderOpenInNewButton(),this._renderDirectScreenSharingButtons(),m.createElement('div',{className:this._wrapperClass()},m.createElement(l,{className:"_3pb5 _4bad",stream:r}))));}else if(q&&s){return this._renderStandalone(s);}else return m.createElement('div',{className:"_2uql"});},_baseClasses:function(){return "_2uqm"+(this.props.isStandalone?' '+"_2uqn":'');},_buttonClasses:function(){return "_2uqo";},_buttonIconClasses:function(){return "_2uqp";},_wrapperClass:function(){return "_2uqq"+(this.props.showOverlay?' '+"_1k3o":'');},_renderOpenInNewButton:function(){if(!this.props.isStandalone)return (m.createElement('button',{className:this._buttonClasses(),onClick:h.openScreenInNewWindow},m.createElement('i',{className:this._buttonIconClasses()})));},_renderDirectScreenSharingButtons:function(){if(this._isDirect())return (m.createElement(k,{canSwitchScreens:this.props.canSwitchScreens,uiType:this.props.uiType}));},_isSender:function(){return this.props.uiType===i.UITypes.DIRECT_SENDER;},_isRecipient:function(){return this.props.uiType===i.UITypes.DIRECT_RECIPIENT;},_isDirect:function(){return this._isSender()||this._isRecipient();},_renderStandalone:function(q){return (m.createElement('div',{className:this._baseClasses()},m.createElement('div',{className:this._wrapperClass()},m.createElement('video',{className:"_3pb5 _4bad",autoPlay:'true',muted:false,onContextMenu:function(r){r.preventDefault();},src:decodeURIComponent(q)}))));}});f.exports=p;},null);
__d("XScreenSharingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/screen_sharing\/",{peer_id:{type:"Int",required:true}});},null);
__d('FBRTCScreenSharingUI',['FBRTCCallControlActions','FBRTCDispatcher','FBRTCScreenSharingActions','FBRTCScreenSharingConstants','FBRTCScreenSharingView.react','FBRTCScreenStreamWrapper','FBRTCUtils','React','ReactDOM','XScreenSharingController'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=false,s=null,t=null,u=false,v='FBRTCScreenSharingView/container',w={open:function(x,y,z){u=false;var aa=this._getUnsignedUri(z),ba=x===k.UITypes.DIRECT_SENDER;if(s){s.location.href=aa.toString();}else s=this._openWindow(aa.toString(),ba);if(ba)r=!n.isCollabCallable(z);if(s)this._renderView(y,5,x,ba);},close:function(){if(s){var x=null;if(s.opener&&!s.opener.closed)x=s.opener;s.close();s=null;if(x)x.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_RESET_PORT',text:'reset comm port'},'*');}},switchScreen:function(x,y){this._renderView(y,5,x);},hideRingingOverlay:function(){if(!t)return;t=p.render(o.createElement(l,babelHelpers._extends({},t.props,{showOverlay:false})),w._getContainerNode());},isOpen:function(){return s!==null;},openTempWindow:function(){s=this._openWindow('',true);},_openWindow:function(x,y){var z=this._windowPosition(y),aa=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',z.height,z.width,z.top,z.left].join(','),ba=window.open(x,'Screen Sharing',aa);if(window.focus)ba.focus();return ba;},_onUnload:function(x,y){if(this._isDirect(x)){j.endSession();}else{w.close();i.dispatch({type:h.Types.CLOSE_STANDALONE_SCREEN});}},_getContainerNode:function(){if(!s)return null;return s.document.getElementById(v);},_renderView:function(x,y,z){var aa=arguments.length<=3||arguments[3]===undefined?false:arguments[3];setTimeout((function(){setTimeout((function(){if(s!==null){var ba=w._getContainerNode();if(ba){t=p.render(o.createElement(l,{isStandalone:true,uiType:z,screenStream:x,canSwitchScreens:r,showOverlay:aa}),ba);u=true;s.onunload=this._onUnload.bind(this,z);}}}).bind(this),1);if(y>1&&!u){this._renderView(x,y-1,z,aa);}else u=false;}).bind(this),500);},_isDirect:function(x){return x===k.UITypes.DIRECT_RECIPIENT||x===k.UITypes.DIRECT_SENDER;},_windowPosition:function(x){var y=screen.availLeft,z=screen.availTop,aa=x?448:960,ba=x?252:540,ca=Math.min(aa,screen.width-y),da=Math.min(ba,screen.height-z);return {height:'height='+da.toString(),width:'width='+ca.toString(),top:'top='+z.toString(),left:'left='+y.toString()};},_getUnsignedUri:function(x){return q.getURIBuilder().setInt('peer_id',x).getURI();}};f.exports=w;},null);
__d('FBRTCVideoDurationTracker',['performanceNow'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=0;function j(k){this.$FBRTCVideoDurationTracker1=k;this.$FBRTCVideoDurationTracker2=0;this.$FBRTCVideoDurationTracker3=i;}j.prototype.startTracking=function(){if(this.$FBRTCVideoDurationTracker1.hasVideo())this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker4();this.$FBRTCVideoDurationTracker5=this.$FBRTCVideoDurationTracker1.addListener('tracksChanged',(function(){if(this.$FBRTCVideoDurationTracker1.hasVideo()&&!this.$FBRTCVideoDurationTracker3){this.$FBRTCVideoDurationTracker3=this.$FBRTCVideoDurationTracker4();}else if(!this.$FBRTCVideoDurationTracker1.hasVideo()){this.$FBRTCVideoDurationTracker2=this.getDuration();this.$FBRTCVideoDurationTracker3=i;}}).bind(this));};j.prototype.stopTracking=function(){this.$FBRTCVideoDurationTracker2=this.getDuration();this.$FBRTCVideoDurationTracker3=i;if(this.$FBRTCVideoDurationTracker5){this.$FBRTCVideoDurationTracker5.remove();this.$FBRTCVideoDurationTracker5=null;}};j.prototype.getDuration=function(){if(this.$FBRTCVideoDurationTracker3!==i){var k=this.$FBRTCVideoDurationTracker4()-this.$FBRTCVideoDurationTracker3;return this.$FBRTCVideoDurationTracker2+k;}return this.$FBRTCVideoDurationTracker2;};j.prototype.$FBRTCVideoDurationTracker4=function(){return h();};f.exports=j;},null);
__d('FBRTCCallModel',['FBRTCAdminMessage','FBRTCCallConstants','FBRTCCallControlActions','FBRTCConfig','FBRTCFullScreenController','FBRTCLogger','FBRTCPCConfig','FBRTCPeerInfo','FBRTCScreenSharingConstants','FBRTCScreenSharingUI','FBRTCStore','FBRTCStreamWrapper','FBRTCStruct','FBRTCUtils','FBRTCVideoDurationTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w,x;w=babelHelpers.inherits(y,r);x=w&&w.prototype;function y(z){'use strict';x.constructor.call(this);this.$FBRTCCallModel1=m.getInstance();this.isCaller=z.isCaller;this.peerID=z.peerID;this.$FBRTCCallModel2=new o(z.peerID);this.$FBRTCCallModel3=false;this.$FBRTCCallModel4(z.callID);this.$FBRTCCallModel5();this.$FBRTCCallModel6(true);if(this.$FBRTCCallModel2)this.isVCEndpointCall=this.$FBRTCCallModel2.isVCEndpoint;}y.prototype.resetForReconnect=function(z){'use strict';this.isCaller=false;this.$FBRTCCallModel4(z);this.$FBRTCCallModel6(false);};y.prototype.fetchPeerInfo=function(){'use strict';if(u.isGroupCallable(this.peerID))return;var z=this,aa=function(){z.isVCEndpointCall=z.$FBRTCCallModel2.isVCEndpoint;z.__emitChange();},ba=function(){z.$FBRTCCallModel1.logError(z.peerID,z.callID,'Failed to get remote photos');};this.$FBRTCCallModel2.fetch(aa,ba);};y.prototype.setSignalingExperiments=function(z){'use strict';if(z||z===[])this.$FBRTCCallModel7=z;};y.prototype.supportsSdpUpdate=function(){'use strict';return this.$FBRTCCallModel7.indexOf('sdp_update')>-1&&k.supportedSignalingExperiments().indexOf('sdp_update')>-1;};y.prototype.canPeerReceiveScreenSharing=function(){'use strict';return this.$FBRTCCallModel7.indexOf('screen_sharing')>-1;};y.prototype.onSDPMessageFromPeer=function(z){'use strict';this.isRemoteVideoSupported=z.isRemoteVideoSupported();this.isPeerOnMobile=z.isFromMobile();if(!this.isRemoteVideoSupported)this.localStream.setVideoEnabled(false);};y.prototype.$FBRTCCallModel5=function(){'use strict';this.remoteStream=new s();this.localStream=new s();this.localStream.addListener('tracksChanged',(function(){if(!this.$FBRTCCallModel8&&this.localStream.hasVideo())this.$FBRTCCallModel9=true;this.__emitChange();}).bind(this));this.$FBRTCCallModel10=new v(this.remoteStream);this.$FBRTCCallModel11=new v(this.localStream);};y.prototype.$FBRTCCallModel4=function(z){'use strict';this.callID=z;this.$FBRTCCallModel12=new h(this.peerID,z);this.startTime=new Date();this.endCallReason=null;this.isRemoteEnded=null;this.wasConnected=false;this.receivedNack=false;this.isRemoteVideoSupported=true;this.isPeerOnMobile=false;this.$FBRTCCallModel13=null;this.$FBRTCCallModel8=true;this.$FBRTCCallModel9=false;this.$FBRTCCallModel7=[];this.$FBRTCCallModel14=null;};y.prototype.$FBRTCCallModel6=function(z){'use strict';this.selfViewOpen=true;this.uiState=y.UIState.INIT;this.__emitChange();};y.prototype.getLocalVideoDuration=function(){'use strict';return this.$FBRTCCallModel11.getDuration();};y.prototype.getRemoteVideoDuration=function(){'use strict';return this.$FBRTCCallModel10.getDuration();};y.prototype.setLocalStream=function(z){'use strict';this.localStream.setStream(z);};y.prototype.setLocalScreenStream=function(z){'use strict';this.$FBRTCCallModel3=z!==null;this.selfViewOpen=true;this.$FBRTCCallModel13=z;this.__emitChange();};y.prototype.getLocalScreenStream=function(){'use strict';return this.$FBRTCCallModel13;};y.prototype.setRemoteStream=function(z){'use strict';this.remoteStream.setStream(z);this.remoteStream.once('streamStarted',(function(){this.setStateFrom(y.UIState.CALL_CONNECTING,y.UIState.CALL_CONNECTED);}).bind(this));this.remoteStream.addListener('tracksChanged',(function(){this.__emitChange();}).bind(this));this.__emitChange();};y.prototype.setRemoteScreenStream=function(z){'use strict';this.$FBRTCCallModel14=z;this.__emitChange();};y.prototype.getRemoteScreenStream=function(){'use strict';return this.$FBRTCCallModel14;};y.prototype.canStartCall=function(){'use strict';return this.localStream.hasStream()&&n.turnIP;};y.prototype.isAwaitingUserStart=function(){'use strict';return this.uiState===y.UIState.AWAITING_USER_START;};y.prototype.canBeStartedByParentWindow=function(){'use strict';return this.uiState===y.UIState.INIT;};y.prototype.isInProgress=function(){'use strict';return this.uiState>=y.UIState.CONTACTING&&this.uiState<y.UIState.CALL_ENDED;};y.prototype.isUserMediaPending=function(){'use strict';return this.uiState===y.UIState.PENDING_LOCAL_MEDIA;};y.prototype.isUserMediaDenied=function(){'use strict';return this.uiState===y.UIState.USER_MEDIA_DENIED;};y.prototype.isConnected=function(){'use strict';return this.uiState===y.UIState.CALL_CONNECTED;};y.prototype.isRemoteVideoActive=function(){'use strict';return this.uiState===y.UIState.CALL_CONNECTED&&this.remoteStream.hasVideo();};y.prototype.isEnded=function(){'use strict';return this.uiState>=y.UIState.CALL_ENDED;};y.prototype.isAwaitingAnswer=function(){'use strict';return this.uiState==y.UIState.CONTACTING||this.uiState==y.UIState.RINGING;};y.prototype.isFullScreen=function(){'use strict';return l.isFullScreen();};y.prototype.isScreenSharingEnabled=function(){'use strict';return this.$FBRTCCallModel3;};y.prototype.peerPicUrl=function(){'use strict';return this.$FBRTCCallModel2.peerPicUrl;};y.prototype.selfPicUrl=function(){'use strict';return this.$FBRTCCallModel2.selfPicUrl;};y.prototype.backgroundUrl=function(){'use strict';return this.$FBRTCCallModel2.backgroundUrl;};y.prototype.peerName=function(){'use strict';return this.$FBRTCCallModel2.peerName;};y.prototype.peerShortName=function(){'use strict';if(this.$FBRTCCallModel2.peerShortName)return this.$FBRTCCallModel2.peerShortName;return this.$FBRTCCallModel2.peerName;};y.prototype.autoDisableVideo=function(){'use strict';if(this.$FBRTCCallModel8){this.$FBRTCCallModel8=false;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.AUTO_DISABLE_VIDEO);this.localStream.setVideoEnabled(false);}};y.prototype.videoIsAutoDisabled=function(){'use strict';return !this.$FBRTCCallModel8&&!this.$FBRTCCallModel9&&!this.localStream.hasVideo();};y.prototype.$FBRTCCallModel15=function(){'use strict';this.localStream.toggleMuteAudio();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_MUTE,!this.localStream.hasAudio()?'true':'false');this.__emitChange();};y.prototype.$FBRTCCallModel16=function(z){'use strict';this.localStream.toggleMuteVideo();this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_VIDEO_ON,this.localStream.hasVideo());this.__emitChange();};y.prototype.toggleSelfView=function(){'use strict';this.selfViewOpen=!this.selfViewOpen;this.$FBRTCCallModel1.logCallAction(this.peerID,this.callID,m.CallAction.SET_SELF_VIEW_ON,!this.selfViewOpen?'true':'false');this.__emitChange();};y.prototype.setState=function(z){'use strict';if(z===this.uiState)return;var aa=this.uiState;this.uiState=z;switch(z){case y.UIState.CALL_CONNECTED:this.wasConnected=true;this.$FBRTCCallModel12.onCallConnected();this.$FBRTCCallModel10.startTracking();this.$FBRTCCallModel11.startTracking();break;case y.UIState.CALL_ENDED:this.$FBRTCCallModel12.onCallEnded();this.$FBRTCCallModel10.stopTracking();this.$FBRTCCallModel11.stopTracking();if(this.isCaller&&aa>y.UIState.MORE_INIT){var ba=this.isRemoteVideoSupported?i.FBRTCCallType.VIDEO_CALL:i.FBRTCCallType.VOICE_CALL;this.$FBRTCCallModel12.submit(ba,this.endCallReason);}break;}this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: state change - "'+y.UIState.strNames[aa]+'" to "'+y.UIState.strNames[z]+'"');this.__emitChange();};y.prototype.setStateFrom=function(z,aa){'use strict';if(this.uiState===z){this.setState(aa);}else this.$FBRTCCallModel1.logInfo(this.peerID,this.callID,'UI: Not at "'+y.UIState.strNames[z]+'", not moving to "'+y.UIState.strNames[aa]+'"');};y.prototype.__onDispatch=function(z){'use strict';switch(z.type){case j.Types.TOGGLE_MUTE_AUDIO:this.$FBRTCCallModel15();break;case j.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCCallModel16();break;case j.Types.CLOSE_STANDALONE_SCREEN:this.__emitChange();break;case j.Types.TOGGLE_SELF_VIEW:this.toggleSelfView();break;case j.Types.OPEN_SCREEN_IN_NEW:q.open(p.UITypes.FROM_VIDEO_CALL,this.$FBRTCCallModel14,this.peerID);this.__emitChange();break;}};y.UIState=new t(['INIT','AWAITING_USER_START','PENDING_LOCAL_MEDIA','USER_MEDIA_DENIED','MORE_INIT','CONTACTING','RINGING','CALL_CONNECTING','CALL_CONNECTED','CALL_ENDED','COLLECT_RATING']);f.exports=y;},null);
__d('FBRTCDialog.react',['MessengerDialog.react','XUIDialog.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogBody.react',['MessengerDialogBody.react','XUIDialogBody.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogFooter.react',['MessengerDialogFooter.react','XUIDialogFooter.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();f.exports=j.isMessengerDotCom()?h:i;},null);
__d('FBRTCDialogTitle.react',['FBRTCConfig','MessengerDialogTitle.react','MessengerDialogHeader.react','ReactComponentWithPureRenderMixin','React','XUIDialogTitle.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=l.PropTypes,o=l.createClass({displayName:'FBRTCDialogTitle',mixins:[k],propTypes:{showCloseButton:n.bool.isRequired},render:function(){var p=this.props,q=p.className,r=p.showCloseButton,s=babelHelpers.objectWithoutProperties(p,['className','showCloseButton']);if(h.isMessengerDotCom())return (l.createElement(j,null,l.createElement(i,babelHelpers._extends({className:q,showCloseButton:r},s),this.props.children)));return (l.createElement(m,babelHelpers._extends({className:q,showCloseButton:r},s),this.props.children));}});f.exports=o;},null);
__d('FBRTCMediaAccessErrorDialog.react',['React','fbt','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=h.createClass({displayName:'FBRTCMediaAccessErrorDialog',render:function(){return (h.createElement(k,{shown:true,width:440,layerHideOnBlur:false},h.createElement(n,{showCloseButton:false},h.createElement('span',null,i._("Can't Make Call"))),h.createElement(l,null,this._dialogBody()),h.createElement(m,{leftContent:this._footerContent()})));},_dialogBody:function(){return (h.createElement('p',null,i._("Connect a camera and a microphone to make a call. If they're already connected, try restarting your browser and closing any other applications that use a camera or microphone.")));},_footerContent:function(){return (h.createElement('span',null,i._("Still need help? See our {troubleShootingGuideLink}",[i.param('troubleShootingGuideLink',h.createElement(j,{href:o.userMediaErrorUrl(),target:'_blank'},i._("Troubleshooting Guide")))])));}});f.exports=p;},null);
__d('FBRTCPeerBrowserUnsupportedDialog.react',['React','fbt','Link.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=h.createClass({displayName:'FBRTCPeerBrowserUnsupportedDialog',render:function(){return (h.createElement(k,{shown:true,width:440},h.createElement(n,{showCloseButton:false},h.createElement('span',null,i._("Can't Connect Call"))),h.createElement(l,null,this._dialogBody()),h.createElement(m,{leftContent:this._footerContent()})));},_dialogBody:function(){var q=this.props.peerName;return (h.createElement('p',null,i._("{name} isn't using a browser that supports video calling yet.",[i.param('name',q)])));},_footerContent:function(){return (h.createElement('span',null,i._("Still need help? See our {troubleShootingGuideLink}",[i.param('troubleShootingGuideLink',h.createElement(j,{href:o.unsupportedBrowserUrl(),target:'_blank'},i._("Troubleshooting Guide")))])));}});f.exports=p;},null);
__d('FBRTCScreenSharingInstallExtensionDialog.react',['React','FBRTCCallControlActions','FBRTCLogger','FBRTCScreenSharingLogger','LinkshimCallsites','ScreenSharingWebDriverIDs','URI','FBRTCDialogFooter.react','LinkshimLink.react','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=h.PropTypes,x='https://chrome.google.com/webstore/detail/degmgkchmbgaognjjlhggmhbcpicdifm',y=h.createClass({displayName:'FBRTCScreenSharingInstallExtensionDialog',propTypes:{onToggle:w.func.isRequired,peerID:w.number.isRequired,sessionID:w.number.isRequired},componentDidMount:function(){k.getInstance().logAction(this.props.peerID,this.props.sessionID,k.Action.SCREEN_SHARING_EXT_DIALOG,false);},render:function(){return (h.createElement(q,{shown:true,width:440,layerHideOnBlur:false},h.createElement(u,{showCloseButton:true},h.createElement('span',null,v._("Please Install Screen Sharing Extension"))),h.createElement(r,{'data-testid':m.INSTALL_EXT_DIALOG},this._dialogBody()),h.createElement(o,null,h.createElement(t,null),h.createElement(s,{label:v._("Call Again"),use:'confirm',onClick:this._onResetCall}))));},_dialogBody:function(){return (h.createElement('div',null,h.createElement('p',null,v._("To share your screen, you'll need to install an extension. Then you can return here to start your call again.")),h.createElement(p,{uri:new n(x),callsite:l.THIRD_PARTY_URL,target:'_blank',onClick:this._onExtLinkClick},v._("Install Screen Sharing Extension"))));},_onExtLinkClick:function(){k.getInstance().logAction(this.props.peerID,this.props.sessionID,k.Action.SCREEN_SHARING_EXT_LINK,false);},_onResetCall:function(){i.resetCall(j.Trigger.RESET_CALL);}});f.exports=y;},null);
__d('FBRTCScreenSharingModel',['Event','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper','FBRTCStore'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l,m;'use strict';l=babelHelpers.inherits(n,k);m=l&&l.prototype;function n(o,p){m.constructor.call(this);this.$FBRTCScreenSharingModel1=null;this.$FBRTCScreenSharingModel2=new j();this.$FBRTCScreenSharingModel3=i.getInstance();this.$FBRTCScreenSharingModel4=o;this.$FBRTCScreenSharingModel5=p;}n.prototype.isEnabled=function(){return !!this.$FBRTCScreenSharingModel1;};n.prototype.setStream=function(o){var p=arguments.length<=1||arguments[1]===undefined?false:arguments[1],q=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(o&&(!p||q))h.listen(o.getVideoTracks()[0],'ended',this.__emitChange.bind(this));if(this.$FBRTCScreenSharingModel2===null)this.$FBRTCScreenSharingModel2=new j();this.$FBRTCScreenSharingModel2.setStream(o,!p);};n.prototype.getStream=function(){return this.$FBRTCScreenSharingModel2;};n.prototype.getPeerID=function(){return this.$FBRTCScreenSharingModel4;};n.prototype.getSessionID=function(){return this.$FBRTCScreenSharingModel5;};n.prototype.onStart=function(o){if(!o){this.$FBRTCScreenSharingModel3.logToConsole(null,null,'Invalid stream id');return;}this.$FBRTCScreenSharingModel3.logToConsole(null,null,'Enabling screen sharing');this.$FBRTCScreenSharingModel1=o;};n.prototype.onStop=function(){this.$FBRTCScreenSharingModel1=null;if(this.$FBRTCScreenSharingModel2)this.$FBRTCScreenSharingModel2.stop();};n.prototype.__onDispatch=function(o){};f.exports=n;},null);
__d('FBRTCScreenSharingUnsupportedBrowserDialog.react',['React','Image.react','Link.react','Layout.react','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','XUIText.react','FBRTCVersionDetection','cx','fbt','ix'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=k.Column,u=h.createClass({displayName:'FBRTCScreenSharingUnsupportedBrowserDialog',render:function(){return (h.createElement(l,{shown:true,width:440,layerHideOnBlur:false},h.createElement(n,{showCloseButton:true},this._title()),h.createElement(m,null,this._dialogBody(),this._installLinks())));},_title:function(){var v=null;if(p.isChrome()){v=r._("Update Browser to Share Your Screen");}else v=r._("Switch Browsers to Share Your Screen");return (h.createElement('span',null,v));},_dialogBody:function(){var v=null;if(p.isChrome()){v=this._updateBrowserMessage();}else v=this._switchBrowserMessage();return (h.createElement('p',null,v));},_updateBrowserMessage:function(){return r._("Screen sharing doesn't work in the older version of Google Chrome you're using. To share your screen, please update Google Chrome.");},_switchBrowserMessage:function(){if(p.isFirefox()){return r._("Screen sharing doesn't work in Mozilla Firefox yet. To share your screen, please open Facebook in Google Chrome.");}else return r._("Screen sharing doesn't work in your browser yet. To share your screen, please open Facebook in Google Chrome.");},_installLinks:function(){return (h.createElement(k,null,h.createElement(t,{style:{width:'100%',textAlign:'center'}},h.createElement(j,{href:'https://www.google.com/chrome/index.html',target:'_blank'},h.createElement(i,{className:"_4_if",src:s('/images/chat/webrtc/chrome.png'),alt:'Chrome',width:'64'}),h.createElement(o,{display:'block'},'Google Chrome')))));}});f.exports=u;},null);
__d('FBRTCAudioSpectrumAnalyser.react',['React','ReactDOM','cancelAnimationFrame','requestAnimationFrame'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=7,m=3,n=9,o='#3B5998',p='#CCCCCC',q=function(t,u,v,w){var x=w?p:o;u+=m;v-=m;t.beginPath();t.arc(u,v,m,0,2*Math.PI,false);t.fillStyle=x;t.strokeStyle=x;t.fill();},r=function(t,u,v){var w,x,y=u.width/n,z=Math.floor(u.height/l),aa=new Uint8Array(2048);t.getByteFrequencyData(aa);v.clearRect(0,0,u.width,u.height);var ba=Math.floor(aa.length/(n*3));for(var ca=0;ca<n;ca+=1){w=0;for(var da=0;da<ba;da+=1)w+=aa[ca*ba+da];x=w*l/(ba*256);if(x<1)x=.6;for(var ea=0;ea<Math.floor(x);ea++)q(v,ca*y,u.height-ea*z);if(x-Math.floor(x)>=.5)q(v,ca*y,u.height-ea*z,true);}},s=h.createClass({displayName:'FBRTCAudioSpectrumAnalyser',_isAnimating:false,_animationLoop:null,componentDidMount:function(){this._startAnimation();},componentWillUnmount:function(){this._stopAnimation();},shouldComponentUpdate:function(t,u){return this._streamDidChange();},componentDidUpdate:function(t,u){this._stopAnimation();this._startAnimation();},_streamDidChange:function(){var t=this.props.stream?this.props.stream.getStream():null;return t!==this._currentStream;},_stopAnimation:function(){this._isAnimating=false;j(this._animationLoop);},_startAnimation:function(){var t=this.props.stream.getAudioAnalyser();if(!this._isAnimating&&t){this._isAnimating=true;var u=i.findDOMNode(this),v=u.getContext('2d');this._animate(t,u,v);}},render:function(){return h.createElement('canvas',{width:'106',height:'80'});},_animate:function(t,u,v){this._animationLoop=k((function(){if(!this._isAnimating)return;r(t,u,v);this._animate(t,u,v);}).bind(this));}});f.exports=s;},null);
__d('FBRTCAudioConstraints',['FBRTCConstants','FBRTCVersionDetection'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k){var l=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=k;this.audioSource=l;}j.prototype.getConstraints=function(){if(this.streamType===h.StreamType.SCREEN_CONTENT&&i.isChrome())return false;if(!this.audioSource)return true;return {optional:[{sourceId:this.audioSource}]};};f.exports=j;},null);
__d('FBRTCVideoConstraints',['UserAgent','FBRTCConstants','RTCConfig'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=1080,l=720,m=180,n=480,o=1920,p=15,q=30;function r(s,t){var u=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=s;this.videoQuality=t;this.videoSource=u;}r.prototype.getConstraints=function(){if(this.streamType===i.StreamType.AUDIO_ONLY)return false;if(this.streamType===i.StreamType.SCREEN_CONTENT){if(this.videoSource){var s,t,u;if(this.videoQuality===i.VideoQuality.CUSTOM_VIDEO){var v=j.CollaborationCallQuality.screen;s=v.height;t=v.width;u=v.screenFrameRate;}else{s=k;t=o;u=q;}return {mandatory:{chromeMediaSource:'desktop',chromeMediaSourceId:this.videoSource,minHeight:s,maxHeight:s,minWidth:t,maxWidth:t,minFrameRate:p,maxFrameRate:u}};}return false;}var w=0,x=0,y=null;switch(this.videoQuality){case i.VideoQuality.HD_VIDEO:w=l;x=q;break;case i.VideoQuality.LQ_VIDEO:w=m;x=p;break;case i.VideoQuality.CUSTOM_VIDEO:var z=j.CollaborationCallQuality.videoToRoom;w=z.height;x=z.frameRate;y=z.width;break;default:w=n;x=q;break;}if(this.$FBRTCVideoConstraints1())return {height:{min:m,max:l,ideal:w},width:{min:320,max:1280,ideal:w*16/9},frameRate:{min:10,max:30,ideal:x}};var aa={mandatory:{},optional:[{minHeight:w},{maxHeight:w},{minFrameRate:x},{maxFrameRate:x},{googLeakyBucket:true}]};if(this.videoSource)aa.optional=aa.optional.concat({sourceId:this.videoSource});if(y)aa.optional=aa.optional.concat({minWidth:y},{maxWidth:y});return aa;};r.prototype.$FBRTCVideoConstraints1=function(){return !!navigator.mediaDevices&&h.isBrowser('Firefox >= 38');};f.exports=r;},null);
__d('FBRTCUserMediaRequest',['FBRTCAudioConstraints','FBRTCConstants','FBRTCVideoConstraints','UserAgent','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m=function(){return !!navigator.mediaDevices&&k.isBrowser('Firefox >= 38');};function n(o){var p=arguments.length<=1||arguments[1]===undefined?i.VideoQuality.SD_VIDEO:arguments[1];this.streamType=o;this.videoQuality=p;this.audioSource=null;this.videoSource=null;}n.prototype.$FBRTCUserMediaRequest1=function(){var o=new h(this.streamType,this.audioSource),p=new j(this.streamType,this.videoQuality,this.videoSource);return {audio:o.getConstraints(),video:p.getConstraints()};};n.prototype.$FBRTCUserMediaRequest2=function(o,p,q){if(m()&&navigator.mediaDevices){navigator.mediaDevices.getUserMedia(o).then(p)['catch'](q);}else if(navigator.getUserMedia){navigator.getUserMedia(o,p,q);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(o,p,q);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(o,p,q);}else if(navigator.msGetUserMedia)navigator.msGetUserMedia(o,p,q);};n.prototype.request=function(){this.$FBRTCUserMediaRequest2(this.$FBRTCUserMediaRequest1(),(function(o){this.emit('success',o);}).bind(this),(function(o){this.emit('failed',o);}).bind(this));};l(n,{success:true,failed:true});f.exports=n;},null);
__d('FBRTCUserSettings',['mixInEventEmitter','FBRTCConfig','FBRTCConstants','FBRTCUserMediaRequest','FBRTCStreamWrapper'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=window.MediaStreamTrack,n=null,o={stream:new l(),audioSources:[],videoSources:[],selectedCamera:null,savedCamera:null,selectedMic:null,savedMic:null,isLoading:false,_cameraLabel:null,_micLabel:null,isEnabled:function(){return i.settingsEnabled()&&m&&!!m.getSources;},isDirty:function(){return this.savedCamera!==this.selectedCamera||this.savedMic!==this.selectedMic;},refresh:function(){if(m&&m.getSources){m.getSources((function(p){for(var q=0;q<p.length;q++){var r=p[q];if(r.kind==='audio')this.audioSources.push(r);if(r.kind==='video')this.videoSources.push(r);}this._refreshSelectedOptions();this._getUserMedia();this.isLoading=false;this._scheduleChangeEvent();}).bind(this));this.isLoading=true;this.audioSources=[];this.videoSources=[];}this._scheduleChangeEvent();},cleanUp:function(){this.selectedMic=this.savedMic;this.selectedCamera=this.savedCamera;this.stream.stop();},_refreshSelectedOptions:function(){if(this.selectedMic===null)if(this.savedMic){this.selectedMic=this.savedMic;}else if(this.audioSources.length>0){for(var p=0;p<this.audioSources.length;p++)if(this._micLabel&&this._micLabel===this.audioSources[p].label){this.selectedMic=this.audioSources[p].id;break;}if(!this.selectedMic)this.selectedMic=this.audioSources[0].id;this.savedMic=this.selectedMic;}if(this.selectedCamera===null)if(this.savedCamera){this.selectedCamera=this.savedCamera;}else if(this.videoSources.length>0){for(var q=0;q<this.videoSources.length;q++)if(this._cameraLabel&&this._cameraLabel===this.videoSources[q].label){this.selectedCamera=this.videoSources[q].id;break;}if(!this.selectedCamera)this.selectedCamera=this.videoSources[0].id;this.savedCamera=this.selectedCamera;}},save:function(){this.savedMic=this.selectedMic;this.savedCamera=this.selectedCamera;this.emit('saved');this.cleanUp();},selectCameraOption:function(p){this.selectedCamera=p;this._scheduleChangeEvent();this._getUserMedia();},selectMicOption:function(p){this.selectedMic=p;this._scheduleChangeEvent();this._getUserMedia();},updateForLocalStream:function(p){if(p.videoMediaSourceId){this.savedCamera=p.videoMediaSourceId;}else{var q=p.getVideoTracks()[0];if(q)this._cameraLabel=q.label;}if(p.audioMediaSourceId){this.savedMic=p.audioMediaSourceId;}else{var r=p.getAudioTracks()[0];if(r)this._micLabel=r.label;}},_scheduleChangeEvent:function(){if(n!==null)clearTimeout(n);n=setTimeout((function(){this.emit('changed');n=null;}).bind(this),50);},_getUserMedia:function(){var p=new k(j.StreamType.AUDIO_VIDEO);p.videoSource=this.selectedCamera;p.audioSource=this.selectedMic;p.addListener('success',this._gumSuccess,this);p.addListener('failed',this._gumFailed,this);p.request();},_gumSuccess:function(p){this.stream.setStream(p);this._scheduleChangeEvent();},_gumFailed:function(p){}};h(o,{changed:true,saved:true});f.exports=o;},null);
__d('FBRTCSettingsDialog.react',['React','cx','fbt','Link.react','FBRTCDialog.react','FBRTCDialogBody.react','FBRTCDialogFooter.react','FBRTCDialogTitle.react','XUIDialogSaveButton.react','XUIDialogCancelButton.react','XUIGrayText.react','XUISelector.react','FBRTCAudioSpectrumAnalyser.react','FBRTCConfig','FBRTCUserSettings','FBRTCVideo.react'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=s.Option,y=function(aa){var ba=[],ca=0;for(var da=0;da<aa.length;da++){var ea=aa[da],fa=ea.label;if(!fa){var ga=ea.kind==='audio'?'Microphone':'Camera';fa=j._({"Camera":"Camera{number}","Microphone":"Microphone{number}"},[j['enum'](ga,{Camera:'Camera',Microphone:'Microphone'}),j.param('number',++ca)]);}ba.push(h.createElement(x,{value:ea.id,key:ea.id},fa));}return ba;},z=h.createClass({displayName:'FBRTCSettingsDialog',componentDidMount:function(){this._renderSubscription=v.addListener('changed',(function(){this.forceUpdate();}).bind(this));v.refresh();},componentWillUnmount:function(){this._renderSubscription.remove();v.cleanUp();},render:function(){return (h.createElement(l,{width:365,shown:true,onToggle:this.props.onToggle},h.createElement(o,{showCloseButton:true},h.createElement('span',null,j._("Settings"))),h.createElement(m,null,this._dialogBody()),h.createElement(n,{leftContent:this._helpLink()},h.createElement(q,null),h.createElement(p,{use:'confirm',disabled:!v.isDirty(),onClick:this._onConfirmClicked}))));},_dialogBody:function(){if(v.isLoading)return h.createElement('div',{className:"_48fc"});return (h.createElement('div',{className:"_48fc"},this._cameraOptions(),this._microphoneOptions(),h.createElement(r,{shade:'light'},j._("Tip: Try restarting your browser if you're having trouble with your camera or microphone."))));},_cameraOptions:function(){if(v.videoSources.length<1)return null;return (h.createElement('div',{className:"_48fd"},h.createElement(r,{display:'block',size:'medium',shade:'medium',className:"_48fe"},j._("Camera")),h.createElement(s,{name:'camera_selection',onChange:this._onCamSelectionChanged,defaultValue:v.selectedCamera,width:'200px'},y(v.videoSources)),h.createElement('div',{className:"_48ff"},h.createElement(w,{stream:v.stream,muted:true,className:"_48fg"}))));},_microphoneOptions:function(){if(v.audioSources.length<1)return null;return (h.createElement('div',{className:"_48fd"},h.createElement(r,{display:'block',size:'medium',shade:'medium',className:"_48fe"},j._("Microphone")),h.createElement(s,{name:'microphone_selection',onChange:this._onMicSelectionChanged,defaultValue:v.selectedMic,width:'200px'},y(v.audioSources)),h.createElement('div',{className:"_48fh"},h.createElement(t,{stream:v.stream}))));},_onCamSelectionChanged:function(aa){v.selectCameraOption(aa.value);},_onMicSelectionChanged:function(aa){v.selectMicOption(aa.value);},_onConfirmClicked:function(aa){v.save();},_helpLink:function(){return (h.createElement('div',null,h.createElement(r,{shade:'light'},h.createElement(k,{href:u.userMediaErrorUrl(),target:'_blank'},j._("Get help")))));}});f.exports=z;},null);
__d('FBRTCVideoEscalationDialog.react',['FBRTCCallControlActions','React','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogFooter.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=i.PropTypes,p=i.createClass({displayName:'FBRTCVideoEscalationDialog',propTypes:{peerName:o.string.isRequired,hideDialog:o.func.isRequired},render:function(){var q=this.props.peerName;return (i.createElement(j,{layerHideOnBlur:false,shown:true,width:440},i.createElement(k,null,i.createElement('p',null,n._("{name} would like to video chat. Click \"Accept\" to enable your camera.",[n.param('name',q)]))),i.createElement(m,null,i.createElement(l,{action:'cancel',label:n._("Decline"),onClick:this._onDeclineClicked}),i.createElement(l,{action:'confirm',label:n._("Accept"),onClick:this._onAcceptClicked,use:'confirm'}))));},_onDeclineClicked:function(q){h.declineEscalation();},_onAcceptClicked:function(q){this.props.hideDialog();h.acceptEscalation();}});f.exports=p;},null);
__d('FBRTCCallDialogController',['FBRTCCallModel','FBRTCScreenSharingModel','FBRTCSettingsDialog.react','FBRTCStruct','FBRTCMediaAccessErrorDialog.react','FBRTCPeerBrowserUnsupportedDialog.react','FBRTCScreenSharingUnsupportedBrowserDialog.react','FBRTCScreenSharingInstallExtensionDialog.react','FBRTCUserSettings','FBRTCVideoEscalationDialog.react','React','ReactDOM','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=new k(['ERROR_ACCESSING_MEDIA','PEER_BROWSER_UNSUPPORTED','SETTINGS','SCREEN_SHARING_UNSUPPORTED','INSTALL_SCREEN_SHARING_EXT','VIDEO_ESCALATION']),v=r.createClass({displayName:'DialogOwner',mixins:[t],renderLayers:function(){if(this.props.dialogType===u.ERROR_ACCESSING_MEDIA)return {dialog:r.createElement(l,null)};if(this.props.dialogType===u.PEER_BROWSER_UNSUPPORTED)if(this.props.peerName)return {dialog:r.createElement(m,{peerName:this.props.peerName})};if(this.props.dialogType===u.SETTINGS)return {dialog:r.createElement(j,{onToggle:this._onToggle})};if(this.props.dialogType===u.SCREEN_SHARING_UNSUPPORTED)return {dialog:r.createElement(n,{onToggle:this._onToggle})};if(this.props.dialogType===u.INSTALL_SCREEN_SHARING_EXT)return {dialog:r.createElement(o,{onToggle:this._onToggle,peerID:this.props.peerID,sessionID:this.props.sessionID})};if(this.props.dialogType===u.VIDEO_ESCALATION)if(this.props.peerName)return {dialog:r.createElement(q,{hideDialog:function(){w.hideDialog();},onToggle:this._onToggle,peerName:this.props.peerName})};return {};},_onToggle:function(x){setTimeout(function(){if(!x)w.hideDialog();},0);},render:function(){return r.createElement('div',null);}}),w={dialogTypes:u,container:null,setDialogContainer:function(x){this.container=x;this.currentDialogType=null;this.callModel=null;this._render();},showDialog:function(x,y){this.currentDialogType=x;this._setCallModel(y);this._render();},hideDialog:function(){this.currentDialogType=null;this._render();},hideDialogType:function(x){if(x===this.currentDialogType)this.hideDialog();},_render:function(){var x,y,z;if(this.callModel instanceof h){x=this.callModel.peerID;y=this.callModel.callID;z=this.callModel.peerName();}else if(this.callModel instanceof i){x=this.callModel.getPeerID();y=this.callModel.getSessionID();}s.render(r.createElement(v,{dialogType:this.currentDialogType,peerID:x,sessionID:y,peerName:z,callModel:this.callModel}),this.container);},_setCallModel:function(x){if(x!==this.callModel){this.callModel=x;if(this.callModel)this.callModel.addListener(this._onCallModelChanged.bind(this));}},_onCallModelChanged:function(){var x=[u.SETTINGS,u.SCREEN_SHARING_UNSUPPORTED,u.INSTALL_SCREEN_SHARING_EXT,u.VIDEO_ESCALATION];if(this.callModel.isEnded()&&x.indexOf(this.currentDialogType)>-1)this.hideDialog();}};p.addListener('saved',w.hideDialog,w);f.exports=w;},null);
__d('FBRTCStarRatingActions',['FBRTCDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i({SUBMIT_RATING:null,SUBMIT_FEEDBACK:null,RATING_SHOWN:null,FEEDBACK_SHOWN:null}),k={Types:j,submitRating:function(l){h.dispatch({type:j.SUBMIT_RATING,rating:l});},submitFeedback:function(l){h.dispatch({type:j.SUBMIT_FEEDBACK,feedback:l});},ratingShown:function(){h.dispatch({type:j.RATING_SHOWN});},feedbackShown:function(){h.dispatch({type:j.FEEDBACK_SHOWN});}};f.exports=k;},null);
__d('FBRTCCallModelStatePusher',['FBRTCCallModel','FBRTCConstants','FBRTCDispatcher','FBRTCStarRatingActions'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=30000,m=10000;function n(o){'use strict';this.$FBRTCCallModelStatePusher1=null;this.$FBRTCCallModelStatePusher2=o;this.$FBRTCCallModelStatePusher2.addListener(this.$FBRTCCallModelStatePusher3.bind(this));j.register(this.$FBRTCCallModelStatePusher4.bind(this));}n.prototype.$FBRTCCallModelStatePusher5=function(){'use strict';return this.$FBRTCCallModelStatePusher2.uiState===h.UIState.CALL_ENDED&&this.$FBRTCCallModelStatePusher2.wasConnected&&this.$FBRTCCallModelStatePusher2.endCallReason===i.CallEndReason.HANGUP_CALL;};n.prototype.$FBRTCCallModelStatePusher3=function(){'use strict';if(this.$FBRTCCallModelStatePusher2.uiState===h.UIState.CALL_ENDED){if(this.$FBRTCCallModelStatePusher5()){this.$FBRTCCallModelStatePusher6(3000,h.UIState.CALL_ENDED,h.UIState.COLLECT_RATING);}else this.$FBRTCCallModelStatePusher7(m);}else if(this.$FBRTCCallModelStatePusher2.uiState===h.UIState.COLLECT_RATING)this.$FBRTCCallModelStatePusher7(l);};n.prototype.$FBRTCCallModelStatePusher4=function(o){'use strict';if(o.type===k.Types.FEEDBACK_SHOWN)this.$FBRTCCallModelStatePusher8();};n.prototype.$FBRTCCallModelStatePusher7=function(o){'use strict';this.$FBRTCCallModelStatePusher1=setTimeout(function(){window.close();},o);};n.prototype.$FBRTCCallModelStatePusher8=function(){'use strict';clearTimeout(this.$FBRTCCallModelStatePusher1);this.$FBRTCCallModelStatePusher1=null;};n.prototype.$FBRTCCallModelStatePusher6=function(o,p,q){'use strict';var r=this.$FBRTCCallModelStatePusher2;setTimeout(function(){r.setStateFrom(p,q);},o);};f.exports=n;},null);
__d('FBRTCCallMonitor',['FBRTCCallSummaryStore'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=10000,j=3000;function k(l){'use strict';this.$FBRTCCallMonitor1=l;this.$FBRTCCallMonitor2=null;this.$FBRTCCallMonitor3=h.getInstance();}k.prototype.startHeartbeat=function(l){'use strict';if(this.$FBRTCCallMonitor1.isEnded())return;var m=l();if(m)this.onCallHeartbeat(m);var n=this;setTimeout(function(){n.startHeartbeat(l);},i);};k.prototype.onCallHeartbeat=function(l){'use strict';var m=new Date().valueOf();if(!this.$FBRTCCallMonitor2||m-this.$FBRTCCallMonitor2>j)l.save(this.$FBRTCCallMonitor3);};f.exports=k;},null);
__d("FBRTCIceCache",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){"use strict";this.$FBRTCIceCache1={};}h.prototype.reset=function(i,j){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};this.$FBRTCIceCache1[i][j]=[];};h.prototype.cacheCandidate=function(i,j,k){"use strict";if(!this.$FBRTCIceCache1[i])this.$FBRTCIceCache1[i]={};if(!this.$FBRTCIceCache1[i][j])this.$FBRTCIceCache1[i][j]=[];this.$FBRTCIceCache1[i][j].unshift(k);};h.prototype.drainCandidates=function(i,j,k){"use strict";if(this.$FBRTCIceCache1[i]&&this.$FBRTCIceCache1[i][j]){var l;while(this.$FBRTCIceCache1[i][j].length>0){l=this.$FBRTCIceCache1[i][j].pop();k(l);}}};f.exports=h;},null);
__d('FBRTCMessage',['FBRTCConstants','FBRTCSdpUtils','FBRTCSupport'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k='mobile';function l(m){'use strict';if(!this.$FBRTCMessage1(m))throw 'invalid webrtc message';this.originalMessageData=m;this.peerID=m.from;this.callID=parseInt(m.call_id,10);this.msg=JSON.parse(m.payload);this.msgType=this.msg.type;this.msgID=this.msg.msg_id;this.ackID=this.msg.ack_id;this.source=m.source;this.peerSupportsVideoInterop=!!this.msg.supports_video_interop;this.$FBRTCMessage2();this.$FBRTCMessage3();}l.prototype.$FBRTCMessage1=function(m){'use strict';return m.from&&m.call_id&&m.payload;};l.prototype.$FBRTCMessage2=function(){'use strict';if(j.isVideoInteropSupported()&&this.peerSupportsVideoInterop)return;if(this.isFromMobile())this.disableVideo();};l.prototype.disableVideo=function(){'use strict';if(this.msg.sdp)this.msg.sdp=i.disableVideo(this.msg.sdp);if(this.msgType===h.PayloadType.SET_VIDEO||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.ANSWER||this.msgType===h.PayloadType.ICERESTART_ANSWER)this.msg.videoon=false;};l.prototype.$FBRTCMessage3=function(){'use strict';if(this.isFromMobile()&&this.msg.sdp&&this.msgType!==h.PayloadType.ICE_CANDIDATE)this.msg.sdp=i.removeFEC(this.msg.sdp);};l.prototype.isOffer=function(){'use strict';return this.msgType===h.PayloadType.OFFER;};l.prototype.isFromMobile=function(){'use strict';return this.source===k;};l.prototype.isRemoteVideoSupported=function(){'use strict';if(!this.msg.sdp||this.msgType===h.PayloadType.ICE_CANDIDATE)return true;return i.isVideoSupported(this.msg.sdp);};l.prototype.isRetry=function(){'use strict';return !!this.msg.flag;};l.prototype.isForCall=function(m){'use strict';return !m.callID||m.callID===this.callID||this.msgType===h.PayloadType.OFFER||this.msgType===h.PayloadType.ICERESTART_OFFER||this.msgType===h.PayloadType.PCRESTART_OFFER||this.msgType===h.PayloadType.ICE_CANDIDATE;};l.prototype.getSignalingExperiments=function(){'use strict';if(this.isFromMobile()&&!this.msg.experiments)return ['sdp_update'];return this.msg.experiments;};f.exports=l;},null);
__d("FBRTCMessageDedup",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={check:function(j,k,l){if(!h[j])h[j]={};if(!h[j][k])h[j][k]={};if(h[j][k][l])return false;h[j][k][l]=true;return true;}};f.exports=i;},null);
__d("XCollabCallSendMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/collab\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d("XVideoCallSendMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/sendmessage\/",{recipient_id:{type:"Int",required:true},msg_id:{type:"Int",required:true},message_info:{type:"String",required:true},webrtc_fbtrace:{type:"Int"}});},null);
__d('FBRTCMessageSender',['CurrentUser','FBRTCConfig','FBRTCConstants','FBRTCLogger','FBRTCUtils','Fbtrace','Map','SiteData','FBRTCSupport','XVideoCallSendMessageController','XCollabCallSendMessageController','errorCode'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=0;function u(){'use strict';this.onSendFailure=null;this.$FBRTCMessageSender1=k.getInstance();}u.prototype.sendOffer=function(v,w,x,y,z){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.OFFER,v,w,x,y,z);};u.prototype.sendAnswer=function(v,w,x,y,z){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.ANSWER,v,w,x,y,z);};u.prototype.sendPCRestartOffer=function(v,w,x,y,z){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.PCRESTART_OFFER,v,w,x,y,z);};u.prototype.sendSdpUpdate=function(v,w,x,y,z){'use strict';return this.$FBRTCMessageSender2(j.PayloadType.SDP_UPDATE,v,w,x,y,z);};u.prototype.resendSdpMessage=function(v,w){'use strict';w.flag=1;this.$FBRTCMessageSender3(v,w);};u.prototype.resendPayload=function(v,w){'use strict';w.flag=1;this.$FBRTCMessageSender4(v,w);};u.prototype.$FBRTCMessageSender2=function(v,w,x,y,z,aa){'use strict';var ba=this.$FBRTCMessageSender5(x,v);ba.sdp=y;if(v===j.PayloadType.OFFER){ba.handlescollision=true;ba.pranswer=false;}if(v===j.PayloadType.OFFER||v===j.PayloadType.ANSWER){ba.icerestart=false;ba.experiments=i.supportedSignalingExperiments();}ba.videoon=z;ba.attributes=aa;this.$FBRTCMessageSender3(w,ba);return ba;};u.prototype.sendIceCandidate=function(v,w,x){'use strict';var y=this.$FBRTCMessageSender5(w,j.PayloadType.ICE_CANDIDATE);y.sdp_mid=x.sdpMid;y.label=x.sdpMLineIndex;y.sdp=x.candidate;if(x.isDirectScreenShareFromRecipient){y.attributes={};y.attributes.isDirectScreenShareFromRecipient=x.isDirectScreenShareFromRecipient;}this.$FBRTCMessageSender4(v,y);};u.prototype.sendHangup=function(v,w,x,y,z){'use strict';var aa=this.$FBRTCMessageSender5(w,j.PayloadType.HANGUP);aa.reason=j.callEndReasonString(x);aa.subreason=z||'';this.$FBRTCMessageSender4(v,aa,y);};u.prototype.sendOtherDismiss=function(v){'use strict';var w=this.$FBRTCMessageSender5(v,j.PayloadType.OTHER_DISMISS);this.$FBRTCMessageSender4(h.getID(),w);};u.prototype.sendOfferAck=function(v,w,x){'use strict';var y=arguments.length<=3||arguments[3]===undefined?new n():arguments[3];this.$FBRTCMessageSender6(v,w,x,j.PayloadType.OFFER_ACK,y);};u.prototype.sendOfferNack=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.OFFER_NACK,new n([['error_code',1356043]]));};u.prototype.sendAnswerAck=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.ANSWER_ACK);};u.prototype.sendAck=function(v,w,x){'use strict';this.$FBRTCMessageSender6(v,w,x,j.PayloadType.ACK,new n([['ack_type',x.type]]));};u.prototype.sendMuteStateUpdate=function(v,w,x){'use strict';var y=this.$FBRTCMessageSender5(w,j.PayloadType.SET_VIDEO);y.videoon=x;this.$FBRTCMessageSender4(v,y);};u.prototype.sendVideoEscalationRequest=function(v,w,x){'use strict';return this.sendVideoRequestResponse(v,w,0,x);};u.prototype.sendVideoRequestResponse=function(v,w,x,y){'use strict';var z=this.$FBRTCMessageSender5(w,j.PayloadType.VIDEO_REQUEST);z.ack_id=x;z.videoon=y;z.capability=p.getCapabilities();this.$FBRTCMessageSender4(v,z);return z;};u.prototype.sendMsgAck=function(){'use strict';};u.prototype.sendOk=function(){'use strict';};u.prototype.sendPranswer=function(){'use strict';};u.prototype.sendIcerestartAnswer=function(){'use strict';};u.prototype.$FBRTCMessageSender5=function(v,w){'use strict';var x=l.generateRandomInt(),y={version:t,type:w,call_id:v,msg_id:x};if(this.$FBRTCMessageSender7(w))y.supports_video_interop=true;return y;};u.prototype.$FBRTCMessageSender7=function(v){'use strict';if(p.isVideoInteropSupported())return (v===j.PayloadType.OFFER||v===j.PayloadType.ANSWER||v===j.PayloadType.PRANSWER||v===j.PayloadType.ICERESTART_OFFER||v===j.PayloadType.ICERESTART_ANSWER||v===j.PayloadType.PCRESTART_OFFER||v===j.PayloadType.PCRESTART_ANSWER||v===j.PayloadType.SDP_UPDATE||v===j.PayloadType.SET_VIDEO||v===j.PayloadType.VIDEO_REQUEST);return false;};u.prototype.$FBRTCMessageSender3=function(v,w){'use strict';this.$FBRTCMessageSender4(v,w,false,true,true);};u.prototype.$FBRTCMessageSender6=function(v,w,x,y){'use strict';var z=arguments[4]||new n(),aa=this.$FBRTCMessageSender5(w,y);aa.ack_id=x.msg_id;if(x.flag===1)aa.flag=1;z.forEach(function(ba,ca,da){aa[ca]=ba;});this.$FBRTCMessageSender4(v,aa);};u.prototype.$FBRTCMessageSender4=function(v,w,x,y,z){'use strict';var aa=w.msg_id,ba={peer_id:v,call_id:w.call_id,msg_id:aa,msg_type:w.type},ca={call_id:w.call_id,msg_id:aa,user_id:h.getID(),recipient_id:v,msg_type:w.type,app_id:256281040558,app_version:String(o.revision||'dev'),op:'sendServerRequest:'+w.type,policy:'WebRTC'},da=m.requestReceive('browser',String(o.revision||'dev'),ca),ea=(l.isCollabCallable(v)?r:q).getURIBuilder().setInt('recipient_id',v).setInt('msg_id',aa).setString('message_info',JSON.stringify(w)).setInt('webrtc_fbtrace',da.isOn()?1:0).getURI();if(y)var fa=this.$FBRTCMessageSender4.bind(this,v,w,x,false,z);var ga=this.$FBRTCMessageSender8.bind(this,ba),ha=this.$FBRTCMessageSender9.bind(this,ba,fa,z);m.withDefaultNode(da,function(){l.sendServerRequest(ea,ga,ha,x);});if(this.onMessageSent)this.onMessageSent(v,w);this.$FBRTCMessageSender1.logSentMessage(v,w.call_id,w);};u.prototype.$FBRTCMessageSender8=function(v){'use strict';this.$FBRTCMessageSender1.logSentMessageSuccess(v.peer_id,v.call_id,v.msg_type,v.msg_id);};u.prototype.$FBRTCMessageSender9=function(v,w,x,y){'use strict';if(y)var z=y.getError?y.getError():y;this.$FBRTCMessageSender1.logSentMessageFailure(v.peer_id,v.call_id,v.msg_type,v.msg_id,z);var aa=null;if(z===1356001||z===1356049){aa=j.CallEndReason.NO_PERMISSION;}else if(z===1356046||z===1356045){aa=j.CallEndReason.CALLER_NOT_VISIBLE;}else if(z===1356003||z===1356002||z===1356044)aa=j.CallEndReason.OTHER_NOT_CAPABLE;if(!aa&&w){w();return;}if(x&&this.onSendFailure){if(!aa)aa=j.CallEndReason.SIGNALING_MESSAGE_FAILED;this.onSendFailure(aa,z,v.msg_type);}};f.exports=u;},null);
__d('FBRTCRetriableMessage',['mixInEventEmitter','FBRTCConstants'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=10000,k=7000,l=1;function m(n){'use strict';this.$FBRTCRetriableMessage1=n;this.$FBRTCRetriableMessage2=j;this.$FBRTCRetriableMessage3=l;this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}m.prototype.sendMessage=function(n,o,p,q,r,s){'use strict';this.$FBRTCRetriableMessage4=o;switch(n){case i.PayloadType.PCRESTART_OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendPCRestartOffer(o,p,q,r,s);break;case i.PayloadType.OFFER:this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendOffer(o,p,q,r,s);break;case i.PayloadType.ANSWER:this.$FBRTCRetriableMessage2=k;this.$FBRTCRetriableMessage5=this.$FBRTCRetriableMessage1.sendAnswer(o,p,q,r,s);break;}this.$FBRTCRetriableMessage7();};m.prototype.isAckMsg=function(n){'use strict';return this.$FBRTCRetriableMessage5&&this.$FBRTCRetriableMessage5.msg_id===n.ack_id;};m.prototype.stopRetrying=function(){'use strict';if(this.$FBRTCRetriableMessage6){clearTimeout(this.$FBRTCRetriableMessage6);this.$FBRTCRetriableMessage4=null;this.$FBRTCRetriableMessage5=null;this.$FBRTCRetriableMessage6=null;}};m.prototype.$FBRTCRetriableMessage7=function(){'use strict';this.$FBRTCRetriableMessage6=setTimeout(this.$FBRTCRetriableMessage8.bind(this),this.$FBRTCRetriableMessage2);};m.prototype.$FBRTCRetriableMessage8=function(){'use strict';if(this.$FBRTCRetriableMessage3<1){this.emit('timeoutFailure');}else{this.emit('sendingRetry');this.$FBRTCRetriableMessage1.resendSdpMessage(this.$FBRTCRetriableMessage4,this.$FBRTCRetriableMessage5);this.$FBRTCRetriableMessage7();this.$FBRTCRetriableMessage3-=1;}};h(m,{sendingRetry:true,timeoutFailure:true});f.exports=m;},null);
__d('FBRTCScreenMedia',['FBRTCConstants','FBRTCDispatcher','FBRTCUserMediaRequest','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=k({STREAM_READY:null,STREAM_FAILED:null}),m={STREAM_TYPE:h.StreamType.SCREEN_CONTENT,Types:l,requestScreenMedia:function(n){var o=new j(this.STREAM_TYPE);o.videoSource=n;o.audioSource=null;o.addListener('success',this._onRequestSuccess,this);o.addListener('failed',this._onRequestFailure,this);o.request();},_onRequestSuccess:function(n){i.dispatch({type:l.STREAM_READY,stream:n});},_onRequestFailure:function(n){var o=n.name?n.name:n;i.dispatch({type:l.STREAM_FAILED,error:o});}};f.exports=m;},null);
__d('FBRTCOfferOptions',['UserAgent'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(){var j=arguments.length<=0||arguments[0]===undefined?false:arguments[0],k=arguments.length<=1||arguments[1]===undefined?false:arguments[1];this.$FBRTCOfferOptions1(j,k);}i.prototype.getOptions=function(){return this.$FBRTCOfferOptions2;};i.prototype.setOptions=function(j){this.$FBRTCOfferOptions2=j;};i.prototype.$FBRTCOfferOptions1=function(j,k){if(h.isBrowser('Chrome <= 37')){this.setOptions({mandatory:{OfferToReceiveAudio:j,OfferToReceiveVideo:k}});}else this.setOptions({offerToReceiveAudio:j,offerToReceiveVideo:k});};f.exports=i;},null);
__d('FBRTCScreenSharingConnection',['FBRTCConstants','FBRTCOfferOptions','FBRTCPCConfig','FBRTCScreenSharingActions','FBRTCScreenSharingLogger','FBRTCScreenStreamWrapper'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();function n(){this.$FBRTCScreenSharingConnection1=l.getInstance();this.$FBRTCScreenSharingConnection2=new i(false,true);this.$FBRTCScreenSharingConnection3=window.RTCIceCandidate;this.$FBRTCScreenSharingConnection4=window.RTCSessionDescription;this.$FBRTCScreenSharingConnection5=window.webkitRTCPeerConnection;this.$FBRTCScreenSharingConnection6=null;this.$FBRTCScreenSharingConnection7=null;}n.prototype.setStream=function(o){this.$FBRTCScreenSharingConnection6=o;};n.prototype.createSdpUpdate=function(){var o=this.$FBRTCScreenSharingConnection7,p=this.$FBRTCScreenSharingConnection6;if(o&&p){var q=o.getLocalStreams();for(var r=0;r<q.length;r++)o.removeStream(q[r]);o.addStream(p.getStream());this.$FBRTCScreenSharingConnection8(h.PayloadType.SDP_UPDATE);}};n.prototype.createOffer=function(){if(!this.$FBRTCScreenSharingConnection7)this.$FBRTCScreenSharingConnection7=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection8(h.PayloadType.OFFER);};n.prototype.onReceivedAnswerSDP=function(o){var p=new this.$FBRTCScreenSharingConnection4({type:h.PayloadType.ANSWER,sdp:o}),q=this.$FBRTCScreenSharingConnection7;if(q)q.setRemoteDescription(p,this.$FBRTCScreenSharingConnection10.bind(this,p),this.$FBRTCScreenSharingConnection11);};n.prototype.onReceivedOfferSDP=function(o){var p=this.$FBRTCScreenSharingConnection7;if(!p){p=this.$FBRTCScreenSharingConnection9();this.$FBRTCScreenSharingConnection7=p;}var q=new this.$FBRTCScreenSharingConnection4({type:h.PayloadType.OFFER,sdp:o});p.setRemoteDescription(q,this.$FBRTCScreenSharingConnection10.bind(this,q),this.$FBRTCScreenSharingConnection11);};n.prototype.onReceivedRemoteIceCandidate=function(o){if(typeof o.sdp!=='string')return;var p=new this.$FBRTCScreenSharingConnection3({sdpMLineIndex:o.label,candidate:o.sdp,sdpMid:o.sdp_mid}),q=this.$FBRTCScreenSharingConnection7;if(q)q.addIceCandidate(p);};n.prototype.cleanPeerConnection=function(){var o=this.$FBRTCScreenSharingConnection7;if(o){o.onaddstream=null;o.onremovestream=null;o.onicecandidate=null;o.oniceconnectionstatechange=null;if(o.iceConnectionState!=='closed')o.close();}};n.prototype.$FBRTCScreenSharingConnection9=function(){var o=new this.$FBRTCScreenSharingConnection5(j.getConfig(),j.getConstraints());o.onaddstream=this.$FBRTCScreenSharingConnection12.bind(this);o.onicecandidate=this.$FBRTCScreenSharingConnection13.bind(this);if(this.$FBRTCScreenSharingConnection6)o.addStream(this.$FBRTCScreenSharingConnection6.getStream());return o;};n.prototype.$FBRTCScreenSharingConnection13=function(event){if(event.candidate)k.localIceCandidateCreated(event.candidate);};n.prototype.$FBRTCScreenSharingConnection12=function(event){k.remoteStreamAdded(event.stream);};n.prototype.$FBRTCScreenSharingConnection8=function(o){var p=this.$FBRTCScreenSharingConnection7;if(p)p.createOffer(this.$FBRTCScreenSharingConnection14.bind(this,o),this.$FBRTCScreenSharingConnection11,this.$FBRTCScreenSharingConnection2.getOptions());};n.prototype.$FBRTCScreenSharingConnection14=function(o,p){var q=this.$FBRTCScreenSharingConnection7;p.sdp=this.$FBRTCScreenSharingConnection15(p.sdp);if(q)q.setLocalDescription(p,k.sdpCreated.bind(this,{type:o,sdp:p.sdp}),this.$FBRTCScreenSharingConnection11);};n.prototype.$FBRTCScreenSharingConnection15=function(o){return o.replace('UDP/TLS/RTP/SAVPF','RTP/SAVPF');};n.prototype.$FBRTCScreenSharingConnection10=function(o){if(o.type===h.PayloadType.OFFER){var p=this.$FBRTCScreenSharingConnection7;if(p)p.createAnswer(this.$FBRTCScreenSharingConnection14.bind(this,h.PayloadType.ANSWER),this.$FBRTCScreenSharingConnection11);}else if(o.type===h.PayloadType.ANSWER)k.remoteDescriptionSet();};n.prototype.$FBRTCScreenSharingConnection11=function(o){this.$FBRTCScreenSharingConnection1.logToConsole(null,null,JSON.stringify(o,null,'\t'));};f.exports=n;},null);
__d('FBRTCScreenSharingController',['Promise','FBRTCCallDialogController','FBRTCConstants','FBRTCLocalMessageQueue','FBRTCMessageHandler','FBRTCMessageListener','FBRTCMessageSender','FBRTCScreenMedia','FBRTCScreenSharingActions','FBRTCScreenSharingConnection','FBRTCScreenSharingConstants','FBRTCScreenSharingLogger','FBRTCScreenSharingModel','FBRTCScreenSharingUI','FBRTCScreenSharingUtils','FBRTCStore','Random','invariant'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z,aa;'use strict';z=babelHelpers.inherits(ba,w);aa=z&&z.prototype;function ba(ca,da,ea){aa.constructor.call(this);this.$FBRTCScreenSharingController1=this.$FBRTCScreenSharingController2.bind(this);this.$FBRTCScreenSharingController3=ea;this.$FBRTCScreenSharingController4=false;this.$FBRTCScreenSharingController5=false;this.$FBRTCScreenSharingController6=false;this.$FBRTCScreenSharingController7=false;this.$FBRTCScreenSharingController8=null;this.$FBRTCScreenSharingController9=s.getInstance();this.$FBRTCScreenSharingController10=ca;this.$FBRTCScreenSharingController11=da!=null?da:x.uint32();this.$FBRTCScreenSharingController12=new t(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11);!(this.$FBRTCScreenSharingController11!==null&&this.$FBRTCScreenSharingController11!==undefined)?y(0):undefined;this.initPromise=new h((function(fa,ga){if(v.isScreenSharingSupported()){v.checkExtensionInstalled(fa,ga);if(ea){this.$FBRTCScreenSharingController13(da);}else this.$FBRTCScreenSharingController12.addListener(this.$FBRTCScreenSharingController14.bind(this));}else ga();}).bind(this));}ba.prototype.isEnabled=function(){return this.$FBRTCScreenSharingController6&&this.$FBRTCScreenSharingController12.isEnabled();};ba.prototype.getStream=function(){return this.$FBRTCScreenSharingController12.getStream();};ba.prototype.onStop=function(){this.$FBRTCScreenSharingController12.onStop();};ba.prototype.onEndCall=function(){u.close();};ba.prototype.setRemoteStream=function(ca){if(!ca){u.close();this.$FBRTCScreenSharingController12.setStream(ca,true);}else this.$FBRTCScreenSharingController12.setStream(ca,true);};ba.prototype.initializeAsSender=function(){this.$FBRTCScreenSharingController4=false;};ba.prototype.initializeAsReceiver=function(ca,da){this.$FBRTCScreenSharingController4=true;this.$FBRTCScreenSharingController15.onReceivedOfferSDP(ca);this.$FBRTCScreenSharingController8=da;};ba.prototype.onSdpUpdateReceived=function(ca){this.$FBRTCScreenSharingController15.onReceivedOfferSDP(ca);this.$FBRTCScreenSharingController7=true;this.$FBRTCScreenSharingController16=true;};ba.prototype.toggleScreenSharing=function(){var ca=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(this.$FBRTCScreenSharingController17(ca)){var da=this.$FBRTCScreenSharingController12.isEnabled()||this.$FBRTCScreenSharingController5?'SC_CANCEL':'SC_REQUEST';if(da==='SC_REQUEST'&&this.$FBRTCScreenSharingController3)u.openTempWindow();this.$FBRTCScreenSharingController18(da);this.$FBRTCScreenSharingController9.logAction(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,s.Action.SCREEN_SHARING_TOGGLED,this.$FBRTCScreenSharingController3,'status: '+(this.isEnabled()?'enabled':'disabled'));}};ba.prototype.onDirectScreenSharingEndSession=function(){this.onStop();};ba.prototype.$FBRTCScreenSharingController17=function(ca){var da=ca?ca:this.$FBRTCScreenSharingController12;if(!i.container)i.setDialogContainer(document.body.appendChild(document.createElement('div')));if(!v.isSupportedBrowser()){i.showDialog(i.dialogTypes.SCREEN_SHARING_UNSUPPORTED,da);return false;}else if(!v.isExtensionInstalled()){i.showDialog(i.dialogTypes.INSTALL_SCREEN_SHARING_EXT,da);return false;}return true;};ba.prototype.$FBRTCScreenSharingController19=function(){var ca=arguments.length<=0||arguments[0]===undefined?false:arguments[0];if(this.$FBRTCScreenSharingController7)return;this.$FBRTCScreenSharingController5=true;this.toggleScreenSharing();u.close();if(this.$FBRTCScreenSharingController15)this.$FBRTCScreenSharingController15.cleanPeerConnection();if(!this.$FBRTCScreenSharingController4)l.resetListener();if(ca)this.$FBRTCScreenSharingController20();};ba.prototype.$FBRTCScreenSharingController21=function(){this.$FBRTCScreenSharingController7=true;this.$FBRTCScreenSharingController16=true;this.$FBRTCScreenSharingController18('SC_RESET_PORT');this.$FBRTCScreenSharingController18('SC_REQUEST');};ba.prototype.$FBRTCScreenSharingController18=function(ca){!(ca==='SC_REQUEST'||ca==='SC_CANCEL'||ca==='SC_RESET_PORT')?y(0):undefined;window.postMessage({recipient:v.RECIPIENT,type:ca,text:'communicate with screen sharing extension'},'*');if(ca==='SC_REQUEST'||ca==='SC_CANCEL')window.addEventListener('message',this.$FBRTCScreenSharingController2.bind(this));};ba.prototype.$FBRTCScreenSharingController13=function(ca){this.$FBRTCScreenSharingController18('SC_RESET_PORT');this.$FBRTCScreenSharingController22=new n();this.$FBRTCScreenSharingController15=new q();this.$FBRTCScreenSharingController16=false;this.$FBRTCScreenSharingController12.addListener(this.$FBRTCScreenSharingController19.bind(this,true));};ba.prototype.$FBRTCScreenSharingController23=function(ca){var da=JSON.parse(ca.payload);switch(ca.msg_type){case j.PayloadType.ICE_CANDIDATE:this.$FBRTCScreenSharingController15.onReceivedRemoteIceCandidate(da);break;case j.PayloadType.ANSWER:u.hideRingingOverlay();this.$FBRTCScreenSharingController15.onReceivedAnswerSDP(da.sdp);break;case j.PayloadType.HANGUP:this.onDirectScreenSharingEndSession();break;default:break;}};ba.prototype.$FBRTCScreenSharingController2=function(event){if(event.origin!=window.location.origin)return;if(!event.data.recipient||event.data.recipient!='SC_DOM')return;if(!event.data.type)return;if(event.data.type==='SC_EXT_INSTALLED')return;window.removeEventListener('message',this.$FBRTCScreenSharingController1,false);switch(event.data.type){case 'SC_DIALOG_SUCCESS':this.$FBRTCScreenSharingController24(event.data.streamId);break;case 'SC_DIALOG_CANCEL':break;case 'SC_CANCELLED':this.$FBRTCScreenSharingController9.logAction(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,s.Action.SCREEN_SHARING_CANCELLED,this.$FBRTCScreenSharingController3);this.$FBRTCScreenSharingController14();break;default:this.$FBRTCScreenSharingController9.logToConsole(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,'Unexpected event type');}};ba.prototype.$FBRTCScreenSharingController24=function(ca){if(this.$FBRTCScreenSharingController6&&!this.$FBRTCScreenSharingController3){this.$FBRTCScreenSharingController9.logToConsole(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,'Screen sharing already enabled, do nothing');return;}this.$FBRTCScreenSharingController12.onStart(ca);if(this.$FBRTCScreenSharingController12.isEnabled())o.requestScreenMedia(ca);};ba.prototype.$FBRTCScreenSharingController14=function(){if(!this.$FBRTCScreenSharingController6){this.$FBRTCScreenSharingController9.logToConsole(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,'Screen sharing already disabled, do nothing');return;}this.$FBRTCScreenSharingController9.logAction(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,s.Action.SCREEN_SHARING_DISABLED,this.$FBRTCScreenSharingController3);this.$FBRTCScreenSharingController6=false;this.__emitChange();};ba.prototype.$FBRTCScreenSharingController25=function(ca){this.$FBRTCScreenSharingController6=!!ca.stream;this.$FBRTCScreenSharingController12.setStream(ca.stream,false);if(this.$FBRTCScreenSharingController3){this.$FBRTCScreenSharingController15.setStream(this.$FBRTCScreenSharingController12.getStream());if(this.$FBRTCScreenSharingController7){this.$FBRTCScreenSharingController15.createSdpUpdate();}else this.$FBRTCScreenSharingController15.createOffer();}this.$FBRTCScreenSharingController9.logAction(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,s.Action.SCREEN_SHARING_ENABLED,this.$FBRTCScreenSharingController3);this.__emitChange();};ba.prototype.$FBRTCScreenSharingController26=function(ca){this.$FBRTCScreenSharingController9.logError(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,this.$FBRTCScreenSharingController3,'Failed retrieving the screen stream with error: '+ca.error);};ba.prototype.$FBRTCScreenSharingController27=function(ca){if(ca&&ca.candidate){ca.isDirectScreenShareFromRecipient=this.$FBRTCScreenSharingController4;this.$FBRTCScreenSharingController22.sendIceCandidate(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,ca);}};ba.prototype.$FBRTCScreenSharingController28=function(ca){this.$FBRTCScreenSharingController22.sendOffer(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,ca,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};ba.prototype.$FBRTCScreenSharingController29=function(ca){this.$FBRTCScreenSharingController22.sendAnswer(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,ca,false,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};ba.prototype.$FBRTCScreenSharingController20=function(){this.$FBRTCScreenSharingController22.sendHangup(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,j.CallEndReason.HANGUP_CALL,true,'DirectScreenSharing');};ba.prototype.$FBRTCScreenSharingController30=function(ca){this.$FBRTCScreenSharingController22.sendSdpUpdate(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController11,ca,true,{isDirectScreenShareFromRecipient:this.$FBRTCScreenSharingController4});};ba.prototype.$FBRTCScreenSharingController31=function(){var ca=this.$FBRTCScreenSharingController8;if(ca)ca.drainQueue(this.$FBRTCScreenSharingController10,this.$FBRTCScreenSharingController32.bind(this));};ba.prototype.$FBRTCScreenSharingController32=function(ca){var da=JSON.parse(ca.payload);this.$FBRTCScreenSharingController15.onReceivedRemoteIceCandidate(da);};ba.prototype.$FBRTCScreenSharingController33=function(ca){switch(ca.description.type){case j.PayloadType.OFFER:this.$FBRTCScreenSharingController34(ca.description.sdp);break;case j.PayloadType.ANSWER:this.$FBRTCScreenSharingController35(ca.description.sdp);break;case j.PayloadType.SDP_UPDATE:this.$FBRTCScreenSharingController36(ca.description.sdp);break;default:break;}};ba.prototype.$FBRTCScreenSharingController34=function(ca){u.open(r.UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController12.getStream(),this.$FBRTCScreenSharingController10);this.$FBRTCScreenSharingController28(ca);};ba.prototype.$FBRTCScreenSharingController35=function(ca){this.$FBRTCScreenSharingController29(ca);if(!this.$FBRTCScreenSharingController16)this.$FBRTCScreenSharingController31();};ba.prototype.$FBRTCScreenSharingController36=function(ca){u.switchScreen(r.UITypes.DIRECT_SENDER,this.$FBRTCScreenSharingController12.getStream());this.$FBRTCScreenSharingController7=false;this.$FBRTCScreenSharingController30(ca);};ba.prototype.$FBRTCScreenSharingController37=function(ca){if(!this.$FBRTCScreenSharingController4)return;this.$FBRTCScreenSharingController12.setStream(ca.stream,true,true);if(this.$FBRTCScreenSharingController7){u.switchScreen(r.UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController12.getStream());this.$FBRTCScreenSharingController7=false;}else u.open(r.UITypes.DIRECT_RECIPIENT,this.$FBRTCScreenSharingController12.getStream(),this.$FBRTCScreenSharingController10);};ba.prototype.$FBRTCScreenSharingController38=function(ca){if(!this.$FBRTCScreenSharingController16)this.$FBRTCScreenSharingController27(ca.candidate);};ba.prototype.$FBRTCScreenSharingController39=function(){m.removeMessageHandler();m.init(false,this.$FBRTCScreenSharingController10);m.setMessageHandler(this.$FBRTCScreenSharingController23,this);};ba.prototype.__onDispatch=function(ca){if(this.$FBRTCScreenSharingController5)return;switch(ca.type){case o.Types.STREAM_READY:this.$FBRTCScreenSharingController25(ca);break;case o.Types.STREAM_FAILED:this.$FBRTCScreenSharingController26(ca);break;case p.ConnectionEventTypes.SDP_CREATED:this.$FBRTCScreenSharingController33(ca);break;case p.ConnectionEventTypes.REMOTE_STREAM_ADDED:this.$FBRTCScreenSharingController37(ca);break;case p.ConnectionEventTypes.LOCAL_ICE_CANDIDATE_CREATED:this.$FBRTCScreenSharingController38(ca);break;case p.ControlEventTypes.END_SESSION:this.onDirectScreenSharingEndSession();break;case p.ControlEventTypes.SWITCH_SCREEN:this.$FBRTCScreenSharingController21();break;case p.ConnectionEventTypes.OFFER_ACK_RECEIVED:this.$FBRTCScreenSharingController39();break;case p.ConnectionEventTypes.REMOTE_DESCRIPTION_SET:break;default:break;}};f.exports=ba;},null);
__d("XVideoCallTurnDiscoveryController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/turndiscovery\/",{version:{type:"Int",required:true}});},null);
__d('FBRTCTurnDiscovery',['FBRTCLogger','FBRTCUtils','XVideoCallTurnDiscoveryController','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=3,m={requestTurnCreds:function(n,o){if(this._turnCreds)this.emit('receivedTurnCreds',this._turnCreds);if(o===undefined)o=l;var p=1,q=j.getURIBuilder().setInt('version',p).getURI();i.sendServerRequest(q,this._onServerRequestSuccess.bind(this),this._onServerRequestFailure.bind(this,n,o));},_onServerRequestSuccess:function(n){this._turnCreds=n.payload;this.emit('receivedTurnCreds',this._turnCreds);},_onServerRequestFailure:function(n,o,p){if(o>0){h.getInstance().logError(n.peerID,n.callID,'Failed turn; going to retry');this.requestTurnCreds(n,o-1);}else this.emit('failed');}};k(m,{receivedTurnCreds:true,failed:true});f.exports=m;},null);
__d('FBRTCStreamTester',['mixInEventEmitter','FBRTCUtils'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=100,k=30;function l(m){'use strict';if(!m)m={};this.$FBRTCStreamTester1=m.retries||k;this.$FBRTCStreamTester2=m.testInterval||j;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false;}l.prototype.testStream=function(m,n){'use strict';this.$FBRTCStreamTester3=m;if(!n){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement('video');this.$FBRTCStreamTester4.muted=true;i.attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play();}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=n;}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1);};l.prototype.$FBRTCStreamTester6=function(m){'use strict';if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit('streamWorking');}else if(m<1){this.$FBRTCStreamTester7();this.emit('streamBroken');}else setTimeout(this.$FBRTCStreamTester6.bind(this,m-1),this.$FBRTCStreamTester2);};l.prototype.$FBRTCStreamTester7=function(){'use strict';if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null;};h(l,{streamWorking:true,streamBroken:true});f.exports=l;},null);
__d('FBRTCUserMedia',['mixInEventEmitter','FBRTCConstants','FBRTCLogger','FBRTCStreamTester','FBRTCStreamWrapper','FBRTCUserMediaRequest'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function(o,p,q,r){if(this._localStream&&!q&&!r){this.emit('streamReady',this._localStream);}else{this._startRequestListeners();this._pendingRequest=new m(o,p);this._pendingRequest.audioSource=q;this._pendingRequest.videoSource=r;this._pendingRequest.addListener('success',this._onRequestSuccess,this);this._pendingRequest.addListener('failed',this._onRequestFailure,this);this._pendingRequest.request();}},end:function(){this._stopEventListeners();if(this._localStream){l.stopStream(this._localStream);this._localStream=null;}},_startRequestListeners:function(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener('mousedown',this._evListener);document.addEventListener('focus',this._evListener);}},_stopEventListeners:function(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener('mousedown',this._evListener);document.removeEventListener('focus',this._evListener);}},_onMediaPromptHidden:function(){this._promptTimeout=setTimeout((function(){if(!this._accessGranted&&this._pendingRequest)this._pendingRequest.request();}).bind(this),1500);},_onRequestSuccess:function(o){this._stopEventListeners();if(!this._accessGranted){this._accessGranted=true;this.emit('accessGranted');}o.videoMediaSourceId=this._pendingRequest.videoSource;o.audioMediaSourceId=this._pendingRequest.audioSource;var p=new k();p.addListener('streamWorking',(function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==o)l.stopStream(this._localStream);this._localStream=o;this.emit('streamReady',this._localStream);}).bind(this));p.addListener('streamBroken',(function(){l.stopStream(o);this._onRequestFailure('StreamFailedToStart');}).bind(this));p.testStream(o);},_onRequestFailure:function(o){this._stopEventListeners();var p=this._getErrorName(o);if(this._shouldRetryRequest(p,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,p);return;}if(p==='InvalidStateError'){j.getInstance().logErrorWithoutID('Invalid state while requesting user media');return;}this._pendingRequest=null;if(p==='PERMISSION_DENIED'||p==='PermissionDeniedError'||p==='PermissionDismissedError'){this.emit('accessDenied',p);}else{if(p==='NO_DEVICES_FOUND')p='DevicesNotFoundError';j.getInstance().logErrorWithoutID('getUserMedia error: '+p);this.emit('accessFailed',p);}},_getErrorName:function(o){if(o.name)return o.name;return o;},_shouldRetryRequest:function(o,p){return p.streamType!==i.StreamType.AUDIO_ONLY&&(o==='DevicesNotFoundError'||o==='StreamFailedToStart');},_configureRequestForRetry:function(o,p){if(p==='StreamFailedToStart'&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(o.videoSource)this._failedVideoSources.push(o.videoSource);window.MediaStreamTrack.getSources((function(q){for(var r=0;r<q.length;r++){var s=q[r];if(s.kind==='video'&&this._failedVideoSources.indexOf(s.id)===-1){o.videoSource=s.id;o.request();return;}}o.streamType=i.StreamType.AUDIO_ONLY;o.request();}).bind(this));}else{o.streamType=i.StreamType.AUDIO_ONLY;o.request();}}};h(n,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=n;},null);
__d('FBRTCVideoEscalationStore',['FBRTCCallControlActions','FBRTCConstants','FBRTCStore','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l,m;'use strict';var n=25000,o=10000,p=k({direct_video:null,escalated:null,escalation_declined:null,voip:null});l=babelHelpers.inherits(q,j);m=l&&l.prototype;function q(r,s,t){m.constructor.call(this);this.$FBRTCVideoEscalationStore1=r;this.$FBRTCVideoEscalationStore2=s;this.$FBRTCVideoEscalationStore3=t;this.$FBRTCVideoEscalationStore4=t;this.$FBRTCVideoEscalationStore5=false;this.$FBRTCVideoEscalationStore6=null;this.$FBRTCVideoEscalationStore7=null;}q.prototype.isPending=function(){return !!this.$FBRTCVideoEscalationStore6;};q.prototype.callHasEscalated=function(){return this.$FBRTCVideoEscalationStore3;};q.prototype.getCallType=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported){return p.voip;}else if(this.$FBRTCVideoEscalationStore4){return p.direct_video;}else if(this.$FBRTCVideoEscalationStore3){return p.escalated;}else if(this.$FBRTCVideoEscalationStore5)return p.escalation_declined;return p.voip;};q.prototype.__onDispatch=function(r){switch(r.type){case h.Types.RECEIVED_SIGNALING_MESSAGE:var s=r.message;if(r.message_type===i.PayloadType.VIDEO_REQUEST){this.$FBRTCVideoEscalationStore5=true;if(s.ackID){this.$FBRTCVideoEscalationStore8(s);}else this.$FBRTCVideoEscalationStore9(s);}if(r.message_type===i.PayloadType.ACK&&s.msg.ack_type===i.PayloadType.VIDEO_REQUEST)this.$FBRTCVideoEscalationStore10(s);break;case h.Types.ACCEPT_ESCALATION:this.$FBRTCVideoEscalationStore11(true);break;case h.Types.DECLINE_ESCALATION:this.$FBRTCVideoEscalationStore11(false);break;case h.Types.TOGGLE_MUTE_VIDEO:this.$FBRTCVideoEscalationStore5=true;this.getDispatcher().waitFor([this.$FBRTCVideoEscalationStore2.getDispatchToken()]);this.$FBRTCVideoEscalationStore12();break;}};q.prototype.$FBRTCVideoEscalationStore10=function(r){if(this.$FBRTCVideoEscalationStore7&&this.$FBRTCVideoEscalationStore7.msg_id===r.ackID)this.$FBRTCVideoEscalationStore13();};q.prototype.$FBRTCVideoEscalationStore13=function(){clearTimeout(this.$FBRTCVideoEscalationStore14);};q.prototype.$FBRTCVideoEscalationStore15=function(){this.$FBRTCVideoEscalationStore14=setTimeout((function(){if(!this.$FBRTCVideoEscalationStore7)return;this.$FBRTCVideoEscalationStore1.resendPayload(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore7);}).bind(this),o);};q.prototype.$FBRTCVideoEscalationStore8=function(r){if(!this.$FBRTCVideoEscalationStore7||r.ackID!==this.$FBRTCVideoEscalationStore7.msg_id)return;clearTimeout(this.$FBRTCVideoEscalationStore16);this.$FBRTCVideoEscalationStore13();var s=r.msg,t=r.peerID,u=r.callID,v=this.$FBRTCVideoEscalationStore17(s);this.$FBRTCVideoEscalationStore1.sendAck(t,u,s);this.$FBRTCVideoEscalationStore7=null;this.$FBRTCVideoEscalationStore3=v;this.$FBRTCVideoEscalationStore18(v);if(!v&&this.$FBRTCVideoEscalationStore2.localStream.hasVideo())this.$FBRTCVideoEscalationStore2.localStream.toggleMuteVideo();this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore9=function(r){if(this.$FBRTCVideoEscalationStore3){if(this.$FBRTCVideoEscalationStore17(r.msg)){this.$FBRTCVideoEscalationStore6=r;this.$FBRTCVideoEscalationStore11(true);}else this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(false);return;}var s=r.msg,t=r.peerID,u=r.callID;this.$FBRTCVideoEscalationStore1.sendAck(t,u,s);if(this.$FBRTCVideoEscalationStore17(s)){this.$FBRTCVideoEscalationStore6=r;this.$FBRTCVideoEscalationStore16=setTimeout(function(){h.declineEscalation();},n);}else this.$FBRTCVideoEscalationStore6=null;this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore11=function(r){clearTimeout(this.$FBRTCVideoEscalationStore16);if(this.$FBRTCVideoEscalationStore6){var s=this.$FBRTCVideoEscalationStore6,t=s.peerID,u=s.callID,v=s.msgID;this.$FBRTCVideoEscalationStore7=this.$FBRTCVideoEscalationStore1.sendVideoRequestResponse(t,u,v,r);this.$FBRTCVideoEscalationStore15();this.$FBRTCVideoEscalationStore3=r;this.$FBRTCVideoEscalationStore6=null;this.__emitChange();}};q.prototype.$FBRTCVideoEscalationStore12=function(){if(this.$FBRTCVideoEscalationStore3){this.$FBRTCVideoEscalationStore19();return;}this.$FBRTCVideoEscalationStore7=this.$FBRTCVideoEscalationStore1.sendVideoEscalationRequest(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo()){this.$FBRTCVideoEscalationStore15();this.$FBRTCVideoEscalationStore16=setTimeout((function(){if(this.$FBRTCVideoEscalationStore2.localStream.hasVideo())h.toggleMuteVideo();}).bind(this),n);}else{this.$FBRTCVideoEscalationStore13();clearTimeout(this.$FBRTCVideoEscalationStore16);this.$FBRTCVideoEscalationStore7=null;}this.__emitChange();};q.prototype.$FBRTCVideoEscalationStore19=function(){if(!this.$FBRTCVideoEscalationStore2.isRemoteVideoSupported)return;this.$FBRTCVideoEscalationStore1.sendMuteStateUpdate(this.$FBRTCVideoEscalationStore2.peerID,this.$FBRTCVideoEscalationStore2.callID,this.$FBRTCVideoEscalationStore2.localStream.hasVideo());};q.prototype.$FBRTCVideoEscalationStore18=function(r){this.$FBRTCVideoEscalationStore2.remoteStream.setVideoEnabled(r);};q.prototype.$FBRTCVideoEscalationStore17=function(r){return !!(r.reqVideoOn||r.videoon);};f.exports=q;},null);
__d('FBRTCRingback',['RTCConfig','Sound','FBRTCCallModel'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=[h.ringback_mp3_url,h.ringback_ogg_url],l={monitorCallModel:function(m){if(this._subscription)this._subscription.remove();this._callModel=m;this._subscription=m.addListener(this._onChange.bind(this));},_soundIsPlaying:false,_onChange:function(){if(this._callModel.uiState===j.UIState.RINGING){this._startSound();}else this._stopSound();},_startSound:function(){if(!this._soundIsPlaying){i.play(k,this._syncToken(),true);this._soundIsPlaying=true;}},_syncToken:function(){return 'ring_back_'+this._callModel.callID.toString();},_stopSound:function(){if(this._soundIsPlaying){i.stop(k);this._soundIsPlaying=false;}}};f.exports=l;},null);
__d('FBRTCStarRatingStore',['FBRTCLogger','FBRTCStore','FBRTCStarRatingActions'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=babelHelpers.inherits(m,i);l=k&&k.prototype;function m(n,o){l.constructor.call(this);this.$FBRTCStarRatingStore1=n;this.$FBRTCStarRatingStore2=o;}m.prototype.setCallSummary=function(n){this.$FBRTCStarRatingStore1=n;};m.prototype.__onDispatch=function(n){switch(n.type){case j.Types.SUBMIT_RATING:this.$FBRTCStarRatingStore3(n.rating);break;case j.Types.SUBMIT_FEEDBACK:this.$FBRTCStarRatingStore4(n.feedback);break;case j.Types.RATING_SHOWN:this.$FBRTCStarRatingStore5();break;}};m.prototype.$FBRTCStarRatingStore3=function(n){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.RATING,n);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};m.prototype.$FBRTCStarRatingStore4=function(n){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.SURVEY_DETAILS,n);this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};m.prototype.$FBRTCStarRatingStore5=function(){this.$FBRTCStarRatingStore1.addExtraInfo(h.Key.RATING_SHOWN,'1');this.$FBRTCStarRatingStore1.save(this.$FBRTCStarRatingStore2);};f.exports=m;},null);
__d('FBRTCViewController',['FBRTCCallModel','FBRTCConstants','FBRTCLogger','FBRTCRingback','FBRTCScreenSharingUI','FBRTCStarRatingStore'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=500;function o(p,q,r){'use strict';this.$FBRTCViewController1=p;this.$FBRTCViewController2=new m(q,r);this.$FBRTCViewController3=false;this.$FBRTCViewController4=j.getInstance();}o.prototype.init=function(){'use strict';k.monitorCallModel(this.$FBRTCViewController1);this.$FBRTCViewController1.fetchPeerInfo();};o.prototype.onLocalStreamReady=function(p){'use strict';this.$FBRTCViewController1.setLocalStream(p);if(this.$FBRTCViewController1.uiState>h.UIState.MORE_INIT){this.$FBRTCViewController4.logInfo(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,'UI: Already @ MORE_INIT, no update');}else if(this.$FBRTCViewController1.canStartCall()&&!this.$FBRTCViewController1.isCaller){this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);}else this.$FBRTCViewController1.setState(h.UIState.MORE_INIT);};o.prototype.waitForUserInput=function(){'use strict';this.$FBRTCViewController1.setStateFrom(h.UIState.INIT,h.UIState.AWAITING_USER_START);};o.prototype.userMediaRequested=function(){'use strict';setTimeout((function(){this.$FBRTCViewController1.setStateFrom(h.UIState.INIT,h.UIState.PENDING_LOCAL_MEDIA);}).bind(this),n);};o.prototype.userMediaGranted=function(){'use strict';this.$FBRTCViewController1.setState(h.UIState.MORE_INIT);};o.prototype.userMediaDenied=function(){'use strict';this.$FBRTCViewController1.setState(h.UIState.USER_MEDIA_DENIED);};o.prototype.onTurnCredentialsReady=function(p){'use strict';if(!this.$FBRTCViewController1.isCaller)this.$FBRTCViewController1.setStateFrom(h.UIState.MORE_INIT,h.UIState.CALL_CONNECTING);};o.prototype.onMessageTypeSent=function(p){'use strict';if(p!==i.PayloadType.OFFER&&p!==i.PayloadType.PCRESTART_OFFER)return;if(p===i.PayloadType.PCRESTART_OFFER)this.$FBRTCViewController3=true;if(p===i.PayloadType.OFFER)this.$FBRTCViewController1.setState(h.UIState.CONTACTING);};o.prototype.onMessageTypeReceived=function(p){'use strict';if(this.$FBRTCViewController3){if(p===i.PayloadType.ANSWER)this.$FBRTCViewController1.setStateFrom(h.UIState.CONTACTING,h.UIState.CALL_CONNECTING);}else if(p===i.PayloadType.OFFER_ACK){this.$FBRTCViewController1.setStateFrom(h.UIState.CONTACTING,h.UIState.RINGING);}else if(p===i.PayloadType.ANSWER)if(this.$FBRTCViewController1.uiState===h.UIState.CONTACTING||this.$FBRTCViewController1.uiState===h.UIState.RINGING)this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);};o.prototype.onRemoteStreamAdded=function(event){'use strict';this.$FBRTCViewController1.setRemoteStream(event.stream);};o.prototype.end=function(p,q){'use strict';this.$FBRTCViewController1.endCallReason=p;this.$FBRTCViewController1.isRemoteEnded=q;this.$FBRTCViewController1.setState(h.UIState.CALL_ENDED);};o.prototype.reset=function(p,q){'use strict';this.$FBRTCViewController1.resetForReconnect(p);this.$FBRTCViewController2.setCallSummary(q);this.$FBRTCViewController1.setState(h.UIState.CALL_CONNECTING);};o.prototype.$FBRTCViewController5=function(p,q){'use strict';this.$FBRTCViewController4.logCallAction(this.$FBRTCViewController1.peerID,this.$FBRTCViewController1.callID,p,q?'true':'false');};f.exports=o;},null);
__d("FBRTCWindowManager",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={height:0,width:0,top:0,left:0},i={height:447,width:675,bottomRightOffset:50},j={init:function(k,l){this._window=k;this._callModel=l;l.addListener(this._setProgressIndicator.bind(this));this._setProgressIndicator();this._monitorOpenerForChanges();this._storePosition();},updatePosition:function(k){if(!this._window)return;if(k&&h.height>0&&h.width>0){this._window.moveTo(h.left,h.top);this._window.resizeTo(h.width,h.height);return;}this._storePosition();this._window.resizeTo(i.width,i.height);var l=screen.width-i.width-i.bottomRightOffset,m=screen.height-i.height-i.bottomRightOffset;this._window.moveTo(l,m);},reload:function(){if(this._window&&!this._window.closed)this._window.location.reload();},close:function(){if(this._window&&!this._window.closed)this._window.close();},_setProgressIndicator:function(){if(this._callModel.isEnded()){this._window.rtcCallInProgessWith=null;}else this._window.rtcCallInProgessWith=this._callModel.peerID.toString();},_monitorOpenerForChanges:function(){if(this._window.opener)try{this._window.opener.addEventListener("unload",(function(event){this._passWindowToOpener(10);}).bind(this));}catch(k){}},_passWindowToOpener:function(k){setTimeout((function(){setTimeout((function(){if(this._window.opener&&!this._window.opener.closed)this._window.opener.rtcCallChildWindow=this._window;}).bind(this),1);if(k>1)this._passWindowToOpener(k-1);}).bind(this),1000);},_storePosition:function(){if(this._window){if(this._window.innerWidth!==undefined){h.height=this._window.outerHeight;h.width=this._window.outerWidth;}else{h.height=this._window.screen.height;h.width=this._window.screen.width;}if(this._window.screenLeft!==undefined){h.left=this._window.screenLeft;h.top=this._window.screenTop;}else{h.left=this._window.screenX;h.top=this._window.screenY;}}}};f.exports=j;},null);
__d('FBRTCCallController',['ErrorUtils','Run','FBRTCCallConnection','FBRTCCallConnectionMonitor','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallMonitor','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConfig','FBRTCConstants','FBRTCDispatcher','FBRTCExperiment','FBRTCIceCache','FBRTCLocalMessageQueue','FBRTCLogger','FBRTCMessage','FBRTCMessageDedup','FBRTCMessageListener','FBRTCMessageSender','FBRTCPCConfig','FBRTCTurnDiscovery','FBRTCUserMedia','FBRTCViewController','FBRTCCallModelStatePusher','FBRTCCallDialogController','FBRTCRetriableMessage','FBRTCUserSettings','FBRTCScreenSharingController','FBRTCScreenSharingUtils','FBRTCSdpUtils','FBRTCUrlManager','FBRTCUtils','FBRTCVideoEscalationStore','FBRTCWindowManager','RTCConfig','fbt','randomInt','ChannelManager'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa){if(c.__markCompiled)c.__markCompiled();c('ChannelManager');var ta=60000,ua=3000;function va(){return sa(0,4294967295);}function wa(xa,ya,za,ab){'use strict';this.$FBRTCCallController1=w.getInstance();this.$FBRTCCallController2=new v();this.$FBRTCCallController3=p.getInstance();this.$FBRTCCallController4=null;this.$FBRTCCallController5=false;if(!za){var bb=this.$FBRTCCallController2.getOffer(xa);if(bb){this.$FBRTCCallController4=new x(bb);y.check(xa,this.$FBRTCCallController4.callID,this.$FBRTCCallController4.msgID);}else za=true;}if(!ya)ya=this.$FBRTCCallController4?this.$FBRTCCallController4.callID:va();this.$FBRTCCallController1.logCallAction(xa,ya,w.CallAction.POPUP_OPENED);this.$FBRTCCallController6=new m({peerID:xa,callID:ya,isCaller:za});if(this.$FBRTCCallController4)this.$FBRTCCallController6.onSDPMessageFromPeer(this.$FBRTCCallController4);this.$FBRTCCallController6.localStream.setVideoEnabled(!ab);this.$FBRTCCallController7=new fa(this.$FBRTCCallController6);this.$FBRTCCallController8=o.restoreOrInitialize(this.$FBRTCCallController3,xa,ya,za,this.$FBRTCCallController4&&this.$FBRTCCallController4.msg);this.$FBRTCCallController8.onPopupOpened();ma.init(this.$FBRTCCallController6.peerID);pa.init(window,this.$FBRTCCallController6);this.$FBRTCCallController9=new ja(xa,ya,false);if(ka.isScreenSharingSupported())this.$FBRTCCallController9.addListener(this.$FBRTCCallController10.bind(this));this.$FBRTCCallController11=new ea(this.$FBRTCCallController6,this.$FBRTCCallController8,this.$FBRTCCallController3);this.$FBRTCCallController11.init();this.$FBRTCCallController12=new j();this.$FBRTCCallController12.addListener('remoteStreamAdded',this.$FBRTCCallController13,this);this.$FBRTCCallController12.addListener('remoteStreamRemoved',this.$FBRTCCallController14,this);this.$FBRTCCallController12.addListener('sdpCreated',this.$FBRTCCallController15,this);this.$FBRTCCallController12.addListener('localIceCandidateCreated',this.$FBRTCCallController16,this);this.$FBRTCCallController12.addListener('remoteDescriptionSet',this.$FBRTCCallController17,this);this.$FBRTCCallController12.addListener('connected',this.$FBRTCCallController18,this);this.$FBRTCCallController12.addListener('disconnected',this.$FBRTCCallController19,this);this.$FBRTCCallController12.addListener('connectionUnstable',this.$FBRTCCallController20,this);this.$FBRTCCallController12.addListener('connectionError',this.$FBRTCCallController21,this);this.$FBRTCCallController22=false;this.$FBRTCCallController23=new k(this.$FBRTCCallController12,this.$FBRTCCallController8);this.$FBRTCCallController23.addListener('connectionPoor',this.$FBRTCCallController24,this);this.$FBRTCCallController25=new aa();this.$FBRTCCallController25.onMessageSent=this.$FBRTCCallController26.bind(this);this.$FBRTCCallController25.onSendFailure=this.$FBRTCCallController27.bind(this);this.$FBRTCCallController28=null;this.$FBRTCCallController29=null;this.$FBRTCCallController30=new oa(this.$FBRTCCallController25,this.$FBRTCCallController6,!ab);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController30.addListener(this.$FBRTCCallController31.bind(this));this.$FBRTCCallController32=new u();this.$FBRTCCallController33=false;i.onBeforeUnload(this.$FBRTCCallController34.bind(this),false);i.onUnload(this.$FBRTCCallController35.bind(this));h.addListener(this.$FBRTCCallController36.bind(this),true);z.init(true,this.$FBRTCCallController6.peerID);z.setMessageHandler(this.$FBRTCCallController37,this);var cb=this;this.$FBRTCCallController38=new n(this.$FBRTCCallController6);this.$FBRTCCallController38.startHeartbeat(function(){return cb.$FBRTCCallController8;});this.$FBRTCCallController39=null;ia.addListener('saved',this.$FBRTCCallController40,this);ca.addListener('receivedTurnCreds',this.$FBRTCCallController41,this);ca.addListener('failed',this.$FBRTCCallController42,this);ca.requestTurnCreds(this.$FBRTCCallController6);s.register(this.__onDispatch.bind(this));this.$FBRTCCallController43=setTimeout((function(){this.waitForUserInput();}).bind(this),1500);}wa.prototype.__onDispatch=function(xa){'use strict';switch(xa.type){case l.Types.HANG_UP:this.$FBRTCCallController44(r.CallEndReason.HANGUP_CALL,false,true,false);break;case l.Types.TOGGLE_SCREEN_SHARING:if(this.$FBRTCCallController9)this.$FBRTCCallController9.toggleScreenSharing(this.$FBRTCCallController6);break;case l.Types.SHOW_SETTINGS:ga.showDialog(ga.dialogTypes.SETTINGS,this.$FBRTCCallController6);break;case l.Types.ACCEPT_ESCALATION:this.$FBRTCCallController6.localStream.setVideoEnabled(true);this.$FBRTCCallController45(true);break;case l.Types.RESET_CALL:this.$FBRTCCallController46(xa);break;case l.Types.PARENT_WINDOW_START_CALL:if(this.$FBRTCCallController6.canBeStartedByParentWindow())this.startCallProcess();break;case l.Types.START_CALL:this.$FBRTCCallController47(w.Trigger.POPUP_CALL_START_BUTTON);break;}};wa.prototype.getCallModel=function(){'use strict';return this.$FBRTCCallController6;};wa.prototype.getConnection=function(){'use strict';return this.$FBRTCCallController12;};wa.prototype.sendData=function(xa,ya){'use strict';this.$FBRTCCallController12.sendData({topic:xa,data:ya});};wa.prototype.addDataChannelListener=function(xa,ya){'use strict';return this.$FBRTCCallController12.addListener('data_message',xa,ya);};wa.prototype.$FBRTCCallController47=function(xa){'use strict';this.$FBRTCCallController8.onCallStarted(xa);this.startCallProcess();};wa.prototype.startCallProcess=function(){'use strict';this.$FBRTCCallController48();this.$FBRTCCallController11.userMediaRequested();};wa.prototype.waitForUserInput=function(){'use strict';this.$FBRTCCallController11.waitForUserInput();};wa.prototype.$FBRTCCallController48=function(){'use strict';da.once('streamReady',this.$FBRTCCallController49,this);da.addListener('accessDenied',this.$FBRTCCallController50,this);da.addListener('accessFailed',this.$FBRTCCallController51,this);da.addListener('accessGranted',this.$FBRTCCallController52,this);this.$FBRTCCallController6.localStream.addListener('streamStarted',(function(){var xa=this.$FBRTCCallController6.localStream.videoWidth,ya=this.$FBRTCCallController6.localStream.videoHeight;this.$FBRTCCallController8.setVideoCaptureStats(xa,ya);}).bind(this));this.$FBRTCCallController53();};wa.prototype.$FBRTCCallController53=function(){'use strict';var xa;if(!this.$FBRTCCallController6.isRemoteVideoSupported){xa=r.VideoQuality.NO_VIDEO;}else if(this.$FBRTCCallController6.isPeerOnMobile){xa=r.VideoQuality.LQ_VIDEO;}else if(na.isCollabCallable(this.$FBRTCCallController6.peerID)){xa=r.VideoQuality.CUSTOM_VIDEO;}else xa=r.VideoQuality.SD_VIDEO;var ya=r.StreamType.AUDIO_ONLY;if(this.$FBRTCCallController6.localStream&&this.$FBRTCCallController6.localStream.hasVideoTracks())ya=r.StreamType.AUDIO_VIDEO;this.$FBRTCCallController54=xa;da.requestUserMedia(ya,xa,ia.savedMic,ia.savedCamera);};wa.prototype.$FBRTCCallController40=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,w.CallAction.USER_SETTINGS_CHANGED);da.once('streamReady',(function(xa){ia.updateForLocalStream(xa);this.$FBRTCCallController6.setLocalStream(xa);this.$FBRTCCallController55();}).bind(this));this.$FBRTCCallController53();};wa.prototype.$FBRTCCallController10=function(){'use strict';var xa=this.$FBRTCCallController9.isEnabled(),ya=this.$FBRTCCallController9.getStream();if(xa){this.$FBRTCCallController12.addScreenStream(ya);}else{this.$FBRTCCallController12.removeScreenStream(ya);this.$FBRTCCallController9.onStop();}this.$FBRTCCallController55();pa.updatePosition(!xa);if(xa){this.$FBRTCCallController6.setLocalScreenStream(ya);}else this.$FBRTCCallController6.setLocalScreenStream(null);};wa.prototype.$FBRTCCallController13=function(event){'use strict';if(this.$FBRTCCallController12.isScreenStream(event.stream)&&this.$FBRTCCallController12.getRemoteStreamsCount()>1){this.$FBRTCCallController9.setRemoteStream(event.stream);this.$FBRTCCallController6.setRemoteScreenStream(this.$FBRTCCallController9.getStream());}else{this.$FBRTCCallController11.onRemoteStreamAdded(event);if(this.$FBRTCCallController6.isCaller&&this.$FBRTCCallController6.supportsSdpUpdate())this.$FBRTCCallController56=setTimeout((function(){this.$FBRTCCallController57();}).bind(this),ua);}};wa.prototype.$FBRTCCallController57=function(){'use strict';if(!this.$FBRTCCallController6.isRemoteVideoSupported&&this.$FBRTCCallController54===r.VideoQuality.NO_VIDEO){return;}else if(this.$FBRTCCallController6.isPeerOnMobile&&this.$FBRTCCallController54===r.VideoQuality.LQ_VIDEO)return;this.$FBRTCCallController55();};wa.prototype.$FBRTCCallController14=function(event){'use strict';var xa=this.$FBRTCCallController6.getRemoteScreenStream();if(xa&&event.stream&&xa.getStreamId()==event.stream.id){this.$FBRTCCallController6.setRemoteScreenStream(null);this.$FBRTCCallController9.setRemoteStream(null);}clearTimeout(this.$FBRTCCallController56);};wa.prototype.$FBRTCCallController20=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network unstable');};wa.prototype.$FBRTCCallController24=function(){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Network poor');if(q.shouldAutoDisableVideo())this.$FBRTCCallController6.autoDisableVideo();};wa.prototype.$FBRTCCallController36=function(xa){'use strict';var ya=xa.message+'; '+xa.stackFrames[0].identifier;this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'JSError: '+ya);};wa.prototype.$FBRTCCallController34=function(){'use strict';if(this.$FBRTCCallController6.isInProgress())return ra._("Leaving this page will end your call.");};wa.prototype.$FBRTCCallController35=function(){'use strict';if(this.$FBRTCCallController6.isEnded())return;var xa=this.$FBRTCCallController6.isUserMediaPending(),ya=this.$FBRTCCallController6.isUserMediaDenied(),za=r.CallEndReason.HANGUP_CALL,ab='BrowserClosed';if(xa||ya){za=r.CallEndReason.CLIENT_ERROR;ab=xa?'MediaPending':'MediaDenied';}else if(this.$FBRTCCallController6.isAwaitingUserStart())ab='AwaitingUserStart';this.$FBRTCCallController44(za,false,true,true,ab);};wa.prototype.$FBRTCCallController41=function(xa){'use strict';this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Received Turn Creds');ba.setTurnCredentials(xa);this.$FBRTCCallController11.onTurnCredentialsReady(xa);this.$FBRTCCallController58();};wa.prototype.$FBRTCCallController42=function(){'use strict';this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Failed to get turn creds');this.$FBRTCCallController44(r.CallEndReason.CLIENT_ERROR,false,!this.$FBRTCCallController6.isCaller,false,'NoTurnCreds');};wa.prototype.$FBRTCCallController58=function(){'use strict';if(this.$FBRTCCallController6.canStartCall()){ma.onCallStarted();var xa=this.$FBRTCCallController6.localStream;this.$FBRTCCallController12.init(xa);if(!this.$FBRTCCallController4){this.$FBRTCCallController12.createOffer();}else{if(this.$FBRTCCallController4.isFromMobile()&&!xa.hasVideoTracks())this.$FBRTCCallController4.disableVideo();if(this.$FBRTCCallController4.msg.hasOwnProperty('videoon'))this.$FBRTCCallController45(this.$FBRTCCallController4.msg.videoon);this.$FBRTCCallController6.setSignalingExperiments(this.$FBRTCCallController4.getSignalingExperiments());this.$FBRTCCallController59(this.$FBRTCCallController4.msg.sdp,true,this.$FBRTCCallController4.msg.attributes);this.$FBRTCCallController2.removeOffer(this.$FBRTCCallController6.peerID);this.$FBRTCCallController4=null;}}};wa.prototype.$FBRTCCallController55=function(){'use strict';if(this.$FBRTCCallController6.isAwaitingAnswer()){this.$FBRTCCallController22=true;}else{this.$FBRTCCallController22=false;if(this.$FBRTCCallController6.supportsSdpUpdate()){this.$FBRTCCallController12.createSdpUpdate();}else{this.$FBRTCCallController5=true;this.$FBRTCCallController32.reset(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID);this.$FBRTCCallController33=false;this.$FBRTCCallController12.createOffer();}}};wa.prototype.$FBRTCCallController49=function(xa){'use strict';ia.updateForLocalStream(xa);this.$FBRTCCallController11.onLocalStreamReady(xa);this.$FBRTCCallController58();};wa.prototype.$FBRTCCallController50=function(){'use strict';this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,w.CallAction.DENIED_PERMISSION);this.$FBRTCCallController11.userMediaDenied();};wa.prototype.$FBRTCCallController51=function(xa){'use strict';this.$FBRTCCallController44(r.CallEndReason.CLIENT_ERROR,false,true,false,xa);ga.showDialog(ga.dialogTypes.ERROR_ACCESSING_MEDIA,this.$FBRTCCallController6);};wa.prototype.$FBRTCCallController52=function(){'use strict';this.$FBRTCCallController11.userMediaGranted();};wa.prototype.$FBRTCCallController15=function(xa){'use strict';switch(xa.type){case 'offer':this.$FBRTCCallController60(xa.sdp,xa.attributes);break;case 'answer':this.$FBRTCCallController61(xa.sdp,xa.attributes);break;case 'sdp_update':this.$FBRTCCallController62(xa.sdp,xa.attributes);break;default:break;}};wa.prototype.$FBRTCCallController62=function(xa,ya){'use strict';this.$FBRTCCallController25.sendSdpUpdate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,xa,this.$FBRTCCallController6.localStream.hasVideo(),ya);};wa.prototype.$FBRTCCallController60=function(xa,ya){'use strict';var za;if(!this.$FBRTCCallController5){za=r.PayloadType.OFFER;}else{za=r.PayloadType.PCRESTART_OFFER;this.$FBRTCCallController5=false;}this.$FBRTCCallController28=new ha(this.$FBRTCCallController25);this.$FBRTCCallController28.addListener('sendingRetry',this.$FBRTCCallController63.bind(this));this.$FBRTCCallController28.addListener('timeoutFailure',this.$FBRTCCallController64.bind(this));this.$FBRTCCallController28.sendMessage(za,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,xa,this.$FBRTCCallController6.localStream.hasVideo(),ya);this.$FBRTCCallController39=setTimeout((function(){this.$FBRTCCallController44(r.CallEndReason.NO_ANSWER_TIMEOUT,false,true,false);}).bind(this),ta);};wa.prototype.$FBRTCCallController64=function(){'use strict';var xa;if(this.$FBRTCCallController6.receivedNack){xa=r.CallEndReason.UNSUPPORTED_VERSION;ga.showDialog(ga.dialogTypes.PEER_BROWSER_UNSUPPORTED,this.$FBRTCCallController6);}else xa=r.CallEndReason.OTHER_NOT_CAPABLE;this.$FBRTCCallController44(xa,false,true,false,'TimedOut');};wa.prototype.$FBRTCCallController45=function(xa){'use strict';this.$FBRTCCallController6.remoteStream.setVideoEnabled(xa);};wa.prototype.$FBRTCCallController61=function(xa,ya){'use strict';var za=this.$FBRTCCallController6.localStream.hasVideo()&&this.$FBRTCCallController6.isRemoteVideoSupported;this.$FBRTCCallController29=new ha(this.$FBRTCCallController25);this.$FBRTCCallController29.addListener('sendingRetry',this.$FBRTCCallController63.bind(this));this.$FBRTCCallController29.sendMessage(r.PayloadType.ANSWER,this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,xa,za,ya);};wa.prototype.$FBRTCCallController63=function(){'use strict';var xa=this.$FBRTCCallController12.getCreatedIceCandidates();for(var ya=0;ya<xa.length;ya++)this.$FBRTCCallController65(xa[ya]);};wa.prototype.$FBRTCCallController65=function(xa){'use strict';this.$FBRTCCallController25.sendIceCandidate(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,xa);};wa.prototype.$FBRTCCallController59=function(xa,ya,za){'use strict';this.$FBRTCCallController12.setPeerSupportsVideo(this.$FBRTCCallController6.isRemoteVideoSupported);if(this.$FBRTCCallController6.isPeerOnMobile)xa=la.setVideoBitrateConstraint(xa);if(ya){this.$FBRTCCallController12.onReceivedOfferSDP(xa,za);}else this.$FBRTCCallController12.onReceivedAnswerSDP(xa,za);};wa.prototype.$FBRTCCallController16=function(xa){'use strict';this.$FBRTCCallController65(xa);};wa.prototype.$FBRTCCallController17=function(){'use strict';this.$FBRTCCallController33=true;var xa=this;this.$FBRTCCallController32.drainCandidates(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,function(ya){xa.$FBRTCCallController12.onReceivedRemoteIceCandidate(ya);});};wa.prototype.$FBRTCCallController18=function(){'use strict';this.$FBRTCCallController66();this.$FBRTCCallController8.onCallConnected();this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Call Connected');};wa.prototype.$FBRTCCallController19=function(){'use strict';this.$FBRTCCallController44(r.CallEndReason.CONNECTION_DROPPED,false,true,false);};wa.prototype.$FBRTCCallController21=function(xa){'use strict';this.$FBRTCCallController44(r.CallEndReason.WEBRTC_ERROR,false,true,false,xa.endCallSubreason);this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'webrtc error: '+JSON.stringify(xa.details));};wa.prototype.$FBRTCCallController27=function(xa,ya){'use strict';this.$FBRTCCallController44(xa,false,false,false,ya);};wa.prototype.$FBRTCCallController26=function(xa,ya){'use strict';var za=ya.call_id,ab=ya.type;if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Message sent after call ended: '+ab);return;}if(this.$FBRTCCallController6.peerID!==xa||this.$FBRTCCallController6.callID!==za)return;this.$FBRTCCallController11.onMessageTypeSent(ab);this.$FBRTCCallController8.onMessageSent(ya);};wa.prototype.$FBRTCCallController37=function(xa){'use strict';var ya;try{ya=new x(xa);}catch(za){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Unknown data: '+JSON.stringify(xa));return;}this.$FBRTCCallController1.logReceivedMessage(ya.peerID,ya.callID,ya.msg);if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (call ended): '+ya.msgID);return;}if(!y.check(ya.peerID,ya.callID,ya.msgID)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (duplicate): '+ya.msgID);return;}if(this.$FBRTCCallController6.isAwaitingUserStart())return;if(this.$FBRTCCallController6.peerID&&this.$FBRTCCallController6.peerID!==ya.peerID){if(ya.isOffer())this.$FBRTCCallController67(ya);this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different peer): '+ya.msgID);return;}if(!ya.isForCall(this.$FBRTCCallController6)){this.$FBRTCCallController1.logInfo(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring message (different call): '+ya.msgID);return;}this.$FBRTCCallController11.onMessageTypeReceived(ya.msgType);if(this.$FBRTCCallController6.callID&&this.$FBRTCCallController6.callID===ya.callID)this.$FBRTCCallController8.onFullMessageReceived(ya);this.$FBRTCCallController6.setSignalingExperiments(ya.getSignalingExperiments());switch(ya.msgType){case r.PayloadType.OFFER:case r.PayloadType.ICERESTART_OFFER:case r.PayloadType.PCRESTART_OFFER:this.$FBRTCCallController68(ya);break;case r.PayloadType.ANSWER:case r.PayloadType.ICERESTART_ANSWER:case r.PayloadType.PCRESTART_ANSWER:this.$FBRTCCallController69(ya);this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);break;case r.PayloadType.SDP_UPDATE:this.$FBRTCCallController70(ya);break;case r.PayloadType.ICE_CANDIDATE:this.$FBRTCCallController71(ya);break;case r.PayloadType.HANGUP:this.$FBRTCCallController72(ya);break;case r.PayloadType.OFFER_ACK:this.$FBRTCCallController73();break;case r.PayloadType.OFFER_NACK:this.$FBRTCCallController6.receivedNack=true;break;case r.PayloadType.ANSWER_ACK:this.$FBRTCCallController74();break;case r.PayloadType.MSG_ACK:this.$FBRTCCallController75(ya);break;case r.PayloadType.SET_VIDEO:if(this.$FBRTCCallController6.isRemoteVideoSupported&&(this.$FBRTCCallController30.callHasEscalated()||!this.$FBRTCCallController6.isPeerOnMobile))this.$FBRTCCallController45(ya.msg.videoon);break;case r.PayloadType.VIDEO_REQUEST:case r.PayloadType.ACK:case r.PayloadType.OK:case r.PayloadType.PING:case r.PayloadType.OTHER_DISMISS:case r.PayloadType.PRANSWER:break;default:break;}l.receivedSignalingMessage(ya);};wa.prototype.$FBRTCCallController67=function(xa){'use strict';var ya=xa.peerID,za=xa.callID,ab=xa.msg,bb=new o({peerID:ya,callID:za,isCaller:false});bb.onFullMessageReceived(xa);this.$FBRTCCallController25.sendOfferAck(ya,za,ab);bb.onOfferAckSent(ab);var cb=r.CallEndReason.IN_ANOTHER_CALL;this.$FBRTCCallController76(ya,za,cb);bb.onCallEnded(cb,false);bb.save(this.$FBRTCCallController3);};wa.prototype.$FBRTCCallController68=function(xa){'use strict';var ya=xa.msg;this.$FBRTCCallController25.sendOfferAck(this.$FBRTCCallController6.peerID,ya.call_id,ya);this.$FBRTCCallController25.sendOtherDismiss(ya.call_id);if(this.$FBRTCCallController77(ya)){this.$FBRTCCallController78(xa);}else this.$FBRTCCallController79();};wa.prototype.$FBRTCCallController70=function(xa){'use strict';var ya=xa.msg,za=ya.sdp;if(ya.hasOwnProperty('videoon'))this.$FBRTCCallController45(ya.videoon);if(this.$FBRTCCallController6.isPeerOnMobile)za=la.setVideoBitrateConstraint(za);this.$FBRTCCallController12.onReceivedSdpUpdate(za,ya.attributes);};wa.prototype.$FBRTCCallController77=function(xa){'use strict';if(xa.call_id===this.$FBRTCCallController6.callID)return true;return ((this.$FBRTCCallController39||!this.$FBRTCCallController4)&&(!this.$FBRTCCallController6.callID||xa.call_id!==this.$FBRTCCallController6.callID)&&this.$FBRTCCallController6.isCaller&&(!xa.handlescollision||xa.call_id<this.$FBRTCCallController6.callID));};wa.prototype.$FBRTCCallController78=function(xa){'use strict';var ya=xa.msg;if(ya.hasOwnProperty('videoon'))this.$FBRTCCallController45(ya.videoon);this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController66();if(this.$FBRTCCallController6.callID!==ya.call_id){var za=r.CallEndReason.OTHER_INSTANCE_HANDLED;this.$FBRTCCallController76(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,za);this.$FBRTCCallController8.onCallEnded(za,false);this.$FBRTCCallController8.save(this.$FBRTCCallController3);this.$FBRTCCallController8=new o({peerID:this.$FBRTCCallController6.peerID,callID:ya.call_id,isCaller:false});this.$FBRTCCallController8.onFullMessageReceived(xa);this.$FBRTCCallController8.onOfferAckSent(ya);this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Handling offer collision');}else this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Handling offer refresh');this.$FBRTCCallController12.end();this.$FBRTCCallController33=false;this.$FBRTCCallController11.reset(ya.call_id,this.$FBRTCCallController8);this.$FBRTCCallController6.onSDPMessageFromPeer(xa);this.$FBRTCCallController4=xa;this.$FBRTCCallController58();};wa.prototype.$FBRTCCallController79=function(){'use strict';this.$FBRTCCallController1.logEvent(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ignoring offer');};wa.prototype.$FBRTCCallController69=function(xa){'use strict';var ya=xa.msg;this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController25.sendAnswerAck(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,ya);this.$FBRTCCallController6.onSDPMessageFromPeer(xa);if(this.$FBRTCCallController22){this.$FBRTCCallController55();}else{this.$FBRTCCallController59(ya.sdp,false,ya.attributes);if(ya.hasOwnProperty('videoon'))this.$FBRTCCallController45(ya.videoon);}};wa.prototype.$FBRTCCallController75=function(xa){'use strict';var ya=xa.msg;if(this.$FBRTCCallController28&&this.$FBRTCCallController28.isAckMsg(ya)){this.$FBRTCCallController8.onMsgAckReceived(xa,true);this.$FBRTCCallController11.onMessageTypeReceived(r.PayloadType.OFFER_ACK);this.$FBRTCCallController73();}else if(this.$FBRTCCallController29&&this.$FBRTCCallController29.isAckMsg(ya)){this.$FBRTCCallController8.onMsgAckReceived(xa,false);this.$FBRTCCallController74();}};wa.prototype.$FBRTCCallController73=function(){'use strict';this.$FBRTCCallController80();this.$FBRTCCallController38.onCallHeartbeat(this.$FBRTCCallController8);};wa.prototype.$FBRTCCallController74=function(){'use strict';this.$FBRTCCallController66();};wa.prototype.$FBRTCCallController71=function(xa){'use strict';var ya=xa.msg;if(ya.call_id===this.$FBRTCCallController6.callID&&this.$FBRTCCallController33){this.$FBRTCCallController12.onReceivedRemoteIceCandidate(ya);}else this.$FBRTCCallController32.cacheCandidate(this.$FBRTCCallController6.peerID,ya.call_id,ya);};wa.prototype.$FBRTCCallController72=function(xa){'use strict';var ya=xa.msg;if(ya.call_id===this.$FBRTCCallController6.callID){this.$FBRTCCallController44(ya.reason,true,false,false,ya.subreason);}else this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Receiving hangup for a different call: '+ya.call_id.toString());};wa.prototype.$FBRTCCallController46=function(xa){'use strict';var ya=xa.trigger;if(!ya||ya!==w.Trigger.RESET_CALL)return;var za=r.CallEndReason.HANGUP_CALL;this.$FBRTCCallController44(za,false,true,false,'CallReset');pa.reload();};wa.prototype.$FBRTCCallController44=function(xa,ya,za,ab,bb){'use strict';if(typeof xa=='string'||xa instanceof String)xa=r.endCallReasonFromString(xa);var cb=r.fullCallEndReasonString(xa,ya);this.$FBRTCCallController1.logCallAction(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,w.CallAction.END_CALL,cb);this.$FBRTCCallController80();this.$FBRTCCallController81();this.$FBRTCCallController66();if(this.$FBRTCCallController6.isEnded()){this.$FBRTCCallController1.logError(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,'Ending an already-ended call');return;}if(za)this.$FBRTCCallController76(this.$FBRTCCallController6.peerID,this.$FBRTCCallController6.callID,xa,ab,bb);this.$FBRTCCallController9.onEndCall();this.$FBRTCCallController12.end();da.end();this.$FBRTCCallController11.end(xa,ya);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController8.setVideoDurations(this.$FBRTCCallController6.getLocalVideoDuration(),this.$FBRTCCallController6.getRemoteVideoDuration());this.$FBRTCCallController8.onCallEnded(xa,ya,null,bb);this.$FBRTCCallController8.save(this.$FBRTCCallController3);clearTimeout(this.$FBRTCCallController56);if(xa===r.CallEndReason.HANGUP_CALL&&bb==='CallReset'&&ya)pa.close();};wa.prototype.$FBRTCCallController76=function(xa,ya,za,ab,bb){'use strict';this.$FBRTCCallController25.sendHangup(xa,ya,za,ab,bb);this.$FBRTCCallController25.sendOtherDismiss(ya);};wa.prototype.$FBRTCCallController80=function(){'use strict';if(this.$FBRTCCallController28)this.$FBRTCCallController28.stopRetrying();};wa.prototype.$FBRTCCallController66=function(){'use strict';if(this.$FBRTCCallController29)this.$FBRTCCallController29.stopRetrying();};wa.prototype.$FBRTCCallController81=function(){'use strict';if(this.$FBRTCCallController39)clearTimeout(this.$FBRTCCallController39);this.$FBRTCCallController39=null;};wa.prototype.$FBRTCCallController31=function(){'use strict';if(this.$FBRTCCallController30.isPending()){ga.showDialog(ga.dialogTypes.VIDEO_ESCALATION,this.$FBRTCCallController6);}else ga.hideDialogType(ga.dialogTypes.VIDEO_ESCALATION);this.$FBRTCCallController8.setCallType(this.$FBRTCCallController30.getCallType());this.$FBRTCCallController8.save(this.$FBRTCCallController3);};f.exports=wa;},null);
__d('FBRTCBackground.react',['Image.react','ReactComponentWithPureRenderMixin','React','WorkModeConfig','cx'],function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();var m='/images/messengerdotcom/favicon/favicon.ico',n='/images/messengerdotcom/favicon/favicon_work.ico',o='/images/messengerdotcom/favicon/favicon_sandbox.ico',p=j.PropTypes,q=j.createClass({displayName:'FBRTCBackground',mixins:[i],propTypes:{messengerUI:p.bool.isRequired,src:p.string},getInitialState:function(){this._updateFavicon();return {showCoverPhoto:true};},render:function(){if(this.props.messengerUI)return null;var r=this.props.src;if(this.state.showCoverPhoto&&r){return (j.createElement('div',{className:"_1_5p"},j.createElement('div',{className:"_1_5q"}),j.createElement(h,{src:r,className:"_1_5r",alt:'',onError:this._imageError})));}else return j.createElement('div',{className:"_1_5p"});},_imageError:function(){this.setState({showCoverPhoto:false});},_updateFavicon:function(){var r=document.querySelector('link[rel*=icon][href*=".ico"]'),s=false;if(s){r.href=o;}else if(k.is_work_user){r.href=n;}else r.href=m;}});f.exports=q;},null);
__d('FBRTCCallControlPopover.react',['LayerFadeOnHide','LayerFadeOnShow','React','ReactDOM','ReactComponentWithPureRenderMixin','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';if(c.__markCompiled)c.__markCompiled();var q=j.PropTypes,r={NONE:0,REMOTE_VIDEO_UNSUPPORTED:1,NO_VIDEO_TRACKS:2,VIDEO_AUTO_DISABLED:3,SCREENSHARING_UNAVAILABLE:4,PEER_IS_SHARING_SCREEN:5},s=j.createClass({displayName:'FBRTCCallControlPopover',mixins:[l],propTypes:{reason:q.number.isRequired,peerName:q.string.isRequired,isVCEndpointCall:q.bool,reference:q.object.isRequired,visible:q.bool.isRequired,width:q.number.isRequired},render:function(){var t=this._getTitle();if(t)return (j.createElement(m,this._popoverProps(),t,this._getBody()));return (j.createElement(m,this._popoverProps(),this._getBody()));},_getTitle:function(){if(this.props.reason===r.NO_VIDEO_TRACKS)return (j.createElement(o,null,p._("Can't find camera")));},_getBody:function(){var t=null;switch(this.props.reason){case r.NONE:break;case r.REMOTE_VIDEO_UNSUPPORTED:t=p._("Video is disabled for this call because {name}'s device does not support video.",[p.param('name',this.props.peerName)]);break;case r.NO_VIDEO_TRACKS:t=p._("Connect your camera and refresh the page to turn on video. If your camera is already connected, try restarting your browser.");break;case r.VIDEO_AUTO_DISABLED:t=p._("Video is paused because the connection is slow.");break;case r.SCREENSHARING_UNAVAILABLE:t=this.props.isVCEndpointCall?p._("Screen sharing is not currently available for Messenger to room calls."):p._("Screen sharing is disabled for this call because {name}'s device does not support receiving screen sharing.",[p.param('name',this.props.peerName)]);break;case r.PEER_IS_SHARING_SCREEN:t=p._("{name} is already sharing their screen. You can share your screen as soon as they stop sharing.",[p.param('name',this.props.peerName)]);break;}return (j.createElement(n,null,t));},_popoverProps:function(){var t={alignment:'left',behaviors:{LayerFadeOnHide:h,LayerFadeOnShow:i},contextRef:(function(){return this.props.reference;}).bind(this),hoverContext:k.findDOMNode(this.props.reference),position:'above',shown:this.props.visible,width:this.props.width};return t;}});s.Types=r;f.exports=s;},null);
__d('FBRTCCallControls.react',['FBRTCActiveMouseMixin','FBRTCCallControlActions','FBRTCCallControlButton.react','FBRTCCallControlPopover.react','FBRTCFullScreenController','FBRTCScreenSharingUtils','FBRTCUserSettings','React','ReactLayeredComponentMixin','ScreenSharingWebDriverIDs','VideoCallWebDriverIDs','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u=10000,v={READY:0,SHOWN:1,COMPLETE:2},w=o.createClass({displayName:'FBRTCCallControls',mixins:[p,h],getInitialState:function(){return {forceVisible:v.READY,showScreenSharingPopover:false};},componentDidMount:function(){this._listener=l.addListener(this._handleFullScreenChange);},activeMouseCallback:function(x){this.setState({mouseActive:x});},componentWillUnmount:function(){if(this._listener){this._listener.remove();this._listener=null;}},_handleFullScreenChange:function(){this.forceUpdate();},_shouldForceVisible:function(x){var y=x.localStream;return x.videoIsAutoDisabled()||y.hasStream()&&!y.hasVideoTracks();},componentWillReceiveProps:function(x){if(this._shouldForceVisible(x.callModel)){if(this.state.forceVisible===v.READY){this.setState({forceVisible:v.SHOWN});setTimeout((function(){this.setState({forceVisible:v.COMPLETE});}).bind(this),u);}}else if(this.state.forceVisible===v.SHOWN)this.setState({forceVisible:v.COMPLETE});},_getPopoverWidth:function(x){var y=65;return n.isEnabled()?x:x-y;},renderLayers:function(){var x,y,z=false,aa={},ba=this.props.callModel.peerShortName();if(!this.props.callModel.isRemoteVideoSupported){x=k.Types.REMOTE_VIDEO_UNSUPPORTED;}else if(!this.props.callModel.localStream.hasVideoTracks()){x=k.Types.NO_VIDEO_TRACKS;}else if(this.props.callModel.videoIsAutoDisabled())x=k.Types.VIDEO_AUTO_DISABLED;if(x){z=this.state.forceVisible===v.SHOWN;aa.videoPopover=o.createElement(k,{reason:x,peerName:ba,reference:this.refs.videoButton,width:this._getPopoverWidth(320),visible:z});}if(m.isScreenSharingSupported()){if(this.props.callModel.isConnected()&&!this.props.callModel.canPeerReceiveScreenSharing()){y=k.Types.SCREENSHARING_UNAVAILABLE;}else if(this.props.callModel.getRemoteScreenStream()!==null)y=k.Types.PEER_IS_SHARING_SCREEN;if(y){z=this.state.showScreenSharingPopover;aa.screenSharingPopover=o.createElement(k,{reason:y,peerName:ba,isVCEndpointCall:this.props.callModel.isVCEndpointCall,reference:this.refs.shareScreenButton,width:this._getPopoverWidth(255),visible:z});}}return aa;},toggleMuteAudio:function(x){i.toggleMuteAudio();},toggleMuteVideo:function(x){i.toggleMuteVideo();},toggleFullScreen:function(x){i.toggleFullScreen();},endCall:function(x){i.hangUp();},showSettings:function(x){if(n.isEnabled())i.showSettings();},toggleScreenSharing:function(x){if(m.isScreenSharingSupported())if(this.props.callModel.canPeerReceiveScreenSharing()&&this.props.callModel.getRemoteScreenStream()===null){i.toggleScreenSharing();}else{m.logFailedAttempt(this.props.callModel.peerID,this.props.callModel.callID);if(!this.state.showScreenSharingPopover){this.setState({showScreenSharingPopover:true});setTimeout((function(){this.setState({showScreenSharingPopover:false});}).bind(this),u/4);}}},render:function(){var x=this.props.callModel,y=n.isEnabled()&&x.supportsSdpUpdate(),z=this._isVideoButtonDisabled(),aa=!z&&!x.localStream.hasVideo(),ba=m.isScreenSharingSupported(),ca=!x.localStream.hasAudio(),da=x.isFullScreen();return (o.createElement('div',{className:"_4bbt"},o.createElement('div',{className:this._wrapperClasses(),onFocus:this.onFocus,onBlur:this.onBlur},this._videoMuteButton(aa,z),this._audioMuteButton(ca),this._screenSharingButton(ba),this._endCallButton(),this._settingsButton(y),this._fullScreenButton(da))));},_isVideoButtonDisabled:function(){var x=this.props.callModel;return !x.isRemoteVideoSupported||!x.localStream.hasVideoTracks()||!x.isConnected();},_videoMuteButton:function(x,y){var z=x?t._("Enable your video"):t._("Disable your video");return (o.createElement(j,{active:x,disabled:y,highlighted:x,title:z,iconType:j.IconTypes.VIDEO,onClick:this.toggleMuteVideo,ref:'videoButton'}));},_audioMuteButton:function(x){var y=x?t._("Unmute your microphone"):t._("Mute your microphone");return (o.createElement(j,{active:x,iconType:j.IconTypes.MUTE,highlighted:x,title:y,onClick:this.toggleMuteAudio}));},_endCallButton:function(){var x=t._("End call");return (o.createElement(j,{endButton:true,title:x,iconType:j.IconTypes.END,onClick:this.endCall,'data-testid':r.END_CALL_BUTTON}));},_settingsButton:function(x){if(x){var y=t._("Settings");return (o.createElement(j,{iconType:j.IconTypes.SETTINGS,title:y,onClick:this.showSettings}));}},_screenSharingButton:function(x){if(x){var y=this.props.callModel.canPeerReceiveScreenSharing(),z=y&&this.props.callModel.isScreenSharingEnabled(),aa=!y||!this.props.callModel.isConnected()||this.props.callModel.getRemoteScreenStream()!==null,ba=t._("Share your screen");return (o.createElement(j,{active:z,disabled:aa,highlighted:z,iconType:j.IconTypes.SHARE_SCREEN,title:ba,onClick:this.toggleScreenSharing,ref:'shareScreenButton','data-testid':q.SHARE_SCREEN_BUTTON}));}},_fullScreenButton:function(x){var y=x?t._("Exit full screen"):t._("Enter full screen");return (o.createElement(j,{active:x,title:y,iconType:j.IconTypes.FULL_SCREEN,onClick:this.toggleFullScreen}));},_wrapperClasses:function(){var x=!this.props.callModel.localStream.hasStream()||this.props.callModel.isEnded(),y=this.state.mouseActive||this.state.hasFocus||this.state.forceVisible===v.SHOWN;return "_4bbx"+(x?' '+"_4bby":'')+(y?' '+"_4bbz":'');},onFocus:function(x){this.setState({hasFocus:true});},onBlur:function(x){this.setState({hasFocus:false});}});f.exports=w;},null);
__d('FBRTCButton.react',['MessengerButton.react','ReactComponentWithPureRenderMixin','React','XUIOverlayButton.react','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n=j.PropTypes,o=j.createClass({displayName:'FBRTCButton',mixins:[i],propTypes:{label:n.string.isRequired,messengerUI:n.bool.isRequired,type:n.string.isRequired},render:function(){var p=this.props,q=p.className,r=p.messengerUI,s=p.type,t=babelHelpers.objectWithoutProperties(p,['className','messengerUI','type']);if(r)return (j.createElement(h,babelHelpers._extends({className:q,type:s},t)));return (j.createElement(k,babelHelpers._extends({className:m("_1-7l",q)},t)));}});f.exports=o;},null);
__d('FBRTCCallTimer.react',['React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=h.createClass({displayName:'FBRTCCallTimer',getInitialState:function(){return {secondsElapsed:0};},tick:function(){this.setState({secondsElapsed:this.state.secondsElapsed+1});},componentDidMount:function(){this.interval=setInterval(this.tick,1000);},componentWillUnmount:function(){clearInterval(this.interval);},render:function(){var j=this.state.secondsElapsed;return (h.createElement('span',null,j>=3600?("0"+Math.floor(j/3600)).slice(-2)+':':'',("0"+Math.floor(j%3600/60)).slice(-2),':',("0"+j%60).slice(-2)));}});f.exports=i;},null);
__d('FBRTCSpinner.react',['MessengerSpinner.react','ReactComponentWithPureRenderMixin','React','XUISpinner.react'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'FBRTCSpinner',mixins:[i],propTypes:{messengerUI:l.bool.isRequired},render:function(){if(this.props.messengerUI)return j.createElement(h,{color:'blue'});return j.createElement(k,{background:'dark',size:'large'});}});f.exports=m;},null);
__d('FBRTCCallStateInfo.react',['FBRTCButton.react','FBRTCCallControlActions','FBRTCCallModel','FBRTCCallTimer.react','FBRTCConstants','FBRTCSpinner.react','Image.react','MessengerContactImage.react','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=function(v,w){switch(v){case l.CallEndReason.NO_ANSWER_TIMEOUT:case l.CallEndReason.IGNORE_CALL:return r._("No Answer");case l.CallEndReason.INCOMING_TIMEOUT:case l.CallEndReason.NO_PERMISSION:case l.CallEndReason.OTHER_NOT_CAPABLE:case l.CallEndReason.OTHER_CARRIER_BLOCKED:return r._("Not Reachable");case l.CallEndReason.SIGNALING_MESSAGE_FAILED:case l.CallEndReason.WEBRTC_ERROR:case l.CallEndReason.NO_UI_ERROR:case l.CallEndReason.CALLER_NOT_VISIBLE:case l.CallEndReason.CLIENT_ERROR:return r._("Call Failed");case l.CallEndReason.UNSUPPORTED_VERSION:return r._("Can't Connect Call");case l.CallEndReason.IN_ANOTHER_CALL:return r._("In Another Call");case l.CallEndReason.CARRIER_BLOCKED:return r._("Switch to Wi-Fi to complete your call");case l.CallEndReason.CLIENT_INTERRUPTED:return r._("Call Interrupted");case l.CallEndReason.HANGUP_CALL:case l.CallEndReason.ACCEPT_AFTER_HANGUP:return r._("Call Ended");case l.CallEndReason.CONNECTION_DROPPED:return r._("Connection Lost");case l.CallEndReason.OTHER_INSTANCE_HANDLED:return '';default:return '';}},t=function(v,w){switch(v.uiState){case j.UIState.INIT:case j.UIState.PENDING_LOCAL_MEDIA:case j.UIState.MORE_INIT:case j.UIState.USER_MEDIA_DENIED:return p.createElement(m,{messengerUI:w});case j.UIState.CONTACTING:return (p.createElement('p',{className:"_2ze8"},r._("Contacting...")));case j.UIState.RINGING:return (p.createElement('p',{className:"_2ze8"},r._("Ringing...")));case j.UIState.CALL_CONNECTING:return (p.createElement('p',{className:"_2ze8"},r._("Connecting...")));case j.UIState.CALL_CONNECTED:return (p.createElement('p',{className:"_2ze8"},p.createElement(k,null)));case j.UIState.CALL_ENDED:return (p.createElement('p',{className:"_2ze8"},s(v.endCallReason,v.isRemoteEnded)));default:return '';}},u=p.createClass({displayName:'FBRTCCallStateInfo',revealContainer:function(){var v="_4j_h",w=document.getElementsByClassName(v)[0];if(w)w.className=v;},onCloseButtonClicked:function(v){window.close();return;},componentDidMount:function(){setTimeout((function(){this.revealContainer();}).bind(this),2000);},render:function(){var v=this.props.callModel;return (p.createElement('div',{className:"_4j_i"},this.renderPeerImage(v),this.renderMessage(),this.renderSubMessage(),this.renderCloseWindowButton(),this.renderStartCallButton()));},renderMessage:function(){var v=this.props.callModel;if(v.uiState===j.UIState.AWAITING_USER_START)return (p.createElement('p',{className:"_4j_k"},r._("Ready to call {name}?",[r.param('name',v.peerShortName())])));return (p.createElement('p',{className:"_4j_k"},this.props.callModel.peerName()));},renderSubMessage:function(){return t(this.props.callModel,this.props.messengerUI);},renderPeerImage:function(v){if(v.peerPicUrl()){if(this.props.messengerUI)return (p.createElement(o,{className:"_3z3i",isMessengerUser:true,size:75,src:v.peerPicUrl()}));return (p.createElement(n,{className:"_4j_j",src:v.peerPicUrl(),alt:'profile pic',onLoad:this.revealContainer,onError:this.revealContainer}));}return '';},shouldRenderCloseButton:function(){var v=this.props.callModel;return v.uiState===j.UIState.CALL_ENDED&&(!v.wasConnected||v.endCallReason!==l.CallEndReason.HANGUP_CALL);},renderCloseWindowButton:function(){if(this.shouldRenderCloseButton()){return (p.createElement(h,{label:r._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}));}else return '';},renderStartCallButton:function(){var v=this.props.callModel;if(v.uiState===j.UIState.AWAITING_USER_START){return (p.createElement(h,{label:r._("Start Call"),messengerUI:this.props.messengerUI,onClick:i.startCall,type:'primary'}));}else return '';}});f.exports=u;},null);
__d('FBRTCInCallView.react',['FBRTCCallModel','FBRTCScreenSharingUI','FBRTCScreenSharingView.react','FBRTCVideo.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=l.PropTypes,o=l.createClass({displayName:'FBRTCInCallView',propTypes:{callModel:n.instanceOf(h).isRequired},_videoIsMuted:function(){var p=this.props.callModel.remoteStream;return p&&!p.hasVideo();},_hasRemoteScreen:function(p){var q=p.getRemoteScreenStream();return q!==null&&!i.isOpen();},_containerClasses:function(p){var q=p===h.UIState.CALL_CONNECTED,r=p===h.UIState.CALL_ENDED;return "_of-"+(q||r?' '+"_of_":'')+(q?' '+"_og0":'')+(r?' '+"_og1":'');},_videoWrapperClasses:function(p){var q=this._videoIsMuted();return "_og2"+(q?' '+"_og3":'')+(p?' '+"_og4":'');},render:function(){var p=this.props.callModel,q=p.remoteStream.hasStream(),r=this._hasRemoteScreen(p);if(!q&&!r){return l.createElement('div',{className:"_hgl"});}else{var s=p.uiState;return (l.createElement('div',{className:this._containerClasses(s)},l.createElement('div',{className:this._videoWrapperClasses(r)},l.createElement(k,{stream:p.remoteStream})),this._renderScreenView(p,r)));}},_renderScreenView:function(p,q){if(q)return (l.createElement(j,{canSwitchScreens:false,screenStream:p.getRemoteScreenStream()}));return null;}});f.exports=o;},null);
__d('FBRTCMediaAccessPrompt.react',['React','ReactDOM','cx','fbt','UserAgent','Link.react','XUIText.react','FBRTCCallModel','FBRTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=h.createClass({displayName:'FBRTCMediaAccessPrompt',isVisible:function(r){return (l.isBrowser('Chrome')||l.isBrowser('Firefox'))&&r===o.UIState.PENDING_LOCAL_MEDIA;},componentWillUpdate:function(r,s){var t=r.callModel.uiState;if(this.isVisible(t)){clearTimeout(this.timeout);i.findDOMNode(this).style.display='block';}},componentDidUpdate:function(r,s){var t=this.props.callModel.uiState;if(!this.isVisible(t))this.timeout=setTimeout((function(){i.findDOMNode(this).style.display='none';}).bind(this),500);},componentWillUnmount:function(){clearTimeout(this.timeout);},dialogTitle:function(){if(l.isBrowser('Chrome')){return k._("Click \"Allow\" to Make a Call");}else return k._("Click the camera and choose \"Share Selected Devices\"");},dialogBody:function(){return k._("To make a video call on Facebook, you need to turn on your camera and microphone. This will let your friend see and hear you during the call.");},dialogLowerBody:function(){return k._("You can always turn these off later.");},learnMoreLink:function(){return (h.createElement(m,{href:p.userMediaPermissionErrorUrl(),target:'_blank'},k._("Learn more")));},render:function(){var r=this.props.callModel.uiState;return (h.createElement('div',{className:"_3jne"+(!this.isVisible(r)?' '+"_3jnf":'')},h.createElement('div',{className:"_3jnu"},h.createElement('h1',{className:"_3jnv"},this.dialogTitle()),h.createElement(n,{className:"_3jnw",display:'block',size:'small'},this.dialogBody()),h.createElement(n,{className:"_3jnw",display:'block',size:'small'},this.dialogLowerBody(),' ',this.learnMoreLink()))));}});f.exports=q;},null);
__d('FBRTCMediaDeniedPrompt.react',['React','cx','fbt','UserAgent','XUIContextualDialog.react','XUIContextualDialogBody.react','XUIContextualDialogTitle.react','ReactLayeredComponentMixin','FBRTCCallModel'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=h.createClass({displayName:'FBRTCMediaDeniedPrompt',mixins:[o],showDialog:function(){var r=this.props.callModel;return r.uiState===p.UIState.USER_MEDIA_DENIED;},arrowAlignment:function(){return k.isBrowser('Chrome')?'right':'left';},dialogTitle:function(){return j._("Click to Turn on Camera\/Microphone");},dialogBody:function(){return j._("To use video calling, you need to turn on your camera and microphone during the call.");},renderLayers:function(){return {popover:h.createElement(l,{contextRef:(function(){return this.refs.mpTarget;}).bind(this),shown:this.showDialog(),position:'below',alignment:this.arrowAlignment(),width:l.WIDTH.NORMAL},h.createElement(n,null,this.dialogTitle()),h.createElement(m,null,this.dialogBody()))};},render:function(){return h.createElement('div',{className:"_3wrz",ref:'mpTarget'});}});f.exports=q;},null);
__d('FBRTCVideoMuteOverlay.react',['Image.react','ReactComponentWithPureRenderMixin','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){'use strict';if(c.__markCompiled)c.__markCompiled();var l=j.PropTypes,m=j.createClass({displayName:'FBRTCVideoMuteOverlay',mixins:[i],propTypes:{videoMuted:l.bool.isRequired,imageSrc:l.oneOfType([l.string,l.object]).isRequired},render:function(){var n="_30ve"+(this.props.videoMuted?' '+"_30vf":'');return (j.createElement('div',{className:n},j.createElement(h,{src:this.props.imageSrc,alt:'video muted'})));}});f.exports=m;},null);
__d('FBRTCSelfView.react',['FBRTCActiveMouseMixin','FBRTCCallModel','FBRTCCallControlActions','FBRTCUtils','FBRTCVideo.react','FBRTCVideoMuteOverlay.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=n.PropTypes,q=n.createClass({displayName:'FBRTCSelfView',mixins:[h],propTypes:{callModel:p.instanceOf(i).isRequired},getInitialState:function(){return {};},activeMouseCallback:function(r){if(this.isMounted())this.setState({mouseActive:r});},toggleIconClass:function(r,s){return "_2q_n"+(r?' '+"_2q_o":'')+(!r?' '+"_2q_p":'')+(!s?' '+"_2q_q":'');},wrapperClasses:function(r){return "_2q_r"+(!r.selfViewOpen?' '+"_2q_s":'');},overlayClasses:function(r){var s=r.localStream.hasAudio();return "_2q_t"+(s?' '+"_2q_u":'');},buttonClasses:function(){return "_2q_w"+(this.state.mouseActive?' '+"_sxz":'');},render:function(){var r=this.props.callModel,s=r.selfViewOpen,t=r.isScreenSharingEnabled()?"_nxg":"_2q_y",u=r.isScreenSharingEnabled()?r.getLocalScreenStream():r.localStream;return (n.createElement('div',{className:"_2q_v"},n.createElement('button',{className:this.buttonClasses(),onClick:j.toggleSelfView},n.createElement('i',{className:this.toggleIconClass(true,!s)}),n.createElement('i',{className:this.toggleIconClass(false,s)})),n.createElement('div',{className:this.wrapperClasses(r)},n.createElement('div',{className:"_5aq5"},n.createElement(m,{videoMuted:!u.hasVideo(),imageSrc:r.selfPicUrl()}),n.createElement('div',{className:this.overlayClasses(r)},n.createElement('i',{className:"_2q_x"})),n.createElement(l,{muted:true,className:t,stream:u})))));}});f.exports=q;},null);
__d('FBRTCFadeInMixin',['ReactDOM','cx','joinClasses'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={componentDidMount:function(){var l=h.findDOMNode(this);l.style.opacity=0;l.className=j(l.className,"_2hy");setTimeout(function(){l.style.opacity=1;},1);}};f.exports=k;},null);
__d('FBRTCFeedbackCompleteView.react',['FBRTCButton.react','FBRTCFadeInMixin','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=j.createClass({displayName:'FBRTCFeedbackCompleteView',mixins:[i],onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},messageString:function(){if(this.props.skipped)return l._("Your call has ended");return l._("Thank you for your feedback!");},render:function(){return (j.createElement('div',{className:"_1-7k"},j.createElement('p',{className:"_4j_k"},this.messageString()),j.createElement('div',null,j.createElement(h,{label:l._("Close Window"),messengerUI:this.props.messengerUI,onClick:this.onCloseButtonClicked,type:'primary'}))));}});f.exports=m;},null);
__d('FBRTCFeedbackView.react',['FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCStarRatingActions','React','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=l.createClass({displayName:'FBRTCFeedbackView',mixins:[i],getInitialState:function(){return {submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){k.feedbackShown();},onSubmitButtonClicked:function(){if(this.canSubmitFeedback()){this.setState({submitted:true});k.submitFeedback(this.state.feedbackText);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},canSubmitFeedback:function(){return this.state.feedbackText!=='';},feedbackChanged:function(p){this.setState({feedbackText:p.target.value});p.preventDefault();},render:function(){if(this.state.submitted)return (l.createElement(j,{messengerUI:this.props.messengerUI,skipped:this.state.skipped}));return (l.createElement('div',{className:"_1-7k"},l.createElement('p',{className:"_4j_k"},n._("Give Feedback")),l.createElement('div',{className:"_4ru1"},l.createElement('label',{htmlFor:'fbwebrtcfeedback',className:"_4j_k _4ru2"},n._("What was the worst problem you experienced?")),l.createElement('textarea',{className:"_4ru3",id:'fbwebrtcfeedback',rows:'4',onChange:this.feedbackChanged,placeholder:n._("Enter your feedback")}),l.createElement('div',{className:"_s97"},l.createElement(h,{className:"_g6b",label:n._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),l.createElement(h,{className:"_g6b",disabled:!this.canSubmitFeedback(),label:n._("Submit"),messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'})))));}});f.exports=o;},null);
__d('FBRTCStarRatingView.react',['FBRTCButton.react','FBRTCFadeInMixin','FBRTCFeedbackCompleteView.react','FBRTCFeedbackView.react','FBRTCStarRatingActions','React','StarsInput.react','VideoCallWebDriverIDs','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=m.createClass({displayName:'FBRTCStarRatingView',mixins:[i],getInitialState:function(){return {rating:0,submitted:false,skipped:false,feedbackText:''};},componentDidMount:function(){l.ratingShown();},onCallBackButtonClicked:function(){return;},onCloseButtonClicked:function(){window.close();return;},onStarClicked:function(s){this.setState({rating:s});},onSubmitButtonClicked:function(){if(this.state.rating>0){this.setState({submitted:true});l.submitRating(this.state.rating);}},onNotNowClicked:function(){this.setState({skipped:true,submitted:true});return;},getRatingString:function(){switch(this.state.rating){case 1:return q._("Poor");case 2:return q._("Fair");case 3:return q._("Good");case 4:return q._("Very Good");case 5:return q._("Excellent");default:return '---';}},shouldAskForFeedback:function(){return this.state.rating===1&&this.state.submitted&&!this.state.skipped;},render:function(){if(this.shouldAskForFeedback()){return (m.createElement(k,{messengerUI:this.props.messengerUI}));}else if(this.state.submitted)return (m.createElement(j,{skipped:this.state.skipped,messengerUI:this.props.messengerUI}));var s=this.getRatingString();return (m.createElement('div',{className:"_1-7k",'data-testid':o.STAR_RATING_VIEW},m.createElement('p',{className:"_4j_k"},this.props.hasVideo?q._("Please rate the quality of your video call."):q._("Please rate the quality of your audio call.")),m.createElement('p',{className:"_4j_k _a16"},s),m.createElement(n,{allowMultipleSubmissions:true,onClick:this.onStarClicked}),m.createElement('div',{className:"_s97"},m.createElement(h,{className:"_g6b",label:q._("Not Now"),messengerUI:this.props.messengerUI,onClick:this.onNotNowClicked,type:'secondary'}),m.createElement(h,{className:"_g6b",label:q._("Submit"),disabled:this.state.rating===0,messengerUI:this.props.messengerUI,onClick:this.onSubmitButtonClicked,type:'primary'}))));}});f.exports=r;},null);
__d('FBRTCView.react',['FBRTCBackground.react','FBRTCCallControls.react','FBRTCCallModel','FBRTCCallStateInfo.react','FBRTCConfig','FBRTCInCallView.react','FBRTCMediaAccessPrompt.react','FBRTCSelfView.react','FBRTCMediaDeniedPrompt.react','FBRTCStarRatingView.react','React','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';if(c.__markCompiled)c.__markCompiled();var t=r.PropTypes,u=r.createClass({displayName:'FBRTCView',_listener:null,propTypes:{callModel:t.instanceOf(j).isRequired,messengerUI:t.bool.isRequired,excludeSelfView:t.bool},componentDidMount:function(){this._listener=this.props.callModel.addListener(this._handleCallModelChanged);},componentWillUnmount:function(){if(this._listener){this._listener.remove();delete this._listener;}},_handleCallModelChanged:function(){this.forceUpdate();},render:function(){var v=this.props,w=v.callModel,x=v.messengerUI,y=w.backgroundUrl(),z=w.getLocalVideoDuration()>0;if(w.uiState===j.UIState.COLLECT_RATING){return (r.createElement('div',{className:this._wrapperClass()},r.createElement(h,{src:y,messengerUI:x}),this._renderLogo(),r.createElement(q,{messengerUI:x,hasVideo:z})));}else return (r.createElement('div',{className:this._wrapperClass()},r.createElement(n,{callModel:w}),r.createElement(p,{callModel:w}),r.createElement(k,{callModel:w,messengerUI:x}),r.createElement(h,{src:y,messengerUI:x}),this._renderLogo(),r.createElement(m,{callModel:w}),this._renderSelfView(w),r.createElement(i,{callModel:w})));},_renderSelfView:function(v){if(!this.props.excludeSelfView&&v.isRemoteVideoSupported&&!v.isEnded())return r.createElement(o,{callModel:v});return null;},_renderLogo:function(){if(!this.props.messengerUI){var v="_263g"+(' '+"_56ut");return r.createElement('i',{className:v});}},_wrapperClass:function(){return "_3ref"+(this.props.messengerUI?' '+"_17cj":'');}});f.exports=u;},null);
__d('FBRTCApplication',['FBRTCLogger','FBRTCCallController','FBRTCConfig','FBRTCView.react','React','ReactDOM','FBRTCSupport','PageHooks'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();if(!window.PageHooks)c('PageHooks');var o={init:function(p,q,r,s,t,u,v){u=u||document.getElementById('fbRTC/container');var w=h.getInstance();w.logInfo(p,q,'Starting Call Controller');document.documentElement.style.overflow='hidden';if(!n.isWebrtcSupported()){w.logError(p,q,'Webrtc not supported');}else{var x=new i(p,q,r,t);m.render(l.createElement(k,{callModel:x.getCallModel(),messengerUI:j.useMessengerCallUI()}),u);}}};f.exports=o;},null);