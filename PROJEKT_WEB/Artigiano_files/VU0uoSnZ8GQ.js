/*!CK:399092806!*//*1453252250,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["7\/jDk"]); }

__d("StarsRatableComposerCloseResetBehaviorEnum",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={NONE:"none",RESET_TO_EMPTY:"reset_to_empty",RESET_TO_PREVIOUS:"reset_to_previous"};},null);
__d('StarsRatableBase',['Event','Arbiter','CSS','DOM','Parent','Run','StarsRatableComposerCloseResetBehaviorEnum'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p,q,r,s){this.root=p;this.freezeOnClick=q;this.stars=k.scry(p,'a');this.listeners=[h.listen(this.root,'click',this._onClick.bind(this)),h.listen(this.root,'mousemove',this._onMouseMove.bind(this)),h.listen(this.root,'mouseout',this._onMouseOut.bind(this))];this.holdMouseMove=false;this.setRating(r);this.defaultRating=r;this.composerHideResetBehavior=s;this.composerArbiters=[];m.onLeave(this.destroyListeners.bind(this));}o.init=function(p,q,r,s){return new o(p,q,r,s);};Object.assign(o.prototype,{_onClick:function(event){this.layerHides=0;var p=this._getStarIndexFromEvent(event);if(!p)return;this.setRating(p);if(this.freezeOnClick){this.freeze();}else this.holdMouseMove=true;if(this.composerHideResetBehavior!==n.NONE)this.composerArbiters=[i.subscribe('saving_rating_from_composer',(function(q,r){this.defaultRating=r;this.setRating(this.composerHideResetBehavior===n.RESET_TO_EMPTY?0:r);this._unsubscribeComposerArbiters();}).bind(this)),i.subscribe('canceling_from_composer',(function(){this.setRating(this.composerHideResetBehavior===n.RESET_TO_EMPTY?0:this.defaultRating);this._unsubscribeComposerArbiters();}).bind(this))];event.prevent();},_unsubscribeComposerArbiters:function(){for(var p=0;p<this.composerArbiters.length;++p)i.unsubscribe(this.composerArbiters[p]);this.composerArbiters=[];},_onMouseMove:function(event){if(this.holdMouseMove)return;var p=this._getStarIndexFromEvent(event);if(!p)return;this.setStars(p,true);},_onMouseOut:function(event){this.holdMouseMove=false;this.updateStars();},_getStarIndexFromEvent:function(event){var p=l.byTag(event.getTarget(),'a');if(p)return this.stars.indexOf(p)+1;return 0;},setRating:function(p){this._rating=p;this.updateStars();},updateStars:function(){this.setStars(this._rating);},setStars:function(p,q){var r=q?'hoverStar':'fullStar',s=q?'fullStar':'hoverStar';for(var t=0;t<this.stars.length;++t){j.removeClass(this.stars[t],s);var u=t>=p;j.conditionClass(this.stars[t],r,!u);j.conditionClass(this.stars[t],'emptyStar',u);}},freeze:function(){j.addClass(this.root,'uiStarsRated');this.destroyListeners();},destroyListeners:function(){this.listeners.forEach(function(p){p&&p.remove();});this.listeners=[];}});b.StarsRatableBase=f.exports=o;},null);
__d('LocalContentClickLogger',['BanzaiLogger','EventListener'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();j.prototype.initClickThroughLogging=function(k,l,m){'use strict';i.listen(k,'click',(function(){return this.sendLoggingRequest(l,m);}).bind(this));};j.prototype.initMenuClickLogging=function(k,l,m,n){'use strict';k.subscribe('itemclick',(function(o,p){if(p.item.getValue()==l)this.sendLoggingRequest(m,n);}).bind(this));};j.prototype.initPrivacyMenuClickLogging=function(k,l,m){'use strict';i.listen(k,'click',(function(event){l.button_text=event.target.textContent;this.sendLoggingRequest(l,m);}).bind(this));};j.prototype.sendLoggingRequest=function(k,l){'use strict';if(l=='reviews'){h.log('ReviewConsumptionLoggerConfig',k);}else if(l=='review_production'){h.log('ReviewProductionLoggerConfig',k);}else if(l=='menus')h.log('MenuConsumptionLoggerConfig',k);};function j(){'use strict';}f.exports=new j();},null);
__d("XReviewsTabUpdateHistogramController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/ajax\/pages\/review\/update_histogram\/",{page_id:{type:"Int"}});},null);
__d('ReviewsController',['Arbiter','AsyncRequest','DOM','Dialog','Event','Image.react','React','ReactDOM','Run','XReviewsTabUpdateHistogramController','csx','fbt','ix','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v={},w={},x={},y={},z={},aa={registerRevealProfanity:function(ba,ca,da){l.listen(ca,'click',function(){ba.style.display='none';da.style.display='inline';});},registerButton:function(ba,ca){v[ca]=v[ca]||[];v[ca].push(ba);},registerViewerReview:function(ba,ca){w[ca]=w[ca]||[];w[ca].push(ba);},registerComposer:function(ba,ca){x[ca]=x[ca]||[];x[ca].push(ba);},registerToggle:function(ba,ca,da,ea){y[ba]=y[ba]||[];y[ba].push([ca,da,ea]);},registerStoryDeleteListener:function(ba){h.subscribe('Story/delete',(function(ca,da){this._updateToggles(ba,false);new i(q.getURIBuilder().setInt('page_id',ba).getURI()).setMethod('GET').setReadOnly(true).send();}).bind(this));},addUserReview:function(ba,ca,da,ea,fa,ga,ha,ia,ja,ka){this._updateState(true,ba,ca,da,ea,fa,ga,ha,ia,ja,ka);},deleteUserReview:function(ba,ca,da,ea,fa,ga){this._updateState(false,ba,null,null,null,ca,da,ea,ga,null,null);if(fa){var ha=document.getElementById(fa),ia=ha.parentNode.parentNode;ia.parentNode.removeChild(ia);}},_updateState:function(ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){var ma;if(ka){var na=u('own_review_container');if(na)j.setContent(na,ka);}else if(ja){var oa=u('viewer_own_review_tab');if(oa)j.replace(oa,ja);}else if(ba){var pa=u('page_reviews_tab_list');if(pa)j.prependContent(pa,ea);var qa="div._yj3",ra=j.scry(document,qa)[0];if(ra)ra.parentNode.removeChild(ra);}var sa=w[ca]||[];for(ma=0;ma<sa.length;ma++)j.remove(sa[ma]);this._updateToggles(ca,ba);var ta=x[ca]||[];for(ma=0;ma<ta.length;ma++){var ua=ta[ma];if(ba){ua.hide();}else{ua.clear();ua.show();}}var va=v[ca]||[];for(ma=0;ma<va.length;ma++){var wa=va[ma],xa=j.find(wa,'.uiButtonText'),ya=j.find(wa,'i'),za,ab;if(ba){za=t('/images/icons/buttons/check.png');ab=s._("Reviewed");}else{za=t('/images/icons/buttons/feature.png');ab=s._("Review");}var bb=j.create('span'),cb={"padding-right":"5px"};o.render(n.createElement('div',null,ab),xa);o.render(n.createElement(m,{src:za,style:cb}),bb);j.replace(ya,bb);}if(ba){var db=j.scry(document,'#page_recommendations_browse_list')[0];if(db)j.prependContent(db,da);}if(ga){var eb=u('page_reviews_pill_and_histogram');if(eb)j.replace(eb,ga);}if(ha){var fb=u('pages_inline_rating_summary');if(fb)j.replace(fb,ha);}if(ia){var gb=u('pages_review_needy_place_card');if(gb)j.replace(gb,ia);}if(la){var hb=u('spotlight_reviews_card_list');if(hb)j.prependContent(hb,la);}},registerPhotoUpload:function(ba,ca){h.subscribe('multi-upload/images-upload-completed/'+ca,function(){z[ca]=false;});h.subscribe('multi-upload/images-upload-start/'+ca,function(){z[ca]=true;});l.listen(ba,'submit',(function(){if(z[ca]){new k().setTitle(s._("Photos Are Uploading")).setSemiModal(true).setButtons(k.OK).setBody(s._("Please wait until photo is uploaded before posting.")).show();return false;}return true;}).bind(this));},_updateToggles:function(ba,ca){var da=y[ba]||[];for(var ea=0;ea<da.length;ea++){var fa=da[ea],ga=fa[ca?1:2];j.setContent(fa[0],ga);}}};p.onLeave(function(){v={};w={};x={};y={};z={};});f.exports=aa;},null);