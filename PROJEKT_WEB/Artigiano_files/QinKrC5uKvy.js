/*!CK:2132697238!*//*1453403828,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["kiG62"]); }

__d('TickerReadStateTracking',['Style','clickRefAction'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=73,k='ticker_hover',l=[];function m(o){if(!o)return null;var p=JSON.parse(o.getAttribute('data-ft'));if(!p)return null;if(p.mf_story_key)return p.mf_story_key;if(p.fbid)return p.fbid;return null;}function n(o){var p=m(o);if(!p||p in l)return;l[p]=true;var q={evt:j};i(k,o,null,'FORCE',{ft:q});}f.exports.log=n;},null);
__d('ContextualDialogFooterLink',['CSS','DOM','Event'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this._layer=l;}k.prototype.enable=function(){'use strict';var l=this._layer.getRoot(),m=i.scry(l,'.uiContextualDialogFooterLink')[0],n='uiContextualDialogHoverFooterArrow';this._subscriptions=[j.listen(m,'mouseenter',h.addClass.bind(null,l,n)),j.listen(m,'mouseleave',h.removeClass.bind(null,l,n))];};k.prototype.disable=function(){'use strict';this._subscriptions.forEach(function(l){l.remove();});this._subscriptions=null;};Object.assign(k.prototype,{_subscriptions:null});f.exports=k;},null);
__d('LayerHideOnSuccess',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._layer=i;}h.prototype.enable=function(){'use strict';this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));};h.prototype.disable=function(){'use strict';if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}};Object.assign(h.prototype,{_subscription:null});f.exports=h;},null);
__d('Overlay',['CSS','DataStore','DOM','Layer','LayerButtons','LayerDestroyOnHide','LayerFadeOnHide','LayerFadeOnShow','LayerFormHooks','LayerHideOnBlur','LayerHideOnEscape','LayerHideOnSuccess','LayerHideOnTransition','LayerMouseHooks','LayerTabIsolation'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w,x;w=babelHelpers.inherits(y,k);x=w&&w.prototype;function y(z,aa){'use strict';z=babelHelpers._extends({buildWrapper:true},z);x.constructor.call(this,z,aa);}y.prototype._configure=function(z,aa){'use strict';this._shouldBuildWrapper=z.buildWrapper;x._configure.call(this,z,aa);var ba=this.getRoot();this._overlay=j.scry(ba,'div.uiOverlay')[0]||ba;h.hide(ba);j.appendContent(this.getInsertParent(),ba);i.set(this._overlay,'overlay',this);var ca=i.get(this._overlay,'width');ca&&this.setWidth(ca);if(this.setFixed)this.setFixed(i.get(this._overlay,'fixed')=='true');if(i.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(o);if(i.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(n);if(i.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(s);if(i.get(this._overlay,'hideonblur')=='true')this.enableBehavior(q);if(i.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(m);return this;};y.prototype._getDefaultBehaviors=function(){'use strict';return x._getDefaultBehaviors.call(this).concat([l,p,u,r,t,v]);};y.prototype.initWithoutBuildingWrapper=function(){'use strict';this._shouldBuildWrapper=false;return this.init.apply(this,arguments);};y.prototype._buildWrapper=function(z,aa){'use strict';aa=x._buildWrapper.call(this,z,aa);if(!this._shouldBuildWrapper){this._contentRoot=aa;return aa;}this._contentRoot=j.create('div',{className:'uiOverlayContent'},aa);return j.create('div',{className:'uiOverlay'},this._contentRoot);};y.prototype.getContentRoot=function(){'use strict';return this._contentRoot;};y.prototype.destroy=function(){'use strict';i.remove(this.getRoot(),'overlay');x.destroy.call(this);};f.exports=y;},null);
__d('LegacyContextualDialog',['Arbiter','ArbiterMixin','ARIA','Bootloader','ContextualDialogFooterLink','ContextualThing','CSS','DataStore','DOM','Event','LayerAutoFocus','LayerRefocusOnHide','Locale','Overlay','Parent','Scroll','Style','Vector','$','csx','cx','getOrCreateDOMID','getOverlayZIndex','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){if(c.__markCompiled)c.__markCompiled();var fa,ga;fa=babelHelpers.inherits(ha,u);ga=fa&&fa.prototype;ha.prototype._configure=function(ia,ja){'use strict';ga._configure.call(this,ia,ja);var ka=this.getRoot(),la=o.get.bind(null,ka);this.setAlignH(la('alignh','left'));this.setOffsetX(la('offsetx',0));this.setOffsetY(la('offsety',0));this.setPosition(la('position','above'));this._hasFooter=la('hasfooter',false);if(this._hasFooter){var ma=p.scry(ka,'.uiContextualDialogFooterLink')[0];ma&&this.enableBehavior(l);}this.enableBehaviors(this._getDefaultBehaviors());this._setContextSubscription=this.subscribe('beforeshow',(function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var oa=la('context');if(oa){this.setContext(z(oa));}else{oa=la('contextselector');if(oa)this.setContext(p.find(document,oa));}}).bind(this));this._content=p.scry(ka,'.uiContextualDialogContent')[0];if(this._content){this._content.setAttribute('role','dialog');var na=p.scry(this._content,'.legacyContextualDialogTitle')[0];if(na)this._content.setAttribute('aria-labelledby',ca(na));}this._showSubscription=this.subscribe('show',(function(){var oa=ea(this.updatePosition,this);this._resizeListener=q.listen(window,'resize',oa);this._reflowSubscription=h.subscribe('reflow',oa);this._setupScrollListener(this._scrollParent);m.register(ka,this.context);h.inform('layer_shown',{type:'ContextualDialog'});}).bind(this));this._hideSubscription=this.subscribe('hide',(function(){this._teardownResizeAndReflowListeners();this._teardownScrollListener();h.inform('layer_hidden',{type:'ContextualDialog'});}).bind(this));return this;};ha.prototype._getDefaultBehaviors=function(){'use strict';return ga._getDefaultBehaviors.call(this).concat([r,s]);};ha.prototype._buildWrapper=function(ia,ja){'use strict';var ka=ga._buildWrapper.call(this,ia,ja);if(!this._shouldBuildWrapper)return ka;n.addClass(ka,'uiContextualDialog');return p.create('div',{className:'uiContextualDialogPositioner'},ka);};ha.prototype.setWidth=function(ia){'use strict';this._width=Math.floor(ia);return this;};ha.prototype.setFixed=function(ia){'use strict';ia=!!ia;n.conditionClass(this.getRoot(),'uiContextualDialogFixed',ia);this._fixed=ia;return this;};ha.prototype.setAlignH=function(ia){'use strict';this.alignH=ia;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;};ha.prototype.getContent=function(){'use strict';return this._content;};ha.prototype.getContext=function(){'use strict';return this.context;};ha.prototype.setContext=function(ia){'use strict';if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}ia=z(ia);if(this.context&&this.context!=ia)o.remove(this.context,'LegacyContextualDialog');this.context=ia;j.setPopup(this.getCausalElement(),this.getRoot());var ja=v.bySelector(ia,"._4d3w");this.setInsertParent(ja||document.body);if(this._scrollListener&&this._scrollParent!==ja){this._teardownScrollListener();this._setupScrollListener(ja);}this._scrollParent=ja;var ka=da(ia,this._insertParent);x.set(this.getRoot(),'z-index',ka>200?ka:'');o.set(this.context,'LegacyContextualDialog',this);return this;};ha.prototype.getCausalElement=function(){'use strict';return ga.getCausalElement.call(this)||this.context;};ha.prototype.listen=function(ia,ja){'use strict';return q.listen(this.getRoot(),ia,ja);};ha.prototype.setOffsetX=function(ia){'use strict';this.offsetX=parseInt(ia,10)||0;this._shown&&this.updatePosition();return this;};ha.prototype.setOffsetY=function(ia){'use strict';this.offsetY=parseInt(ia,10)||0;this._shown&&this.updatePosition();return this;};ha.prototype.setPosition=function(ia){'use strict';this.position=ia;for(var ja in ha.POSITION_TO_CLASS)n.conditionClass(this.getRoot(),ha.POSITION_TO_CLASS[ja],ia==ja);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;};ha.prototype.updatePosition=function(){'use strict';if(!this.context)return false;if(this._width)x.set(this._overlay,'width',this._width+'px');var ia=this._fixed?'viewport':'document',ja=y.getElementPosition(this.context,ia),ka=this._scrollParent;if(ka)ja=ja.sub(y.getElementPosition(ka,'document')).add(w.getLeft(ka),w.getTop(ka));var la=y.getElementDimensions(this.context),ma=this.position=='above'||this.position=='below',na=t.isRTL();if((this.position=='right'||ma&&this.alignH=='right')!=na)ja=ja.add(la.x,0);if(this.position=='below')ja=ja.add(0,la.y);var oa=new y(0,0);if(ma&&this.alignH=='center'){oa=oa.add((la.x-this._width)/2,0);}else{var pa=ma?la.x:la.y,qa=2*ha.ARROW_INSET;if(pa<qa){var ra=pa/2-ha.ARROW_INSET;if(ma&&this.alignH=='right'!=na)ra=-ra;oa=oa.add(ma?ra:0,ma?0:ra);}}oa=oa.add(this.offsetX,this.offsetY);if(na)oa=oa.mul(-1,1);ja=ja.add(oa);if(this._fixed)ja=new y(ja.x,ja.y,'document');ja.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;};ha.prototype.scrollTo=function(){'use strict';if(this.context)k.loadModules(["DOMScroll"],(function(ia){ia.scrollTo(this.context,true,true);}).bind(this));};ha.prototype.destroy=function(){'use strict';this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this._teardownScrollListener();this._teardownResizeAndReflowListeners();this.context&&o.remove(this.context,'LegacyContextualDialog');ga.destroy.call(this);};ha.prototype._adjustVerticalPosition=function(){'use strict';if(this.position!='left'&&this.position!='right'){x.set(this._overlay,'top','');return;}var ia=this.getRoot(),ja=y.getElementPosition(ia,'viewport').y,ka=y.getElementDimensions(this._overlay).y,la=y.getViewportDimensions().y,ma=Math.min(Math.max(ja,ha.MIN_TOP_GAP),ha.TOP_MARGIN),na=Math.min(Math.max(0,ja+ka+ha.BOTTOM_MARGIN-la),Math.max(-ma,ja-ma),ka-2*ha.ARROW_INSET);x.set(this._overlay,'top',-1*na+'px');x.set(this._arrow,'top',ha.ARROW_OFFSET+'px');x.set(this._arrow,'marginTop',na+'px');};ha.prototype._adjustHorizontalPosition=function(){'use strict';if(this.position!='above'&&this.position!='below'||this.alignH!='left'){x.set(this._overlay,'left','');x.set(this._overlay,'right','');return;}var ia=this.getRoot(),ja=y.getElementPosition(ia,'viewport').x,ka=y.getElementDimensions(this._overlay).x,la=y.getViewportDimensions().x,ma=t.isRTL(),na;if(!ma){na=ja+ka+ha.RIGHT_MARGIN-la;}else na=ha.LEFT_MARGIN+ka-ja;na=Math.min(Math.max(0,na),ka-2*ha.ARROW_INSET);x.set(this._overlay,ma?'right':'left',-1*na+'px');x.set(this._arrow,ma?'right':'left',ha.ARROW_OFFSET+'px');x.set(this._arrow,ma?'marginRight':'marginLeft',na+'px');};ha.prototype._updateArrow=function(){'use strict';var ia=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':ia=50;break;case 'right':ia=100;break;}this._renderArrow(ha.POSITION_TO_ARROW[this.position],ia);};ha.prototype._renderArrow=function(ia,ja){'use strict';for(var ka in ha.ARROW_CLASS)n.conditionClass(this._overlay,ha.ARROW_CLASS[ka],ia==ka);n.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',ia=='bottom'&&this._hasFooter);if(ia=='none')return;if(!this._arrow){this._arrow=p.create('i',{className:'uiContextualDialogArrow'});p.appendContent(this._overlay,this._arrow);}x.set(this._arrow,'top','');x.set(this._arrow,'left','');x.set(this._arrow,'right','');x.set(this._arrow,'margin','');var la=ia=='top'||ia=='bottom',ma=la?t.isRTL()?'right':'left':'top';ja=ja||0;x.set(this._arrow,ma,ja+'%');var na=ha.ARROW_LENGTH+ha.ARROW_OFFSET*2,oa=-(na*ja/100-ha.ARROW_OFFSET);x.set(this._arrow,'margin-'+ma,oa+'px');};ha.prototype._updateAlignmentClass=function(){'use strict';n.conditionClass(this.getRoot(),ha.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');};ha.prototype._setupScrollListener=function(ia){'use strict';this._scrollListener=q.listen(ia||window,'scroll',ea(this._adjustVerticalPosition,this));};ha.prototype._teardownScrollListener=function(){'use strict';if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}};ha.prototype._teardownResizeAndReflowListeners=function(){'use strict';if(this._resizeListener){this._resizeListener.remove();this._resizeListener=null;}if(this._reflowSubscription){this._reflowSubscription.unsubscribe();this._reflowSubscription=null;}};ha.getInstance=function(ia){'use strict';var ja=o.get(ia,'LegacyContextualDialog');if(!ja){var ka=v.byClass(ia,'uiOverlay');if(ka)ja=o.get(ka,'overlay');}return ja;};function ha(){'use strict';fa.apply(this,arguments);}Object.assign(ha,i,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:50,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,MIN_TOP_GAP:5,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'}});Object.assign(ha.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null});f.exports=ha;},null);
__d('TickerStoryList',['Animation','Arbiter','AsyncRequest','AsyncSignal','BanzaiODS','Bootloader','ChannelConstants','CSS','DOM','DOMVector','Event','HTML','Keys','LayerFadeOnHide','LegacyContextualDialog','LiveTimer','NavigationMessage','Parent','Rect','Run','ScrollableArea','SelectorDeprecated','Style','TickerController','TickerReadStateTracking','Toggler','UFIUIEvents','URI','UserActivity','UserAgent_DEPRECATED','Vector','clickRefAction','collectDataAttributes','containsNode','csx','cx','emptyFunction','ex','ge','getElementText','goURI','tickerPhoteSnowLiftOpenStatus','setTimeout','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(c.__markCompiled)c.__markCompiled();var za=15000;function ab(bb,cb,db){this._root=bb;this._content=p.find(bb,'.ticker_stream');this._stories=p.find(this._root,'.tickerActivityStories');this._scrollableArea=cb;this._container=p.find(bb,'div.uiScrollableAreaWrap');this._newestStory={};this._objectIDs=[];this._fetchedStories={};this._fetchedStoriesDialog={};this._storyDialogResources={};this._removedStoryIDs=[];this._storiesToRemove=[];var eb=Date.now();this._initTime=eb;this._lastUpdate=eb;this._lastPull=eb;this._lastInsert=eb;this._pollOnly=false;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=p.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!y.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ma('ticker_flyout');ma('ticker_flyout_prefetch');ma('ticker_flyout_loadtime');ma('ticker_stream');this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var fb=p.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=fb;p.appendContent(this._root,fb);this._lastKStories={head:null,tail:null,count:0,actors:{},apps:{},stories:{}};this._dedupeKeys={};this._initObjectIDs();this._initConfig(db);this._resetMorePager();this._initListeners();this._initSubscriptions(db);i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();}Object.assign(ab.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_ACTION_FOOTER_PADDING:8,FLYOUT_TARGET_HEIGHT_OFFSET:25,DEFAULT_LOOK_BEHIND:10,_lastKStoriesInsert:function(bb){this._lastKStories.stories[bb.getAttribute("data-story-key")]=true;var cb={story:bb,next:null};if(this._lastKStories.head)this._lastKStories.head.next=cb;this._lastKStories.head=cb;this._lastKStories.count++;if(!this._lastKStories.tail)this._lastKStories.tail=this._lastKStories.head;var db=bb.getAttribute("data-actor");if(!this._lastKStories.actors[db])this._lastKStories.actors[db]=0;this._lastKStories.actors[db]++;var eb=bb.getAttribute("data-app");if(eb){if(!this._lastKStories.apps[eb])this._lastKStories.apps[eb]=0;this._lastKStories.apps[eb]++;}if(this._lastKStories.count>this.DEFAULT_LOOK_BEHIND){while(this._lastKStories.tail&&!this._lastKStoriesRemove(this._lastKStories.tail.story))this._lastKStories.tail=this._lastKStories.tail.next;if(!this._lastKStories.tail)this._lastKStories.head=null;}},_lastKStoriesRemove:function(bb){var cb=bb.getAttribute("data-story-key"),db=bb.getAttribute("data-actor"),eb=bb.getAttribute("data-app");if(this._lastKStories.stories[cb]){delete this._lastKStories.stories[cb];this._lastKStories.actors[db]--;if(eb)this._lastKStories.apps[eb]--;this._lastKStories.count--;return true;}else return false;},_loadStoriesWithActions:function(){var bb=ta('rightCol');if(!bb)return;this._toggleWrapper=p.scry(bb,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var cb=p.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var db=0;db<cb.length;db++){var eb=cb[db];this._storiesWithActions[eb.getAttribute('data-story-key')]=eb;}}},_initConfig:function(bb){Object.assign(this,{_newest:bb.newest,_page_newest:bb.newest,_timeout:bb.timeout,_heartbeatTimeout:Math.min(5000,bb.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,bb.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,bb.pullTimeout),_insertTimeout:bb.insertTimeout,_maxQueueLength:bb.maxQueueLength,_heartbeatEndpoint:bb.heartbeatEndpoint,_popupOnHover:bb.popupOnHover,_userIdleTimeout:bb.userIdleTimeout,_pollOnly:bb.pollOnly,_tickerSource:bb.tickerSource,_logFlyouts:bb.logFlyouts,_userScrollGaurdDelay:bb.userScrollGaurdDelay,_rescheduleScrollToTopDelay:bb.rescheduleScrollToTopDelay});},_initListeners:function(){this._listeners=r.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=r.listen(this._container,'scroll',this._handleScroll.bind(this));xa(this._initInfiniteScrollListener.bind(this),0);},_initSubscriptions:function(bb){aa.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(x.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),i.subscribe(ha.Comment,this._scrollDialogToBottom.bind(this)),i.subscribe(ha.Changed,this._redrawFlyout.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!bb.pollOnly)this._subscriptions.push(i.subscribe(n.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(bb.pushChannel&&!bb.pollOnly)this.setPushChannel(bb.pushChannel);},_handleClick:function(event){if(!(event.button===1||event.altKey||event.ctrlKey||event.metaKey))event.prevent();var bb=event.getTarget();if(this._getButtonFromNode(bb)){this._logUserAction(bb,'click',event);this._handleActionButton(event);return;}var cb=this._getStoryFromNode(bb),db=y.byClass(bb,'tickerStoryAllowClick');if(!cb||cb==this._selectedStory||db)return;if(this._storyIsHidden(cb))return;if(cb==this._activeStory&&!this._selectedStory)this._selecting=true;if(this._storyCanOpenExternally(cb)){var eb=cb.getAttribute('data-href');if(eb&&!bb.getAttribute('href')){var fb={href:eb},gb=na(bb,['ft','gt']);ma('click',fb,event,'FORCE',gb);}else this._logUserAction(bb,'click',event);this._openStoryExternally(cb,event);return;}this._logUserAction(bb,'flyout',event);this._activateStory(cb,'click');this._selectStory(cb);},_handleMouseover:function(event){this._setLocked(true);var bb=event.getTarget(),cb=this._getOpenableStory(bb);if(!cb){var db=y.bySelector(bb,"._5wvy");if(db){clearTimeout(parseInt(db.getAttribute('data-timeout-token'),10));var eb=xa(function(){ab.removeMarkup(db,cb);},za);db.setAttribute('data-timeout-token',eb);}return;}event.kill();if(this._popupOnHover){if(!(cb.id in this._fetchedStories))this._uaCurStoryIDPrefetch=cb.id;this._fetchStory(cb);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var fb=this._storyCanOpenExternally(cb)?500:1000,gb=this._activeStory?75:fb;this._hoverShowTimeout=this._setTimeout((function(){this._activateStory(cb,'hover');this._logUserAction(bb,'flyout',event);}).bind(this),gb);}},_handleMouseout:function(event){var bb=event.getTarget();this._setLocked(false);if(bb==this._getStoryFromNode(bb)){var cb=p.scry(bb.parentNode,'.openToggler');for(var db=0;db<cb.length;db++)ca.toggle(cb[db]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var bb=this._activeStory;if(!bb)return;var cb=r.getKeyCode(event);switch(cb){case t.UP:case t.DOWN:var db=this._getInsertedStories(),eb;if(event.getModifiers().any){eb=cb===t.UP?0:db.length-1;}else eb=db.indexOf(bb)+(cb===t.UP?-1:1);bb=db[eb];break;case t.ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!bb)return;this._activateStory(bb,'keypress');this._selectStory(bb);},_fadeTopmostStoryButton:function(){var bb=0,cb=15;if(this._storiesWithActions)for(var db in this._storiesWithActions){var eb=this._storiesWithActions[db],fb=p.scry(eb,'.tickerInlineActionButton')[0],gb=p.scry(fb,'.tickerActionIcon')[0],hb=la.getElementPosition(fb).y-la.getElementPosition(this._toggleWrapper).y;if(hb<bb){da.set(fb,'opacity',0);da.set(gb,'opacity',0);}else if(hb>=bb&&hb<cb){var ib=(hb-bb)/(cb-bb);da.set(fb,'opacity',ib);da.set(gb,'opacity',ib);break;}else{da.set(fb,'opacity',1);da.set(gb,'opacity',1);}}},_handleScroll:function(){var bb=wa.checkIsOpen();if(bb)this._preventFlyoutDismiss=true;if(!this._preventScrollDismiss&&!bb){if(!this._preventFlyoutDismiss){this._deactivateStory(true);}else this._preventFlyoutDismiss=false;}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=ya(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var bb=this._stories.childNodes.length,cb=this._stories.getAttribute('data-gt'),db={ticker_scroll:1,number_stories:bb,source:cb};ma('scroll',null,null,'FORCE',{gt:db});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=xa((function(){this._userScrolling=false;this._userScrollingToken=null;}).bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof ba)this._scrollableArea.adjustGripper();},_handleActionButton:function(event){var bb=event.getTarget(),cb=this._getOpenableStory(bb),db=this._getStoryDialog(cb);if(db)var eb=db.subscribe('beforehide',function(){db.unsubscribe(eb);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=xa((function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}).bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(bb){new h(this._container).to('scrollTop',0).ease(h.ease.end).ondone(bb).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return p.scry(this._root,'div.fbFeedTickerStory');},_findStoryById:function(bb){var cb=p.scry(this._root,'.fbFeedTickerStory'),db;for(story in cb){db=cb[story];if(bb==this._getStoryDialogParams(db).token)return db;}return null;},_getInsertedStories:function(){return this._getAllStories().filter(function(bb){return !o.hasClass(bb,'queuedStory');});},_getQueuedStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getButtonFromNode:function(bb){return y.byClass(bb,'tickerInlineOverlay');},_getStoryFromNode:function(bb){return y.byClass(bb,'fbFeedTickerStory');},_getActionButtonFromStory:function(bb){return p.scry(bb,'.tickerInlineActionButton')[0];},_getOpenableStory:function(bb){var cb=this._getStoryFromNode(bb);return this._storyCanOpenDialog(cb)?cb:null;},_getStoryDialog:function(bb){return this._fetchedStoriesDialog[bb.id]||v.getInstance(bb);},_getStoryDialogParams:function(bb){var cb=bb&&bb.getAttribute('data-flyoutdata')||null;return cb&&JSON.parse(cb)||null;},_storyCanOpenDialog:function(bb){return !!this._getStoryDialogParams(bb)&&!this._storyIsHidden(bb);},_storyCanOpenExternally:function(bb){return !!bb.getAttribute('data-href')||!this._storyCanOpenDialog(bb);},_storyIsHidden:function(bb){return o.hasClass(bb,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(bb){this._deactivateStory();if(ua(bb)==='')p.remove(bb);o.addClass(bb,'tickerStoryHidden');o.removeClass(bb,'tickerStoryClickable');},undoHideStory:function(bb){o.addClass(bb,'tickerStoryClickable');o.removeClass(bb,'tickerStoryHidden');},insertStoriesAtBottom:function(bb){if(!bb)return;var cb=p.create('div');cb.appendChild(bb);var db=p.scry(cb,'.fbFeedTickerStory'),eb=p.find(cb,'.tickerMorePager'),fb=[];for(var gb=0;gb<db.length;gb++)if(!this.dedupeStory(db[gb]))fb.push(db[gb]);if(fb.length){fb.push(eb);p.replace(p.find(this._root,'.tickerMorePager'),fb);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(bb){this._scrollTopPromptVisible=bb;o.conditionShow(this._scrollTopPrompt,bb);if(bb&&!this._listeners.scrollTop){this._listeners.scrollTop=r.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!bb&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !ja.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var bb=this._storiesToRemove.pop();this.removeStory(bb);}var cb=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(cb);var db=Date.now(),eb=db-this._lastInsert;if(eb<this._insertTimeout||this._isLocked())return this._schedulePoll();var fb=this._getQueuedStories(),gb=this._isUserIdle(),hb=fb.length>0;if(hb){var ib=fb.shift();this.insertStory(ib);return this._schedulePoll();}if(gb)return ja.subscribeOnce(this._poll.bind(this));var jb=false,kb=false;if(this._pollOnly){kb=db-this._lastUpdate>this._heartbeatTimeout;}else jb=db-this._lastPull>this._pullTimeout;var lb=jb||kb;if(!lb)return this._schedulePoll();this.update({pull:jb,fullpoll:kb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(bb){this._updatePollOnlyHeartbeatTimeout();if(!this._pollOnly)return this._schedulePoll();var cb={newest:bb.fullpoll||bb.cache_update?this._newest:this._page_newest,source:this._tickerSource};if(!cb.newest||cb.newest==='0')throw new Error(sa('Trying to request new ticker stories with an invalid cursor %s, with'+' the settings fullpoll %s, cache_update %s, value coming from this.%s',typeof cb.newest==='string'?'"'+cb.newest+'"':cb.newest,bb.fullpoll,bb.cache_update,bb.fullpoll||bb.cache_update?'_newest':'_page_newest'));Object.assign(cb,bb);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(cb).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(cb.pull)this._lastPull=this._lastUpdate;},insertStory:function(bb){this._lastInsert=Date.now();window.LiveTimer&&w.addTimeStamps(bb);o.removeClass(bb,'queuedStory');if(this._isUserScrolling()){this._fadeStoryIn(bb);}else this._scrollToTop(this._flyStoryIn.bind(this,bb));if(this._storiesWithActions&&o.hasClass(bb,'tickerStoryWithButton'))this._storiesWithActions[bb.getAttribute('data-story-key')]=bb;this._removeOldStories();},_removeOldStories:function(){var bb=this._getInsertedStories();if(bb.length<=this._maxStoriesToKeep)return;var cb=this._minStoriesToKeep,db=bb.slice(cb);db.forEach(p.remove);if(this._storiesWithActions)for(var eb=0;eb<db.length;eb++)delete this._storiesWithActions[db[eb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var bb=this._getInsertedStories();if(!bb||!bb.length)return;var cb=bb[bb.length-1].getAttribute('data-ticker-timestamp'),db=p.scry(this._root,'.tickerMorePager a')[0];if(!db||!cb)return;var eb=new ia(db.getAttribute('ajaxify'));eb.addQueryData({oldest:cb});db.setAttribute('ajaxify',eb);},_setLocked:function(bb){this._locked=bb;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(bb,cb,db){var eb=this._getStoryFromNode(bb),fb=eb.getAttribute('data-story-key');p.setContent(eb,cb);o.addClass(eb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,fb),db||6000);},_getStoryByStoryKey:function(bb){var cb=this._getAllStories();for(var db=0;db<cb.length;db++){var eb=cb[db];if(eb.getAttribute('data-story-key')==bb)return eb;}return null;},removeStory:function(bb){this._removedStoryIDs[bb]=true;var cb=this._getStoryByStoryKey(bb);if(!cb)return;if(this._storiesWithActions)delete this._storiesWithActions[bb];if(cb==this._activeStory)this._deactivateStory();var db=this._getStoryDialog(cb);db&&db.destroy();this._lastKStoriesRemove(cb);var eb=cb.getAttribute("data-dedupe-key");if(eb)delete this._dedupeKeys[eb];if(o.hasClass(cb,'queuedStory')){p.remove(cb);return;}this._animateStoryOut(cb);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(bb){var cb=p.create('div',{style:{marginTop:'-1000px'}},bb);da.set(cb,'opacity',0);p.prependContent(this._stories,cb);var db=la.getElementDimensions(cb).y;da.set(cb,'marginTop','-'+db+'px');this._isInsertingStory=true;new h(cb).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone((function(){p.replace(cb,bb);this._afterInsert(bb);this._isInsertingStory=false;}).bind(this)).go();},_fadeStoryIn:function(bb){new h(this._stories).to('opacity',.5).ondone((function(){p.prependContent(this._stories,bb);this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();new h(this._stories).to('opacity',1).ondone((function(){this._afterInsert(bb);}).bind(this)).go();}).bind(this)).go();},_animateStoryOut:function(bb){var cb=p.create('div',{style:{overflow:'hidden',position:'relative'}});p.insertBefore(bb,cb);p.appendContent(cb,bb);new h(cb).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone((function(){p.remove(cb);i.inform('Ticker/animateOut');}).bind(this)).go();},_afterInsert:function(bb){i.inform('Ticker/afterInsert');},setPushChannel:function(bb){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(n.getArbiterType(bb),this._handleTickerPush.bind(this));e(['ChatConfig','ChannelConnection'],(function(cb,db){this._channelConnection=db;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}).bind(this));},_checkChannelConnection:function(){o.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},_handleTickerPush:function(bb,cb){var db=cb.obj;if(db.delete_id){this._storiesToRemove.push(db.delete_id);return;}var eb=db.story_xhp;if(!eb)return;var fb=s(eb).getRootNode();if(!db.story_time||db.story_time==='0')throw new Error(sa('An invalid story time was pushed: %s, for ticker story: %s',typeof db.story_time==='string'?'"'+db.story_time+'"':db.story_time,fb.getAttribute('data-flyoutdata')));this._newest=db.story_time;this.queueStory(fb,db.flyout_js_cmds);this._newestStory={actorID:db.actor,storyKey:fb.getAttribute('data-story-key')};},_handleComposerPublish:function(bb,cb){cb.tickerMarkup&&this.insertStory(cb.tickerMarkup);},_logRender:function(){if(this._loggedRender)return;var bb=this._tickerInSidebarMode;if(bb||y.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:bb}).send();this._loggedRender=true;}},_isTickerVisible:function(){var bb=ea.getActiveInstance()==this;bb&&this._logRender();return bb;},_handleResponse:function(bb){var cb=bb.getPayload();if(cb.newest)this._newest=this._page_newest=cb.newest;if(cb.content)if(cb.content instanceof Array){for(var db=0;db<cb.content.length;db++)this.queueStoryMarkup(cb.content[db]);}else this.queueStoryMarkup(cb.content);},queueStoryMarkup:function(bb){var cb=s(bb).getRootNode();this.queueStory(cb);},dedupeStory:function(bb){var cb=bb.getAttribute('data-story-key'),db=cb&&(!!this._objectIDs[cb]||!!this._removedStoryIDs[cb]);db=db||!!this._lastKStories.actors[bb.getAttribute('data-actor')]||!!this._lastKStories.apps[bb.getAttribute('data-app')];var eb=bb.getAttribute('data-dedupe-key');db=db||eb&&this._dedupeKeys[eb];if(bb.getAttribute('data-force-push'))db=false;cb&&(this._objectIDs[cb]=true);return db;},queueStory:function(bb,cb){if(this.dedupeStory(bb))return;this._lastKStoriesInsert(bb);var db=bb.getAttribute("data-dedupe-key");if(db)this._dedupeKeys[db]=true;o.addClass(bb,'queuedStory');p.appendContent(this._storyQueue,bb);var eb=cb&&cb.length;if(eb)cb.forEach(function(gb){new Function(gb).apply();});bb.setAttribute('id',bb.id+'_'+this._root.id);var fb=this._getQueuedStories();fb.slice(0,-this._maxQueueLength).forEach(p.remove);if(eb)this._fetchedStories[bb.id]=true;},_cleanup:function(){ea.clearRHCplaceholder();if(!y.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var bb in this._listeners)this._listeners[bb]&&this._listeners[bb].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(bb,cb){var db=cb.params.key;if(db!='lf'&&db!='h')this._cleanup();},registerStoryDialog:function(bb,cb){if(this._uaCurStoryIDFetch==bb.id)this._uaCurStoryIDFetch=null;if(this._uaCurStoryIDPrefetch==bb.id)this._uaCurStoryIDPrefetch=null;this._fetchedStories[bb.id]=true;this._fetchedStoriesDialog[bb.id]=cb;cb.setContext(bb);cb.subscribe('hide',this._deactivateStory.bind(this,true));cb.subscribe('success',this._focusStory.bind(this,bb));cb.subscribe('beforehide',(function(){if(this._selecting){this._selecting=false;return false;}}).bind(this));if(this._popupOnHover){cb.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));cb.subscribe('mouseleave',this._scheduleHide.bind(this));cb.subscribe('show',(function(){xa(this._highlightDialogScrollbar.bind(this,cb),0);var db=r.listen(cb.getContent(),'mousedown',(function(){this._selectStory(bb);db.remove();}).bind(this));}).bind(this));}if(bb==this._activeStory)this._openDialog(cb);},_highlightDialogScrollbar:function(bb){var cb=p.scry(bb.getContent(),'.uiScrollableArea')[0];cb&&ba.poke(cb);},_openStoryExternally:function(bb,event){var cb=bb.getAttribute('data-href');if(!cb||cb=='#')return;var db=bb.getAttribute('data-story-rel');switch(db){case 'theater':this._deactivateAndClearStory();m.loadModules(["PhotoViewer"],function(gb){gb.bootstrap(cb,bb);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(cb,bb);return;}var eb=bb.getAttribute('data-target'),fb=event.which!=1||event.getModifiers().any||eb=='_blank';fb?window.open(cb,'_blank'):va(cb);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function(bb){var cb=this._container,db=cb.clientHeight,eb=bb.offsetHeight,fb=cb.scrollTop,gb=fb+db,hb=bb.offsetTop,ib=hb+eb;return hb<fb||ib>gb;},_focusStory:function(bb){if(this._focusStoryWillTriggerScroll(bb))this._preventScrollDismiss=true;var cb=new z(bb),db=y.byClass(bb,'scrollable'),eb=cb.boundWithin(new z(db)).getPositionVector(),fb=cb.getPositionVector().sub(eb);if(fb.y!==0)fb.scrollElementBy(db);bb.focus();},_selectStory:function(bb){this._selectedStory=bb;o.addClass(bb,'tickerStorySelected');o.addClass(this._root,'tickerChildSelected');},_activateStory:function(bb,cb){this._clearHoverTimeouts();if(bb==this._activeStory||!this._storyCanOpenDialog(bb))return;this._deactivateStory();this._focusStory(bb);this._activeStory=bb;o.addClass(bb,'tickerStoryActive');window.Toggler&&ga.hide();if(this._logFlyouts){cb=cb||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:cb}).send();}fa.log(bb);var db=this._getStoryDialog(bb);if(db){if(this._storyDialogResources[bb.id])m.loadResources(this._storyDialogResources[bb.id]);this._openDialog(db);l.bumpEntityKey('ticker_stories','flyouts.open');return;}if(!(bb.id in this._fetchedStories))this._uaCurStoryIDFetch=bb.id;this._fetchStory(bb);},handleRemoveStory:function(){this._deactivateStory(true);},_deactivateStory:function(bb){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(bb){this._dialog.enableBehavior(u);}else this._dialog.disableBehavior(u);this._dialog.hide();}if(this._activeStory){o.removeClass(this._activeStory,'tickerStoryActive');o.removeClass(this._activeStory,'tickerStorySelected');o.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(bb,cb,event){ma(cb,bb,event,'FORCE');},_fetchStory:function(bb){clearTimeout(this._fetchToken);var cb=[],db=this._getInsertedStories(),eb=db.indexOf(bb);[-1,0,1].forEach(function(fb){var gb=db[eb+fb];gb&&cb.push(gb);},this);this._fetchToken=xa(this._fetchStories.bind(this,cb),100);},_fetchStories:function(bb){var cb=[],db,eb=function(fb){clearTimeout(db);bb.forEach(function(gb){o.conditionClass(gb,'tickerStoryFetching',fb);});};bb=bb.filter(function(fb){if(fb.id in this._fetchedStories)return false;this._fetchedStories[fb.id]=true;var gb=this._getStoryDialogParams(fb);if(!gb)return false;gb.uniq_id=fb.getAttribute('id');gb.referrer=this._tickerSource;cb.push(gb);return true;},this);if(!cb.length)return;db=this._setTimeout(eb.bind(null,true),500);new j('/ajax/feed/ticker/multi_story').setInitialHandler(this._handleDialogResponse.bind(this,cb)).setFinallyHandler(eb.bind(null,false)).setErrorHandler(ra).setData({stories:cb}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_handleDialogResponse:function(bb,cb){if(cb&&cb.resource_map){var db=[];for(var eb in cb.resource_map){var fb=cb.resource_map[eb];if(fb.type==='css'&&!fb.permanent)db.push(eb);}if(db.length>0)for(var gb=0;gb<bb.length;gb++)this._storyDialogResources[bb[gb].uniq_id]=db;}},_tickerDeClicker:function(event){var bb=event.getTarget(),cb=y.byTag(bb,'a'),db=this._getStoryFromNode(bb),eb=this._getButtonFromNode(bb);if(db&&cb&&!eb&&o.hasClass(db,'tickerStoryClickable')&&!o.hasClass(cb,'tickerStoryAllowClick')&&!this._storyIsHidden(db))cb.setAttribute('rel','ignore');var fb=event.button==2,gb=event.type==='keydown',hb=db&&this._getActionButtonFromStory(db);if(!fb&&hb&&!gb)this._setClickedStory(db);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(bb){this._clearClickedStory();o.addClass(bb,'tickerStoryClicked');this._clickedStory=bb;},_clearClickedStory:function(){if(this._clickedStory){o.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var bb=this._getInsertedStories();if(this._storiesWithActions)for(var cb=0;cb<bb.length;cb++){var db=bb[cb];if(o.hasClass(db,'tickerStoryWithButton'))this._storiesWithActions[db.getAttribute('data-story-key')]=db;}var eb=Math.max(0,bb.length-this._autoloadStoryIndex);this._infiniteScrollStory=bb[eb];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var bb=la.getElementPosition(this._infiniteScrollStory).y,cb=la.getElementPosition(this._container).y+la.getElementDimensions(this._container).y;if(bb<cb){var db=p.scry(this._root,'.tickerMorePager a')[0];if(db){var eb=y.byClass(db,'stat_elem')||db;new j(db.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(db).setStatusElement(eb).setAllowCrossPageTransition(true).send();}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(bb){if(!this._selectedStory)return;var cb=this._getStoryDialog(this._selectedStory);if(cb){cb.setFixed&&cb.setFixed(bb);cb.updatePosition();}},_setTimeout:function(bb,cb){return xa(bb,cb,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var bb=this._dialog&&this._dialog.getContent(),cb=bb&&p.scry(bb,'.uiScrollableAreaWrap')[0],db=cb&&ba.getInstance(cb);db&&db.scrollToBottom();},_redrawFlyout:function(bb,cb){if(this._hasUFIUpdated)return;var db=this._dialog;if(db&&db.isShown()&&oa(db.getContent(),cb.form)){this._hasUFIUpdated=true;this._updateDialogPosition();}},_openDialog:function(bb){if(!this._tickerInSidebarMode)o.addClass(bb.getRoot(),'tickerStoryOverlayOnTop');this._hasUFIUpdated=false;var cb=q.getScrollPosition();this._dialog=bb.show();window.scrollTo(cb.x,cb.y);this._updateDialogPosition();this._writeSwfFrame(bb);xa(this._initCommentFocusListener.bind(this),0);xa(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(bb);},_stupidIE7VideoResizeHack:function(bb){if(ka.ie()===7){var cb=p.scry(bb.getContent(),'.uiVideoThumb .img');cb.forEach(function(db){da.set(db,'width','');});}},_updateDialogPosition:function(){var bb=this._tickerInSidebarMode||!!y.byClass(this._root,'fixed_elem');this._dialog.setFixed&&this._dialog.setFixed(bb);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(bb){var cb=this._dialog&&this._dialog.getContent(),db=p.scry(cb,'.swfObject')[0];if(!db)return;var eb=db.getAttribute('data-swfid');if(eb&&window[eb]){var fb=window[eb];fb.write(db);}},_initCommentFocusListener:function(){var bb=this._dialog&&this._dialog.getContent(),cb=bb&&p.scry(bb,'.tickerDialogFooter textarea')[0];if(!cb)return;this._listeners.inputFocus=r.listen(cb,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var bb=this._dialog&&this._dialog.getContent();if(!bb)return;this._listeners.contentResize=r.listen(bb,'click',(function(){xa(this._dialog.updatePosition.bind(this._dialog),0);}).bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var bb=this._dialog&&this._dialog.getContent(),cb=bb&&p.scry(bb,'.uiScrollableAreaWrap')[0];if(!cb)return;var db=la.getElementDimensions(cb),eb=la.getElementPosition(cb),fb=p.scry(cb,'.uiUfi .uiUfiComment'),gb=p.scry(cb,"._12tg")[0],hb=p.scry(cb,".UFILikeSentence")[0],ib=this.FLYOUT_MAX_HEIGHT;if(gb||hb){var jb=this._getUfiItemAndTop(gb,hb),kb=jb[0],lb=jb[1];ib=Math.max(ib,this.FLYOUT_TARGET_HEIGHT_OFFSET+cb.scrollTop+lb+kb.offsetHeight-eb.y);}var mb=la.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING;ib=Math.min(ib,mb);var nb=ib-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var ob=0;ob<fb.length;ob++){var pb=fb[ob],qb=la.getElementPosition(pb),rb=qb.y-eb.y;if(Math.abs(rb-nb)<=this.FLYOUT_OFFSET_THRESHOLD){nb=rb+this.FLYOUT_COMMENT_OFFSET;break;}}if(db.y>=nb){da.set(cb,'height',nb+'px');da.set(cb,'max-height',null);}else{da.set(cb,'max-height',ib+'px');da.set(cb,'height',null);}},_getUfiItemAndTop:function(bb,cb){var db=bb&&la.getElementPosition(bb).y||0,eb=cb&&la.getElementPosition(cb).y||0,fb=[bb,db+this.FLYOUT_ACTION_FOOTER_PADDING],gb=[cb,eb];return db>eb?fb:gb;},_initObjectIDs:function(){var bb=this._getAllStories();for(var cb=bb.length-1;cb>=0;cb--){var db=bb[cb].getAttribute('data-story-key');if(db){this._objectIDs[db]=true;this._lastKStoriesInsert(bb[cb]);var eb=bb[cb].getAttribute("data-dedupe-key");if(eb)this._dedupeKeys[eb]=true;}}},_handleChatOpened:function(){this._deactivateStory();},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});f.exports=ab;},null);